(()=>{const e=/(§[a-zA-Z0-9]){1}/g,t=getCookie(SESSIONKEY),n={maxsize:0},o={a:0},s={raw:[],colored:[]},i={unhistable:"rgb(143 73 73)",histable:"rgb(255, 142, 142)"},a={"黒":"§0","暗い青":"§1","暗い緑":"§2","暗い水色":"§3","暗い赤":"§4","暗い紫":"§5","金色":"§6","灰色":"§7","暗い灰色":"§8","青色":"§9","緑色":"§a","水色":"§b","赤色":"§c","ピンク":"§d","黄色":"§e","白色":"§f",Mark1:"§j",Mark2:"§i",Mark3:"§p",Mark4:"§g","横線":"§h","大lvl.1":"§z","大lvl.2":"§y","大lvl.3":"§x","太字":"§l","更に太字":"§L","下線":"§n",italic:"§o","中線":"§m","改行":"§v","リセット":"§r"},l={"§0":"sheart1","§1":"sheart2","§2":"sheart3","§3":"sheart4","§4":"sheart5","§5":"sheart6","§6":"sheart7","§7":"sheart8","§8":"sheart9","§9":"sheart10","§a":"sheart11","§b":"sheart12","§c":"sheart13","§d":"sheart14","§e":"sheart15","§f":"sheart16","§h":"sheart99","§j":"sheart100","§i":"sheart101","§p":"sheart102","§g":"sheart103"},c={"§l":"sheart17","§n":"sheart18","§o":"sheart19","§m":"sheart26"},r={"§x":"sheart28","§y":"sheart29","§z":"sheart30",defaultcls:"sheart31"},d={"§q":"sheart36","§w":"sheart37","§t":"sheart38","§u":"sheart39",defaultcls:"sheart40"},p={range:Range.prototype,selection:Selection.prototype},u=[".jpg",".jpeg",".png",".gif",".webp",".mp4",".webm",".avi",".mov",".flv"],m=2e3,f=250,h=[.25,.33,.5,.67,.75,.8,.9,1,1.1,1.25,1.5,1.75,2,2.5,3,4,5],g=Number(getLocalStorage(ZOOMRATIOKEY)),v=Number(getLocalStorage(TOPKEY)),y={zooms:{delta:1.1,max:5,min:.4,ratios:h,ratio:h.includes(g)?g:1},moves:{delta:20,top:isNaN(v)?0:v}};var b="",E={},_=false,x=0,w=0,k,I,C,T=0,N=16,L="";try{k=JSON.parse(getLocalStorage(EDITORCONFIGKEY)||"{}")}catch(e){k={};delLocalStorage(EDITORCONFIGKEY)}for(const e of document.getElementsByTagName("script")){const t=e.src;if(t&&t.includes("/src/assets/manage/editor/"))N++}const O={autosave:k[AUTOSAVEKEY]===true?true:true,autosaveNotification:k[AUTOSAVENOTIFICATIONKEY]===false?false:true,colorEditor:k[COLOREDITORKEY]===false?false:true,instapreview:k[INSTAPREVIEWKEY]===true?true:false,quickInputNotification:k[QUICKINPUTNOTIFICATIONKEY]===false?false:true,visibleSpace:k[VISIBLESPACEKEY]===false?false:true,visibleOnlyEndSpace:k[VISIBLEONLYENDSPACEKEY]===false?false:true,solidObject:k[SOLIDOBJECTKEY]===false?false:true,_solidObject:k[_SOLIDOBJECTKEY]===false?false:true};var S=false;function A(e){function n(){S=false;delCookie(SESSIONKEY);window.history.replaceState("","","/org/manage/login");window.location.assign("/org/manage/login")}S=true;$.ajax({type:"POST",url:"/org/manage/auth/logout",timeout:5e3,data:{session:t},success:n,error:()=>{S=false;if(e===true&&!(this instanceof HTMLElement)){n();return}if(this instanceof HTMLElement)$(this).text("ログアウト").css("color","black");PictoNotifier.notify("error","通信エラー",{duration:1e4,do_not_keep_previous:true,deny_userclose:true})}})}function j(e){const t=`<h4>${e?.over||""}</h4><div id="map_load_progress"><div id="ml_progress"></div></div><h4>${e?.under||""}</h4>`;startLoad(t);return function e(t){return e}}function B(e){e.preventDefault()}window.addEventListener("gesturestart",B,{passive:false});window.addEventListener("dblclick",B,{passive:false});window.addEventListener("click",(function(e){const t=e.target;if(t.tagName.toUpperCase()==="VIDEO"&&t.classList.contains("cloudfileel")&&t.classList.contains("cloudsh"))e.preventDefault()}),{passive:false});window.addEventListener("DOMContentLoaded",(function(){document.getElementById("shishiji-overview")?.addEventListener("click",B,{passive:false})}));document.getElementById("__cover__")?.remove();const P=j({over:"Welcome to Shishiji Editor"})(0);T++;P(T*100/N);function R(e){try{if(e=="h")this.outerHTML=`<div id="no-del-image-h" class="flxxt nImg-a">${GPATH.ERROR_ZAHUMARU}<h4>No Image</h4></div>`;else if(e=="i")this.outerHTML=`<div id="no-del-image-i" class="flxxt no-del-image" style="width:48px;height:48px;">${GPATH.ERROR_ZAHUMARU}</div>`}catch(e){}}function z(e,t,n,o,s,i,a,l){const c=document.getElementById("overview-context");const r=document.getElementById("shishiji-overview");const d=e.article.theme_color?e.article.theme_color:"black";const p=e.article.font_family?e.article.font_family:"";var u=mcFormat(e.article.content,(e=>toOrgFilepath(b,e)));if(!window.navigator.onLine){PictoNotifier.notify("error",TEXTS[LANGUAGE].NOTIFICATION_CONNECTION_ERROR,{duration:2500,discriminator:"article connection error",do_not_keep_previous:true});$("#ovv-ctx-loading").html(`<div class="flxxt"><div style="width:40%;">${GPATH.ERROR_ZAHUMARU}</div></div>${TEXTS[LANGUAGE].ARTICLE_CONNECTION_ERROR}`);$("#overview-share").hide();return}if(u==="<span></span>"){u=`<h4 style="width: 100%; margin-top: 50px; margin-bottom: 50px; text-align: center;">${TEXTS[LANGUAGE].ARTICLE_NO_ARTICLE}</h4>`}var m="";for(var f of e.article.custom_tr){if(f.title&&f.content)m+=`\n                    <tr class="ev_property">\n                        <th class="ev_property_cell" aria-label="${f.title}">\n                            ${f.title}\n                        </th>\n                        <th class="ev_property_cell" aria-label="${f.content}">\n                            ${f.content}\n                        </th>\n                    </tr>\n                `}if(t)$(c).addClass("fadein");r.style.borderTop="solid var(--shishiji-ovv-theme-height) "+d;$(r).css("font-family",p);const h=`<img id="--art-header" class="article-image article header" alt="" aria-label="${TEXTS[LANGUAGE].ARIA_ARTICLE_HEADER}"><div class="article titleC"><img id="--art-icon" class="article-image" style="width: 48px" alt="" aria-label="${TEXTS[LANGUAGE].ARIA_ARTICLE_ICON}"><h1 id="ctx-title" style="margin: 5px; font-family: var(--font-view);">${escapeHTML(e.article.title)}</h1></div>`;function g(){setTimeout((()=>{if(n!==void 0)$("#shishiji-overview").scrollTop(n);n=0}),25)}var v=0;function y(){var e=0;if($(this).hasClass("tg-active")&&(!s||v>0))return;if(!l||v>0)$("#ctx-article").hide().removeClass("fadein").removeClass("_fadein");if(v>0)e++;v++;$("#oop").show();K(u,a,g);$("#core_grade_vh").text(E.article.core_grade);if(!$("#ovv-t-description-sd").hasClass("tg-active"))$(".tg-active").removeClass("tg-active");$(this).addClass("tg-active");$(".article-image").addClass("doaJSD");setTimeout((()=>!l||e==1?$("#ctx-article").show().addClass("_fadein"):void 0),5)}function _(){if($(this).hasClass("tg-active"))return;$("#ctx-article").hide().removeClass("fadein").removeClass("_fadein");$("#oop").hide();const t=document.createElement("div");t.className="ev_property";const n=document.createElement("hr");n.style.margin="20px";n.style.marginTop="40px";t.appendChild(n);const o=document.createElement("table");o.style.width="100%";const s=document.createElement("tbody");s.className="ev_property";const i=document.createElement("tr");i.className="ev_property";const l=document.createElement("th");l.className="ev_property_cell";l.setAttribute("aria-label","開催場所");l.textContent="開催場所";const c=document.createElement("th");c.className="ev_property_cell";c.setAttribute("aria-label",e.article.venue);c.textContent=e.article.venue;i.appendChild(l);i.appendChild(c);s.appendChild(i);o.appendChild(s);t.appendChild(o);const r=document.createElement("hr");r.style.margin="20px";t.appendChild(r);K(`\n                <hr style="margin: 40px 20px 20px 20px;">\n                <div class="ev_property">\n                    <table style="width: 100%;">\n                        <tbody>\n                            <tr class="ev_property">\n                                <th class="ev_property_cell" aria-label="開催場所">\n                                    開催場所\n                                </th>\n                                <th class="ev_property_cell" aria-label="${e.article.venue}">\n                                    ${e.article.venue}\n                                </th>\n                            </tr>\n                        </tbody>\n                    </table>\n                </div>\n                <hr style="margin: 20px;">\n            `,a,g);$("#ctx-article").removeClass("fadein").removeClass("_fadein");$(".tg-active").removeClass("tg-active");$(this).addClass("tg-active");$(".article-image").addClass("doaJSD");setTimeout((()=>$("#ctx-article").show().addClass("_fadein")),5)}function x(){if($(this).hasClass("tg-active"))return;$("#ctx-article").addClass("_wait_f");$("#oop").hide();K(`\n                <div class="sajNF">\n    \n                </div>\n            `,a,g);$("#ctx-article").removeClass("fadein").removeClass("_fadein");$(".tg-active").removeClass("tg-active");$(this).addClass("tg-active");$(".article-image").addClass("doaJSD")}$("#ovv-t-description-sd").off("click",Ovv_tg_listener.description).on("click",y);$("#ovv-t-details-sd").off("click",Ovv_tg_listener.details).on("click",_);$("#ovv-t-else-sd").off("click",Ovv_tg_listener.commands).on("click",x);Ovv_tg_listener.description=y;Ovv_tg_listener.details=_;Ovv_tg_listener.commands=x;if(!o||!["description","details","else"].includes(o))o="description";document.getElementById(`ovv-t-${o}-sd`)?.dispatchEvent(new Event("click"))}T++;P(T*100/N);function M(e,t,n){var o=document.getElementById("main-editor");var i=$("#shishiji-overview").scrollTop();H();const a=document.getElementById("main-editor")?.innerHTML;if(!t){if(w<s.raw.length-1)s.raw.splice(w+1);if(a&&s.raw.slice(-1)[0]!==a)s.raw.push(a);w=s.raw.length-1}Q();E.article.content=o.innerText;z(E,false,i,void 0,true,true,n,true);if(e){function l(e){if(e=="h")this.outerHTML=`<img id="--art-header" class="article-image article header doaJSD" alt="" aria-label="${TEXTS[LANGUAGE].ARIA_ARTICLE_HEADER}">`;else if(e=="i")this.outerHTML=`<img id="--art-icon" class="article-image doaJSD" style="width: 48px" alt="" aria-label="${TEXTS[LANGUAGE].ARIA_ARTICLE_ICON}">`}const c={outerHTML:""};l.apply(document.getElementById("no-del-image-h")||c,["h"]);l.apply(document.getElementById("no-del-image-i")||c,["i"]);const r="?"+(new Date).getTime();$("#--art-header").on("error",(function(){R.apply(this,["h"])})).attr("src",toOrgFilepath(b,E.article.images.header)+r);$("#--art-icon").on("error",(function(){R.apply(this,["i"])})).attr("src",toOrgFilepath(b,E.object.images.icon)+r)}}function D(e,t){const n=document.getElementById("main-editor");n.focus();const o=p.selection;const s=p.range;const i=document.createTextNode(e);try{s.deleteContents();s.insertNode(i)}catch(e){if(t)t(e);return}s.setStartAfter(i);s.collapse(true);o.removeAllRanges();o.addRange(s);_=true;$("#sv_msg").text("");$("#save_data_norm").css("background-color","rgb(247, 255, 142)").css("cursor","pointer");if(O.quickInputNotification)PictoNotifier.notify("input",e,{duration:1e3,do_not_keep_previous:true});oe();n.focus();M()}async function K(e,t,n){new Promise(((n,o)=>{const s=document.getElementById("ctx-article");const i=document.createElement("span");const a={};const l=["IMG","VIDEO"];i.innerHTML=e;if(!t){for(const e of s?.querySelectorAll("*")||[]){const t=e.tagName.toUpperCase();if(!l.includes(t))continue;const n=e.getAttribute("src")?.replace(/\?.*/,"");if(typeof n!=="undefined"){if(a[n]?.length>0){a[n].push(e)}else{a[n]=[e]}}}for(const e of i.querySelectorAll("*")){const t=e.tagName.toUpperCase();if(!l.includes(t))continue;const n=e.getAttribute("src");if(n!==null){const t=a[n];const o=t?.length>0?t[0]:e.cloneNode(true);e.parentNode?.replaceChild(o,e);o.style.width=e.style.width;a[n]=a[n]?.filter((e=>{if(e!==o)return true}))}}}else{for(const e of i.querySelectorAll("*")){const t=e.tagName.toUpperCase();if(!l.includes(t))continue;e.setAttribute("src",e.getAttribute("src")?.replace(/\?.*/,"")+"?"+(new Date).getTime())}}$("#ctx-article").empty().append(i);n("")})).then((()=>{if(n!==void 0)n()}))}async function U(e,t){new Promise(((t,n)=>{const o=document.getElementById("ctx-article");const s=document.createElement("span");const i=[];const a=[];s.innerHTML=e;for(const e of o?.querySelectorAll("*")||[]){if(e.tagName.toUpperCase()!=="IMG")continue;for(const t of s.querySelectorAll("*")){if(t.tagName.toUpperCase()!=="IMG")continue;if(e.getAttribute("src")===t.getAttribute("src")){t.parentNode?.replaceChild(e,t);e.style.width=t.style.width;i.push(e);a.push(t);break}}}$("#ctx-article").empty().append(s);t("")})).then((()=>{if(t!==void 0)t()}))}T++;P(T*100/N);function H(){const e=document.getElementById("main-editor")?.innerText||"";const t=G(e);const n=$("#main-editor");const o=$("#main-editor-cd");var s=n.html().replace(/\n/g,"<br>").replace(/ /g,"&nbsp;");var i=s;if(O.colorEditor||O.solidObject){if(Object.keys(t.removebrs).length>0){var a=0;for(var[l,c]of Object.entries(t.removebrs)){a+=(l.match(/<br>/g)||[]).length;l=l.replace(/\u00A0/g," ");i=i.replace(l.replace(/ /g,"&nbsp;"),c)}const e=a<=1;n.trigger("blur").html(i.replace(/ /g,"&nbsp;").replace("\t","   "));PictoNotifier.notify("info",`Oops, you can't insert ${e?"a ":""}line break${e?"":"s"} there!!`,{discriminator:"no line break there",do_not_keep_previous:true})}}if(O.colorEditor){i=t.text}if(O.visibleSpace){if(O.visibleOnlyEndSpace)i=J(i);else i=Y(i)}o.html(i)}function G(e){if(e===null||e===void 0)return{text:"",removebrs:{}};const t=document.createElement("span");e=W(e);for(const t in l){e=e.replace(new RegExp(t,"g"),`<span class="${l[t]}">${t}</span>`)}for(const t in c){e=e.replace(new RegExp(t,"g"),`<span class="${c[t]}">${t}</span>`)}for(const t in r){e=e.replace(new RegExp(t,"g"),`<span class="${r.defaultcls}">${t}</span>`)}e=F(e).result;e=e.replace(/§v/g,`<span class="sheart32">§v</span>`);e=e.replace(/§r/g,`<span class="sheart33">§r</span>`);e=e.replace(/§k/g,`<span class="sheart34">§<span class="MCOBF">r</span></span>`);function n(e){t.innerHTML=e;return t.textContent||""}const o={};const s={image:/∫\:(IMG)-S=([^-]+)-W=(\d+);∫/,video:/∫\:(VIDEO)-S=([^-]+)-W=(\d+);∫/,link:/#\:LINK-H=(https?:\/\/(?:(?!-T=).)+)-T=((?:(?!;#).)*);#/};const i=e.matchAll(/∫(?:(?!∫).)+∫/g);const a=e.matchAll(/#(?:(?!#).)+#/g);for(const t of i){const i=t[0];const a=n(i);const l=s.image.exec(a)||s.video.exec(a);if(l){const t=l[1];const n=l[2].replace(/ |\u00A0/g,"&nbsp;");const s=l[3];const c=`<span class="sheart22">∫:${t}-S=<span class="sheart23">${n}</span>-W=<span class="sheart23">${s}</span>;∫</span>`;e=e.replace(i,c);if(i.includes("<br>"))o[i]=a}}for(const t of a){const i=t[0];const a=n(i);const l=s.link.exec(a);if(l){const t=l[1].replace(/ |\u00A0/g,"&nbsp;");const n=l[2].replace(/ |\u00A0/g,"&nbsp;");const s=`<span class="sheart24">#:LINK-H=<span class="sheart25">${t}</span>-T=<span class="sheart25">${n}</span>;#</span>`;e=e.replace(i,s);if(i.includes("<br>"))o[i]=a}}t.remove();return{text:e,removebrs:o}}function Y(e){e=e.replace(/\u00A0/g," ");return e.replace(/(&nbsp;)+/g,(function(e){const t="·".repeat(e.length/"&nbsp;".length);return`<span class="sheart35">${t}</span>`})).replace(/　+/g,(function(e){console.log(e);const t="・".repeat(e.length);return`<span class="sheart35">${t}</span>`}))}T++;P(T*100/N);function F(e,t){const n={result:e,found:false};const o=e;for(const n in d){if(!e.includes(n))continue;if(t){const t=document.createElement("span");t.innerHTML=e;for(const e of t.childNodes){if(e.tagName?.toUpperCase()==="SPAN"&&e.textContent===n){console.log(e);e.remove()}}if(!t.innerHTML.includes(n))continue}e=e.replace(new RegExp(n,"g"),`<span class="${d.defaultcls}">${n}</span>`)}if(o!=e){n.found=true;n.result=e}return n}function J(e){e=e.replace(/\u00A0/g," ");return e.replace(/(&nbsp;|　)+<br>/g,(function(e){const t=e.replace(/&nbsp;/g,"·").replace(/　/g,"・").slice(0,-"<br>".length);return`<span class="sheart35">${t}</span><br>`}))}function W(e){return escapeHTML(e).replace(/\u00A0/g," ").replace(/\n/g,"<br>").replace(/ /g,"&nbsp;")}function q(e){return e.replace(/	/g,"  ")}function V(e){return e.replace(/\n/g,"<br>")}function X(e){return e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&nbsp;/g," ").replace(/<br>/g,"\n")}function Z(){if(L===E.article.content){$("#save_data_norm").css({"background-color":"rgb(144 149 81)",cursor:"not-allowed"});return false}else{$("#save_data_norm").css({"background-color":"rgb(247, 255, 142)",cursor:"pointer"});return true}}function Q(){class e{style={};classList={add:()=>{},remove:()=>{}}}const t=document.getElementById("__undo_-")||new e;const n=document.getElementById("__redo_-")||new e;if(w<=0){t.style.backgroundColor=i.unhistable;t.style.cursor="not-allowed"}else{t.style.backgroundColor="";t.style.cursor="pointer"}if(w>=s.raw.length-1){n.style.backgroundColor=i.unhistable;n.style.cursor="not-allowed"}else{n.style.backgroundColor="";n.style.cursor="pointer"}}T++;P(T*100/N);function ee(){function e(){if($(this).css("background-color")=="rgb(247, 255, 142)")return true;else return false}return e.call(document.getElementById("save_data_norm"))}function te(e,n,s){if(!ee())return;$("#sv_msg").text("保存しています...").css("color","orange");$("#save_data_norm").css("background-color","rgb(144 149 81)").css("background-color","rgb(144 149 81)");setTimeout((()=>{$.post("/org/manage/edit/savemain",{session:t,nmap:JSON.stringify(E)}).done((t=>{_=false;C=E;L=E.article.content;clearTimeout(o.a);if(!e){$("#sv_msg").text("保存しました").css("color","green");o.a=setTimeout((()=>{$("#sv_msg").text("")}),3e3)}$("#save_data_norm").css({"background-color":"rgb(144 149 81)",cursor:"not-allowed"});M(false,true);if(n)n()})).catch((e=>{clearTimeout(o.a);Z();$("#sv_msg").text("失敗しました").css("color","red");o.a=setTimeout((()=>{$("#sv_msg").text("")}),3e3);if(s)s()}))}),250)}function ne(){const e=$("#main-editor").html().matchAll(/<br>/g);const t=$("#main-editor").html().matchAll(/\n/g);$("#main-editor-linen").html("");var n=1;for(const t of e){$("#main-editor-linen").append(n+"<br>");n++}for(const e of t){$("#main-editor-linen").append(n+"<br>");n++}}function oe(){clearTimeout(x);if(O.autosave){x=setTimeout((()=>{if(!ee())return;PictoNotifier.notifySave("オートセーブ中...",{duration:3e4});te.apply(document.getElementById("save_data_norm"),[true,()=>{$("#sv_msg").text("オートセーブ完了").css("color","green");if(O.autosaveNotification)PictoNotifier.notify("save","オートセーブ完了")},()=>{Z();$("#sv_msg").text("オートセーブ失敗").css("color","red");PictoNotifier.notify("error","オートセーブに失敗")}])}),m)}}T++;P(T*100/N);setInterval((()=>{var e=window.getSelection();if(!e||e.anchorNode?.parentElement?.id!="main-editor"&&e.anchorNode?.id!="main-editor")return;try{var t=e.getRangeAt(0);p.selection=e;p.range=t}catch(e){}}),1);$("#app-mount").show();$.ajaxSetup({async:false});$.post("/org/manage/auth/editor",{session:t,type:"Editor"}).done((e=>{const t=e.error;b=e.usn;if(t)A();E=C=e.artdata;L=E.article.content;n.maxsize=e.mxcs})).catch(A);$.ajaxSetup({async:true});if(!E||Object.keys(E).length<1){E=C={article:{title:"orgname",subtitle:"",core_grade:"...",theme_color:"#000000",content:"",crowd_status:0,font_family:null,custom_tr:[],images:{header:""},venue:"",schedule:""},object:{type:{event:"org",behavior:"dynamic"},coordinate:{x:0,y:0},images:{icon:""},size:{width:50,height:50},floor:"2F"},discriminator:""}}$("#username-d").text(b);$("#main-editor").html(V(escapeHTML(E.article.content)));H();$("#ctx-title").text(E.article.title||"NAME");Array.from(document.getElementsByClassName("motd-dec-b")).forEach((e=>{e.addEventListener("click",(function(e){e.preventDefault();const t=this.textContent?.replace(/ /g,"").replace(/\n/g,"");if(t==void 0)return;const n=a[t]||"§k";D(n)}),{passive:false})}));var se=false;var ie=false;function ae(){if(se){ie=true}else{se=true;setTimeout((()=>{le();se=false;if(ie){ie=false;ae()}}),f)}}function le(){const e=$("#shishiji-overview").scrollTop();z(E,false,e,void 0,true,true,void 0,true)}document.getElementById("main-editor")?.addEventListener("input",(function(e){const t=$("#main-editor");if(t.text().includes("\t")){t.html(q($("#main-editor").html()).replace(/ /g,"&nbsp;")).trigger("blur")}_=true;$("#sv_msg").text("");H();const n=document.getElementById("main-editor")?.innerHTML;if(w<s.raw.length-1){s.raw.splice(w+1)}if(n&&s.raw.slice(-1)[0]!==n)s.raw.push(n);w=s.raw.length-1;Q();E.article.content=X(this.innerHTML);if(O.instapreview)le();else ae();if(!Z())_=false;oe()}));document.getElementById("main-editor")?.addEventListener("keydown",(function(e){const t=e.key.toUpperCase();if(t==="TAB"){e.preventDefault();D("    ")}}),{passive:false});T++;P(T*100/N);document.getElementById("smthElse")?.addEventListener("click",(function(e){Popup.popupContent(`\n        <div class="protected aioshud" id="ppupds" style="display:flex;align-items:center;justify-content:center;flex-flow:column;">\n            <h4 style="padding-top: 5px;">テーマカラー</h4>\n            <input type="color" id="theme_color_picker" value="${E.article.theme_color}">\n            <hr class="dhr-ppo rsgafwad">\n            <h4>フォント</h4>\n            <select id="font_family_input">\n                <option value="">標準</option>\n                <option value="Horror">ホラー</option>\n                <option value="Handwritten">手書き風</option>\n                <option value="Calligraphed">筆記体</option>\n            </select>\n            <div style="width: 95%;margin-top:8px;">\n                <div class="oodAOIj">\n                    <div class="oodaji">\n                        <span style="font-size:12px;" class="flxxt">\n                            <p>標準</p>\n                            <div class="code-pre ASOKJjmm">\n                                <span class="sheart40">§q</span>\n                            </div>\n                        </span>\n                        <div id="sans-serif-pre" class="jkhafuis">\n                            <span class="sheart36">あいう 亜伊卯 abc 123</span>\n                        </div>\n                    </div>\n                    <div class="oodaji">\n                        <span style="font-size:12px;" class="flxxt">\n                            <p>ホラー</p>\n                            <div class="code-pre ASOKJjmm">\n                                <span class="sheart40">§w</span>\n                            </div>\n                        </span>\n                        <div id="horror-pre" class="jkhafuis">\n                            <span class="sheart37">あいう 亜伊卯 abc 123</span>\n                        </div>\n                    </div>\n                    <div class="oodaji">\n                        <span style="font-size:12px;" class="flxxt">\n                            <p>手書き風</p>\n                            <div class="code-pre ASOKJjmm">\n                                <span class="sheart40">§t</span>\n                            </div>\n                        </span>\n                        <div id="handwritten-pre" class="jkhafuis">\n                            <span class="sheart38">あいう 亜伊卯 abc 123</span>\n                        </div>\n                    </div>\n                    <div class="oodaji">\n                        <span style="font-size:12px;" class="flxxt">\n                            <p>筆記体</p>\n                            <div class="code-pre ASOKJjmm">\n                                <span class="sheart40">§u</span>\n                            </div>\n                        </span>\n                        <div id="calligraphed-pre" class="jkhafuis">\n                            <span class="sheart39">あいう 亜伊卯 abc 123</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <hr class="dhr-ppo rsgafwad">\n            <h4>中心学年</h4>\n            <select id="core_grade_input">\n                <option value="...">特になし</option>\n                <option value="1年生">1年生</option>\n                <option value="2年生">2年生</option>\n                <option value="3年生">3年生</option>\n                <option value="4年生">4年生</option>\n                <option value="5年生">5年生</option>\n                <option value="6年生">6年生</option>\n            </select>\n            <hr class="dhr-ppo rsgafwad">\n            <h4>ヘッダー画像; (5:2)</h4>\n            <input type="text" id="header_path_input" value="${E.article.images.header}" placeholder="ファイル名">\n            <hr class="dhr-ppo rsgafwad">\n            <h4>アイコン画像; (1:1)</h4>\n            <input type="text" id="icon_path_input" value="${E.object.images.icon}" placeholder="ファイル名">\n            <hr class="dhr-ppo rsgafwad">\n            <button id="save_data_else" class="ppu-decb"><h4 id="save_data_else_www">保存</h4></button>\n            <h4 id="others---meg"></h4>\n        </div>\n        `,(()=>{const e=document.getElementById("save_data_else_www")||document.createElement("span"),n="保存";function o(){e.remove();Popup.removeCloseListener(o)}Popup.addCloseListener(o);for(const e of document.querySelectorAll("option")){if(e.parentElement?.id=="font_family_input"&&e.value===E.article.font_family||e.parentElement?.id=="core_grade_input"&&e.value===E.article.core_grade){e.selected=true}}var s={a:0};document.getElementById("save_data_else")?.addEventListener("click",(function(o){const i=document.getElementById("theme_color_picker")?.value||"#ffffff";const a=document.getElementById("font_family_input")?.value||"";const l=document.getElementById("core_grade_input")?.value||"特になし";var c=document.getElementById("venue_input")?.value||"";var r=document.getElementById("header_path_input")?.value.replace(" ","")||"";var d=document.getElementById("icon_path_input")?.value.replace(" ","")||"";if($(e).text()=="保存しています")return;const p=[r,d];if(p.some((e=>e.includes("/")||!e.includes(".")&&e.length>0))){clearTimeout(s.a);$(e).text("画像に誤りがあります").css("color","red");s.a=setTimeout((()=>{$(e).text(n).css("color","black")}),3e3);return}E.article.theme_color=i;E.article.font_family=a;E.article.core_grade=l;E.article.venue=c;E.article.images.header=r;E.object.images.icon=d;$(e).text("保存しています").css("color","orange");setTimeout((()=>{$.post("/org/manage/edit/saveothers",{session:t,nmap:JSON.stringify(E)}).done((t=>{C=E;clearTimeout(s.a);$(e).text("保存しました").css("color","green");M(true);s.a=setTimeout((()=>{$(e).text(n).css("color","black")}),3e3)})).catch((t=>{clearTimeout(s.a);$(e).text("失敗しました").css("color","red");s.a=setTimeout((()=>{$(e).text(n).css("color","black")}),3e3)}))}),250)}))}),{width:500,height:620,forceclosebutton:true})}));T++;P(T*100/N);document.getElementById("logout__")?.addEventListener("click",(()=>{Popup.popupContent(`\n        <div class="protected aioshud" id="ppupds" style="display: flex; align-items: center; justify-content: center;">\n            <span style="display: flex; align-items: center; flex-direction: column;">\n                <h2>ついでにログアウトしますか？</h2>\n                    <p id="--logout-adjustmsg"></p>\n                    <span style="height: 20px;"></span>\n                    <button id="--yesilogout" style="color:${S?"orange":"black"}">${S?"ログアウト中":"ログアウト"}</button>\n                    <hr style="width:100px;margin:10px">\n                    <button id="byebyebyebye" style="color:black">MENU へ</button>\n            </span>\n        </div>`,(function(){if(_){$("#--logout-adjustmsg").text("保存していない変更があります").css("margin-top","10px").css("color","red")}document.getElementById("byebyebyebye")?.addEventListener("click",(function(){window.location.href="/org/manage/menu"}));document.getElementById("--yesilogout")?.addEventListener("click",(function(){if(S){PictoNotifier.notify("error","Already logging out");return}$(this).text("ログアウト中").css("color","purple");setTimeout((()=>{A.call(this)}),5)}))}),{width:400,height:300})}));document.getElementById("save_data_norm")?.addEventListener("click",(function(){clearTimeout(x);te.apply(this)}));document.getElementById("__undo_-")?.addEventListener("click",(function(){if(w<=0)return;w--;$("#main-editor").html(s.raw[w]);M(false,true);Z();oe()}));document.getElementById("__redo_-")?.addEventListener("click",(function(){if(w>=s.raw.length-1)return;w++;$("#main-editor").html(s.raw[w]);M(false,true);Z();oe()}));window.addEventListener("resize",(function(e){const t=document.getElementById("editsplitter").clientHeight;const n=document.getElementById("--ppo").clientWidth;const o={height:t*.8,width:t*.8*.46};if(o.width>n-20){o.width=n-20;o.height=o.width*2.16}$("#article-preview").css("transform","scale("+o.width/430+")")}));window.dispatchEvent(new Event("resize"));setInterval((()=>{window.dispatchEvent(new Event("resize"))}),500);window.addEventListener("keydown",(function(e){const t=e.key.toUpperCase();if(e.ctrlKey||e.metaKey){switch(t){case"S":e.preventDefault();const t=this.document.getElementById("save_data_else");if(t){t.dispatchEvent(new Event("click"))}else{if(!ee())return;clearTimeout(x);PictoNotifier.notifySave("保存しています...",{duration:3e4,deny_userclose:true});te.call(document.getElementById("save_data_norm"),void 0,(()=>{PictoNotifier.notify("save","保存しました")}),(()=>{Z();PictoNotifier.notify("error","保存に失敗しました")}))}break;case"Z":if(Popup.isPoppingup)break;e.preventDefault();$("#__undo_-").trigger("click");M(false,true);break;case"Y":if(Popup.isPoppingup)break;e.preventDefault();$("#__redo_-").trigger("click");M(false,true);break}}}),{passive:false});$("#--art-header").on("error",(function(){R.call(this,"h")})).attr("src","");$("#--art-icon").on("error",(function(){R.call(this,"i")})).attr("src","");M(true);T++;P(T*100/N);document.getElementById("addImageb")?.addEventListener("click",(e=>{Popup.popupContent(`\n        <div class="protected" id="ppupds" style="display: flex; align-items: center; flex-flow: column;">\n            <h2 style="padding-top: 30px;">写真を挿入</h2>\n            <h4 id="__caut_imad"></h4>\n            <hr class="dhr-ppo">\n            <h4>ファイル名</h4>\n            <input id="addImg_path_" type="text" style="margin-bottom: 20px;" placeholder="ファイル名"></input>\n            <h4>写真の幅(画面の横幅に対する %)</h4>\n            <input id="addImg_width_" type="text" placeholder="0 ~ 100" value="100"></input>\n            <hr class="dhr-ppo">\n            <button id="insertImgb" class="ppu-decb"><h4>追加</h4></button>\n            <h4 id="others---meg"></h4>\n        </div>\n        `,(function(){var e={a:0};var t=0;document.getElementById("insertImgb")?.addEventListener("click",(function(){var t=q(document.getElementById("addImg_path_")?.value.replace(" ",""))||"";var n=document.getElementById("addImg_width_")?.value.replace(" ","")||"";function o(t){clearTimeout(e.a);$("#others---meg").text(t).css("color","red");e.a=setTimeout((()=>{$("#others---meg").text("")}),3e3)}if(t.length<1||n.length<1){$("#__caut_imad").text("埋めていない箇所があります").css("color","red");return}n=Number(n);if(isNaN(n)||n>100||n<0){o("幅に誤りがあります( 0 < 幅 < 100 )");return}$("#__caut_imad").text("");const s=`∫:IMG-S=${t}-W=${n};∫`;Popup.disPop();D(s)}))}),{height:375})}));document.getElementById("addVideob")?.addEventListener("click",(e=>{Popup.popupContent(`\n        <div class="protected" id="ppupds" style="display: flex; align-items: center; flex-flow: column;">\n            <h2 style="padding-top: 30px;">動画を挿入</h2>\n            <h4 id="__caut_imad"></h4>\n            <hr class="dhr-ppo">\n            <h4>ファイル名</h4>\n            <input id="addImg_path_" type="text" style="margin-bottom: 20px;" placeholder="ファイル名"></input>\n            <h4>動画の幅(画面の横幅に対する %)</h4>\n            <input id="addImg_width_" type="text" placeholder="0 ~ 100" value="100"></input>\n            <hr class="dhr-ppo">\n            <button id="insertImgb" class="ppu-decb"><h4>追加</h4></button>\n            <h4 id="others---meg"></h4>\n        </div>\n        `,(function(){var e={a:0};document.getElementById("insertImgb")?.addEventListener("click",(function(){var t=q(document.getElementById("addImg_path_")?.value.replace(" ",""))||"";var n=document.getElementById("addImg_width_")?.value.replace(" ","")||"";function o(t){clearTimeout(e.a);$("#others---meg").text(t).css("color","red");e.a=setTimeout((()=>{$("#others---meg").text("")}),3e3)}if(t.length<1||n.length<1){$("#__caut_imad").text("埋めていない箇所があります").css("color","red");return}n=Number(n);if(isNaN(n)||n>100||n<0){o("幅に誤りがあります( 0 < 幅 < 100 )");return}$("#__caut_imad").text("");const s=`∫:VIDEO-S=${t}-W=${n};∫`;Popup.disPop();D(s)}))}),{height:375})}));document.getElementById("addLinkb")?.addEventListener("click",(e=>{Popup.popupContent(`\n        <div class="protected" id="ppupds" style="display: flex; align-items: center; flex-flow: column;">\n            <h2 style="padding-top: 30px;">リンクを挿入</h2>\n            <h4 id="__caut_imad"></h4>\n            <hr class="dhr-ppo">\n            <h4>URL</h4>\n            <input id="addLink_url_" type="text" style="margin-bottom: 20px;" placeholder="https?://"></input>\n            <h4>テキスト</h4>\n            <input id="addLink_text_" type="text" style="margin-bottom: 20px;" placeholder="任意"></input>\n            <hr class="dhr-ppo">\n            <button id="insertLinkb" class="ppu-decb"><h4>追加</h4></button>\n            <h4 id="others---meg"></h4>\n        </div>\n        `,(function(){var e={a:0};const t=/^https?:\/\/(?:(?!-T=).)+$/;document.getElementById("insertLinkb")?.addEventListener("click",(function(){var n=q(document.getElementById("addLink_url_")?.value.replace(/ /g,"").replace(/θ/g,"%CE%B8"))||"";var o=q(document.getElementById("addLink_text_")?.value)||"";function s(t){clearTimeout(e.a);$("#others---meg").text(t).css("color","red");e.a=setTimeout((()=>{$("#others---meg").text("")}),3e3)}if(n.length<1){$("#__caut_imad").text("URLを入力してください").css("color","red");return}if(!t.test(n)){$("#__caut_imad").text("無効なURLです").css("color","red");return}$("#__caut_imad").text("");const i=`#:LINK-H=${n}-T=${o};#`;Popup.disPop();D(i)}))}),{height:400})}));T++;P(T*100/N);function ce(e){const t=e.files;const o=e.totalsize;const s=e.sizemap;const i=Math.ceil(o*100)/100;n.maxsize=e.mxcs;t.map((e=>toOrgFilepath(b,e)));$("#orgcloud-filelist").empty();var a="lightgreen";if(o>=n.maxsize){a="red"}else if(o>=n.maxsize*3/4){a="orange"}else if(o>=n.maxsize/2){a="yellow"}$("#--cloud-desc").html(`<span style="color: lightgreen;">${n.maxsize.toLocaleString()}MB</span> まで使用できます&nbsp;(<span style="color: ${a};">${i.toLocaleString()}</span>/${n.maxsize.toLocaleString()})`);var l="";for(const e of t){const t=getMediaType(e);const n=toOrgFilepath(b,e);const o="?"+(new Date).getTime();switch(t){case"image":l+=`\n                    <div class="cloud-file-el">\n                        <div class="cloudfileele" uname="${e}">\n                            <img class="cloudfileel cloudsh" src="${n+o}" uname="${e}">\n                            <h4 class="cloudfileel">${e}</h4>\n                            <p class="cloudfileel" style="font-size: 75%;">${Math.ceil(s[e]*1e3)/1e3}MB</p>\n                        </div>\n                    </div>`;break;case"video":l+=`\n                    <div class="cloud-file-el">\n                        <div class="cloudfileele" uname="${e}">\n                            <video class="cloudfileel cloudsh" uname="${e}" src="${n+o}#t=0.001" controls preload="metadata" playsinline></video>\n                            <h4 class="cloudfileel">${e}</h4>\n                            <p class="cloudfileel" style="font-size: 75%;">${Math.ceil(s[e]*1e3)/1e3}MB</p>\n                        </div>\n                    </div>`;break}}if(!l){l='<div class="flxxt" style="width:100%;height:100%;"><div><h2>クラウドが空っぽです！</h2><h4>右下のボタンからアップロードしましょう</h4></div></div>'}$("#orgcloud-filelist").append(l).scrollTop(0);$(".cloudfileele").on("click",(()=>{}))}T++;P(T*100/N);function re(e){const n=e.files;var o="30万集めてアプリ内広告をなくしたいので、募金をしてくれた団体には5000円で2000MB増量いたします。5年E組までお越しください。";if(E.article.title.includes("ちぎり絵")||E.article.title.includes("3年"))o="アプリ内広告邪魔だよね！！ほんとむかつく！！";if(n&&Popup.isPoppingup){Popup.popupContent(`\n            <div class="protected --posa" id="ppupds">\n                <h4 style="padding-top: 20px;">あなたの団体(${b})のクラウド</h4>\n                <p id="--cloud-desc"></p>\n                <p style="font-size: 15%;">${o}</p>\n                <hr class="dhr-ppo" style="margin: 5px 0 10px 0;">\n                <p style="margin-bottom: 5px; color: #b7b7b7;">クリックしてファイル名をコピー</p>\n                <div id="orgcloud-filelist">\n    \n                </div>\n                <div class="flxxt">\n                    <div class="ertxs">\n                        <button id="uploadfb" class="ppu-decb" style="margin-top: 5px; color: black;"><h4 id="uploadfbh">アップロード</h4></button>\n                        <input type="file" id="uploadfi" style="margin: 10px; margin-top: 5px;" accept="${u.join(",")}">\n                    </div>\n                    <div class="ertxs">\n                        <button id="deletefb" class="ppu-decb" style="margin-top: 5px; color: black;"><h4 id="deletefbh">削除</h4></button>\n                        <input type="text" id="deletefi" style="margin: 10px; margin-top: 5px;" placeholder="削除するファイル名">\n                    </div>\n                </div>\n            </div>`,(function(){ce(e);const n={a:0,b:0};document.getElementById("uploadfb")?.addEventListener("click",(e=>{var o=document.getElementById("uploadfi").files[0];if($("#uploadfbh").text()!="アップロード"){return}clearTimeout(n.a);if(o){clearTimeout(n.a);if(getMediaType(o.name)=="unknown"){$("#uploadfbh").text("ファイル形式が無効です").css("color","red");n.a=setTimeout((()=>{$("#uploadfbh").text("アップロード").css("color","black")}),3e3);return}$("#uploadfbh").text("アップロード中...").css("color","orange");setTimeout((()=>{const e=new FormData;e.append("file",o);e.append("session",t||"");$.when($.post("/org/manage/file/overflow",{session:t,size:o.size})).done((function(t){const o=t.acceptable,i=t.overflow;if(o){$.when($.ajax({url:"/org/manage/file/upload",type:"POST",data:e,processData:false,contentType:false})).done((function(e){const t=$("#shishiji-overview").scrollTop();ce(e);M(true,true,true);PictoNotifier.notify("success",`${e.uploaded} をアップロードしました`,{duration:5e3,discriminator:"file uploaded",do_not_keep_previous:true});$("#uploadfbh").text("アップロードに成功").css("color","green");n.a=setTimeout((()=>{$("#uploadfbh").text("アップロード").css("color","black")}),2500);document.getElementById("uploadfi").value=""})).fail((function(e){const t=e.responseJSON;if(e.status==413&&t.overflow!==void 0){s.call(null,t.overflow)}else{$("#uploadfbh").text("エラー").css("color","red");n.a=setTimeout((()=>{$("#uploadfbh").text("アップロード").css("color","black")}),5e3)}}))}else{s.call(null,i)}})).catch((function(){$("#uploadfbh").text("エラー").css("color","red");n.a=setTimeout((()=>{$("#uploadfbh").text("アップロード").css("color","black")}),5e3)}));function s(e){e=Math.ceil(e*1e4)/1e4;PictoNotifier.notify("error",`クラウドに ${e}MB 容量が足りません`,{duration:5e3,discriminator:"Cloud is overflowing!",do_not_keep_previous:true,deny_userclose:true});$("#uploadfbh").text(`${e}MB 容量が足りません`).css("color","red");n.a=setTimeout((()=>{$("#uploadfbh").text("アップロード").css("color","black")}),5e3)}}),500)}else{$("#uploadfbh").text("ファイルが選択されていません").css("color","red");n.a=setTimeout((()=>{$("#uploadfbh").text("アップロード").css("color","black")}),1500)}}));document.getElementById("deletefb")?.addEventListener("click",(e=>{var o=(document.getElementById("deletefi").value||"").split(" "),s=o;if($("#deletefbh").text()=="削除しています"){return}clearTimeout(n.b);if(o.length==0){$("#deletefbh").text("ファイル名を入力してください").css("color","red");n.b=setTimeout((()=>{$("#deletefbh").text("削除").css("color","black")}),1500);return}const i=[];var a=false;Array.from(document.getElementsByClassName("cloudsh")).forEach((e=>{i.push(e.getAttribute("uname"))}));o=o.filter((e=>e.length>0));o.forEach((e=>{if(!i.includes(e)){const t="file: "+e+" not found",n={duration:1e3};if(!a){Notifier.clearPengings();Notifier.notifyHTML(t,n);a=true}else{Notifier.appendPending({html:t,options:n})}o=o.filter((t=>t!==e))}}));if(o.length==0){var l="削除できるファイルがありません";if(s.every((e=>e.length==0)))l="ファイル名を入力してください";clearTimeout(n.b);$("#deletefbh").text(l).css("color","red");n.b=setTimeout((()=>{$("#deletefbh").text("削除").css("color","black")}),1500);return}$("#deletefbh").text("削除しています").css("color","orange");setTimeout((()=>{$.post("/org/manage/file/delete",{session:t,files:JSON.stringify(o)}).done((e=>{ce(e);M(true,true,true);const t=e.deleted;for(const e of t){if(e===t[0]){var o=1e3;if(t.length==1)o=3e3;Notifier.clearPengings();PictoNotifier.notify("success",`${e} を削除しました`,{duration:o,discriminator:"file deleted",do_not_keep_previous:true})}else{PictoNotifier.notify("success",`${e} を削除しました`,{duration:1e3,discriminator:"file deleted",addToPending:true})}}$("#deletefbh").text("削除に成功").css("color","green");n.b=setTimeout((()=>{$("#deletefbh").text("削除").css("color","black")}),5e3);document.getElementById("deletefi").value=""})).catch((e=>{$("#deletefbh").text("エラー").css("color","red");n.b=setTimeout((()=>{$("#deletefbh").text("削除").css("color","black")}),3e3)}))}),500)}))}),{width:1200,height:1200})}}function de(e){const t=TEXTS[LANGUAGE].ERROR_ANY;if(e.statusText!="abort")PictoNotifier.notify("error",TEXTS[LANGUAGE].NOTIFICATION_ERROR_ANY,{duration:2500,discriminator:"sharePopup connection error",do_not_keep_previous:true,deny_userclose:true});if(Popup.isPoppingup)Popup.showasError(t)}T++;P(T*100/N);document.getElementById("manageFileb")?.addEventListener("click",(function(){Popup.startLoad({width:1200,height:1200});var e;const n=setTimeout((()=>{e=$.post("/org/manage/file/list",{session:t});e.done(re).catch(de)}),500);function o(){if(e)e.abort();clearTimeout(n);Popup.removeCloseListener(o)}Popup.addCloseListener(o)}));T++;P(T*100/N);window.addEventListener("click",(function(e){const t=e.target;const n=$(t);if(n.hasClass("cloudfileel")){const l=n.parent().attr("uname");if(l){window.navigator.clipboard.writeText(l);PictoNotifier.notify("link",`${l} をコピーしました`,{duration:2500,discriminator:l})}}else if($(t).hasClass("article-image")){const c=t.getAttribute("src");if(c){const r=`${GPATH.X}<img class="suhDWAgd" src="${c}">`;const d=t.cloneNode();function o(){const e=document.getElementById("shishiji-popup-container-cn");return e?.clientHeight!=0?true:false}function s(){if(o())i()}function i(){window.removeEventListener("keydown",a);$("#ppcls").off("click",i);$("shishiji-mx-overlay-n").removeClass("popen").addClass("pipe").off("click",s);$("#shishiji-popup-container-cn").hide().empty()}function a(e){const t=e.key.toUpperCase();if(Popup.closeKeys.includes(t)){s()}}$(d).attr("id","").attr("class","suhDWAgd").attr("style","");new Promise(((e,t)=>{this.window.addEventListener("keydown",a);$("shishiji-mx-overlay-n").removeClass("pipe").addClass("popen").on("click",s);$("#shishiji-popup-container-cn").addClass("flxxt").css("height","fit-content").css("overflow","visible").html(GPATH.X).append(d).show();e("")})).then((()=>{$("#ppcls").css("top","-40px").css("right","0").on("click",i);$($($("#ppcls").children()[0]).children()[0]).attr("fill","blue")}))}}}));window.addEventListener("dblclick",(function(e){e.preventDefault()}),{passive:false});window.addEventListener("beforeunload",(e=>{if(_||Popup.isPoppingup&&$("#ppupds").hasClass("aioshud")){e.preventDefault();const t="このページを離れてもよろしいですか？\n編集データは自動では保存されません。";e.returnValue=t;return t}}),{passive:false});T++;P(T*100/N);function pe(e){e.solidObject=e.colorEditor||e.solidObject;return{[AUTOSAVEKEY]:e.autosave,[AUTOSAVENOTIFICATIONKEY]:e.autosaveNotification,[COLOREDITORKEY]:e.colorEditor,[INSTAPREVIEWKEY]:e.instapreview,[QUICKINPUTNOTIFICATIONKEY]:e.quickInputNotification,[VISIBLESPACEKEY]:e.visibleSpace,[VISIBLEONLYENDSPACEKEY]:e.visibleOnlyEndSpace,[SOLIDOBJECTKEY]:e.solidObject,[_SOLIDOBJECTKEY]:e._solidObject}}function ue(){setLocalStorage(EDITORCONFIGKEY,JSON.stringify(pe(O)))}document.getElementById("editorSettings")?.addEventListener("click",(function(){const e={half:{none:`<span class="sheart0">I&nbsp;love&nbsp;tomatos&nbsp;&nbsp;&nbsp;</span>`,visibleAllSpace:`<span class="sheart0">I·love·tomatos···</span>`.replace(/·/g,`<span class="sheart35">·</span>`),visibleOnlyEndSpace:`<span class="sheart0">I love tomatos···</span>`.replace(/·/g,`<span class="sheart35">·</span>`)},full:{none:`<span class="sheart0">あなた　好き　　</span>`,visibleAllSpace:`<span class="sheart0">あなた・好き・・</span>`.replace(/・/g,`<span class="sheart35">・</span>`),visibleOnlyEndSpace:`<span class="sheart0">あなた　好き・・</span>`.replace(/・/g,`<span class="sheart35">・</span>`)}};const t=(e,t)=>{const n=document.createElement("input");n.id=e;n.className="toggle_input";n.type="checkbox";if(t)n.checked=true;const o=document.createElement("label");o.htmlFor=e;o.className="toggle_label";const s=document.createElement("div");s.className="toggle_button";s.appendChild(n);s.appendChild(o);return s};const n=document.createElement("div");n.className="protected";n.id="ppupds";n.style.display="flex";n.style.alignItems="center";n.style.justifyContent="center";n.style.flexFlow="column";const o=document.createElement("h2");o.textContent="エディターの設定";n.appendChild(o);const s=document.createElement("p");s.textContent="****";n.appendChild(s);const i=document.createElement("hr");i.className="dhr-ppo rsgafwad";n.appendChild(i);const a=document.createElement("div");a.className="flxxt";const l=document.createElement("div");l.className="okjoipjiok konogt";const c=document.createElement("h4");c.textContent="配色";l.appendChild(c);l.appendChild(t("editorcolor_tg",O.colorEditor));a.appendChild(l);const r=document.createElement("div");r.className="okjoipjiok konogt";const d=document.createElement("h4");d.textContent="オートセーブ";r.appendChild(d);r.appendChild(t("autosave_tg",O.autosave));a.appendChild(r);const p=document.createElement("div");p.className="okjoipjiok konogt";const u=document.createElement("h4");u.textContent="即時プレビュー";p.appendChild(u);const m=document.createElement("t");m.style.fontSize="8px";m.textContent="This may take more battery!!";p.appendChild(m);p.appendChild(t("instapreview_tg",O.instapreview));a.appendChild(p);n.appendChild(a);n.appendChild(i.cloneNode(true));const f=document.createElement("h4");f.textContent="通知";n.appendChild(f);const h=document.createElement("div");h.className="flxxt";const g=document.createElement("div");g.className="okjoipjiok";const v=document.createElement("h4");v.id="autoinput_hh";v.className="prehh";v.textContent="自動入力";g.appendChild(v);g.appendChild(t("quickinputnotification_tg",O.quickInputNotification));h.appendChild(g);const y=document.createElement("div");y.className="okjoipjiok";const b=document.createElement("h4");b.id="autosave_hh";b.className="prehh";b.textContent="オートセーブ";y.appendChild(b);y.appendChild(t("autosavenotification_tg",O.autosaveNotification));h.appendChild(y);n.appendChild(h);n.appendChild(i.cloneNode(true));const E=document.createElement("h4");E.textContent="空白を視覚化";n.appendChild(E);n.appendChild(t("visiblespace_tg",O.visibleSpace));const _=document.createElement("div");_.id="jjjadios";_.className="paOojiA";const x=document.createElement("div");x.className="pprajisda";const w=document.createElement("p");w.style.fontSize="12px";w.textContent="半角スペース";x.appendChild(w);x.appendChild(document.createElement("div")).id="half-width-space-pre";x.className="code-pre";const k=document.createElement("div");k.className="pprajisda";const I=document.createElement("p");I.style.fontSize="12px";I.textContent="各行末のみ";k.appendChild(I);const C=t("visibleonlyendspace_tg",O.visibleOnlyEndSpace);C.style.transform="scale(0.75)";k.appendChild(C);const T=document.createElement("div");T.className="pprajisda";const N=document.createElement("p");N.style.fontSize="12px";N.textContent="全角スペース";T.appendChild(N);T.appendChild(document.createElement("div")).id="full-width-space-pre";T.className="code-pre";_.appendChild(x);_.appendChild(k);_.appendChild(T);n.appendChild(_);n.appendChild(i.cloneNode(true));const L=document.createElement("p");L.id="dspp";L.style.fontSize="12px";n.appendChild(L);const S=document.createElement("div");S.style.width="95%";S.style.marginTop="8px";const A=document.createElement("div");A.id="ADSmdaaa";A.textContent="オブジェクト";S.appendChild(A);const j=document.createElement("div");j.className="oodAOIj";const B=(e,t)=>{const n=document.createElement("div");n.className="oodaji";const o=document.createElement("p");o.style.fontSize="12px";o.textContent=e;const s=document.createElement("div");s.className="code-pre ASOKJjmm";const i=document.createElement("span");i.className=`sheart22 ${e==="リンク"?"sheart24":""}`;i.innerHTML=t;s.appendChild(i);n.appendChild(o);n.appendChild(s);return n};j.appendChild(B("写真",`%:IMG-S=<span class="sheart23">{source}</span>-W=<span class="sheart23">{width}</span>;%`));j.appendChild(B("動画",`%:VIDEO-S=<span class="sheart23">{source}</span>-W=<span class="sheart23">{width}</span>;%`));j.appendChild(B("リンク",`θ:LINK-H=<span class="sheart25">{URL}</span>-T=<span class="sheart25">{text}</span>;θ`));S.appendChild(j);n.appendChild(S);Popup.popupContent(`<div class="protected" id="ppupds" style="display:flex;align-items:center;justify-content:center;flex-flow:column;">\n            <h2>エディターの設定</h2><p>****</p>\n            <hr class="dhr-ppo rsgafwad">\n            <div class="flxxt">\n                <div class="okjoipjiok konogt">\n                    <h4>配色</h4>\n                    <div class="toggle_button">\n                        <input id="editorcolor_tg" class="toggle_input" type="checkbox" ${O.colorEditor?"checked":""}>\n                        <label for="toggle" class="toggle_label"></label>\n                    </div>\n                </div>\n                <div class="okjoipjiok konogt">\n                    <h4>オートセーブ</h4>\n                    <div class="toggle_button">\n                        <input id="autosave_tg" class="toggle_input" type="checkbox" ${O.autosave?"checked":""}>\n                        <label for="toggle" class="toggle_label"></label>\n                    </div>\n                </div>\n                <div class="okjoipjiok konogt">\n                    <h4>即時プレビュー</h4>\n                    <t style="font-size:8px;">This may take more battery!!</t>\n                    <div class="toggle_button">\n                        <input id="instapreview_tg" class="toggle_input" type="checkbox" ${O.instapreview?"checked":""}>\n                        <label for="toggle" class="toggle_label"></label>\n                    </div>\n                </div>\n            </div>\n            <hr class="dhr-ppo rsgafwad">\n            <h4>通知</h4>\n            <div class="flxxt">\n                <div class="okjoipjiok">\n                    <h4 id="autoinput_hh" class="prehh">自動入力</h4>\n                    <div class="toggle_button">\n                        <input id="quickinputnotification_tg" class="toggle_input" type="checkbox" ${O.quickInputNotification?"checked":""}>\n                        <label for="toggle" class="toggle_label"></label>\n                    </div>\n                </div>\n                <div class="okjoipjiok">\n                    <h4 id="autosave_hh" class="prehh">オートセーブ</h4>\n                    <div class="toggle_button">\n                        <input id="autosavenotification_tg" class="toggle_input" type="checkbox" ${O.autosaveNotification?"checked":""}>\n                        <label for="toggle" class="toggle_label"></label>\n                    </div>\n                </div>\n            </div>\n            <hr class="dhr-ppo rsgafwad">\n            <h4>空白を視覚化</h4>\n            <div class="toggle_button">\n                <input id="visiblespace_tg" class="toggle_input" type="checkbox" ${O.visibleSpace?"checked":""}>\n                <label for="toggle" class="toggle_label"></label>\n            </div>\n            <div id="jjjadios" class="paOojiA">\n                <div class="pprajisda">\n                    <p style="font-size:12px;">半角スペース</p>\n                    <div id="half-width-space-pre" class="code-pre"></div>\n                </div>\n                <div class="pprajisda">\n                    <p style="font-size:12px;">各行末のみ</p>\n                    <div id="dAWsdang" class="toggle_button" style="transform:scale(0.75);">\n                        <input id="visibleonlyendspace_tg" class="toggle_input" type="checkbox" ${O.visibleOnlyEndSpace?"checked":""}>\n                        <label for="toggle" class="toggle_label"></label>\n                    </div>\n                </div>\n                <div class="pprajisda">\n                    <p style="font-size:12px;">全角スペース</p>\n                    <div id="full-width-space-pre" class="code-pre"></div>\n                </div>\n            </div>\n            <hr class="dhr-ppo rsgafwad">\n            \x3c!--h4>オブジェクトをブロック化</h4>\n            <div class="toggle_button ${O.colorEditor?"brunotoggl":""}" id="ASDpadSS">\n                <input id="solidobject_tg" class="toggle_input" type="checkbox" ${O.colorEditor||O.solidObject?"checked":""}>\n                <label for="toggle" class="toggle_label"></label>\n            </div--\x3e\n            <p id="dspp" style="font-size:12px;"></p>\n            <div style="width: 95%;margin-top:8px;">\n                <div id="ADSmdaaa">\n                    オブジェクト\n                </div>\n                <div class="oodAOIj">\n                    <div class="oodaji">\n                        <p style="font-size:12px;">写真</p>\n                        <div class="code-pre ASOKJjmm">\n                            <span class="sheart22">%:IMG-S=<span class="sheart23">{source}</span>-W=<span class="sheart23">{width}</span>;%</span>\n                        </div>\n                    </div>\n                    <div class="oodaji">\n                        <p style="font-size:12px;">動画</p>\n                        <div class="code-pre ASOKJjmm">\n                            <span class="sheart22">%:VIDEO-S=<span class="sheart23">{source}</span>-W=<span class="sheart23">{width}</span>;%</span>\n                        </div>\n                    </div>\n                    <div class="oodaji">\n                        <p style="font-size:12px;">リンク</p>\n                        <div class="code-pre ASOKJjmm">\n                            <span class="sheart24">θ:LINK-H=<span class="sheart25">{URL}</span>-T=<span class="sheart25">{text}</span>;θ</span>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>`,(function(){function t(){ue();H()}function n(){const e=document.getElementById("dAWsdang");const t=document.getElementById("jjjadios");if(O.visibleSpace){e?.classList.remove("brunotoggl_");t?.classList.remove("brunotoggl")}else{e?.classList.add("brunotoggl_");t?.classList.add("brunotoggl")}}function o(){const t=$("#half-width-space-pre"),n=$("#full-width-space-pre");if(O.visibleOnlyEndSpace){t.html(e.half.visibleOnlyEndSpace);n.html(e.full.visibleOnlyEndSpace)}else{t.html(e.half.visibleAllSpace);n.html(e.full.visibleAllSpace)}}function s(){const e=$("#dspp");if(O.colorEditor){e.text("配色が有効の場合は常に有効になります").css("color","orange").css("visibility","visible")}else{e.text("ブロック内では改行が無効になります").css("color","lightgreen").css("visibility","visible")}}function i(){const e=document.getElementById("ASDpadSS");if(O.colorEditor){e?.classList.add("brunotoggl")}else{e?.classList.remove("brunotoggl")}}document.getElementById("editorcolor_tg")?.addEventListener("input",(function(){O.colorEditor=this.checked?true:false;const e=document.getElementById("solidobject_tg");if(O.colorEditor){O.solidObject=e.checked=true;e?.dispatchEvent(new Event("input"))}else{e.checked=O.solidObject=O._solidObject}s();i();t()}));document.getElementById("autosave_tg")?.addEventListener("click",(function(){O.autosave=this.checked?true:false;oe();t()}));document.getElementById("instapreview_tg")?.addEventListener("click",(function(){O.instapreview=this.checked?true:false;oe();t()}));document.getElementById("quickinputnotification_tg")?.addEventListener("click",(function(){O.quickInputNotification=this.checked?true:false;t()}));document.getElementById("autosavenotification_tg")?.addEventListener("click",(function(){O.autosaveNotification=this.checked?true:false;t()}));document.getElementById("visiblespace_tg")?.addEventListener("input",(function(){O.visibleSpace=this.checked?true:false;n();o();t()}));document.getElementById("visibleonlyendspace_tg")?.addEventListener("click",(function(){if(!O.visibleSpace){this.checked=O.visibleOnlyEndSpace;return}O.visibleOnlyEndSpace=this.checked?true:false;o();t()}));document.getElementById("solidobject_tg")?.addEventListener("input",(function(e){if(O.colorEditor){this.checked=O.solidObject=true;return}O.solidObject=O._solidObject=this.checked?true:false;s();t()}));n();o();i();s()}),{width:600,height:650})}));ue();T++;P(T*100/N);function me(e){$("#promax-container").css("transform",`scale(${y.zooms.ratio})`);if(e){var t=y.zooms.ratio>1?gglSymbols.zoom_in:gglSymbols.zoom_out;y.zooms.ratio===1?t=gglSymbols.search:void 0;Notifier.notifyHTML(`<div class="flxxt aosdosd">${t} x${Math.floor(y.zooms.ratio*100)}% <button id="zoom_resetter" class="notifier-btn">リセット</button></div>`,{duration:2e3,discriminator:"pvtransition",do_not_keep_previous:true})}}function fe(e){const t=y.zooms.ratios.indexOf(y.zooms.ratio);y.zooms.ratio=e==="in"?typeof y.zooms.ratios[t+1]==="undefined"?y.zooms.ratios[y.zooms.ratios.length-1]:y.zooms.ratios[t+1]:typeof y.zooms.ratios[t-1]==="undefined"?y.zooms.ratios[0]:y.zooms.ratios[t-1];me(true)}window.addEventListener("wheel",(function(e){if(e.ctrlKey||e.metaKey){e.preventDefault();fe(e.deltaY<0?"in":"out")}}),{passive:false});"touchstart mousedown".split(" ").forEach((e=>{addEventListener(e,(function(e){const t=e.target.id;if(t==="zoom_resetter"){y.zooms.ratio=1;me(false)}else if(t==="move_resetter"){y.moves.top=0;he(false)}}))}));function he(e){$("#promax-container").css("top",y.moves.top+"px");if(e){var t=y.moves.top>0?gglSymbols.arrow_downward:gglSymbols.arrow_upward;y.moves.top===0?t=gglSymbols.height:void 0;Notifier.notifyHTML(`<div class="flxxt aosdosd">${t} ${Math.abs(y.moves.top)}px (resized?) <button id="move_resetter" class="notifier-btn">リセット</button></div>`,{duration:2e3,discriminator:"pvtransition",do_not_keep_previous:true})}}function ge(e){y.moves.top+=e==="up"?y.moves.delta:-y.moves.delta;he(true)}function ve(){setLocalStorage(ZOOMRATIOKEY,String(y.zooms.ratio));setLocalStorage(TOPKEY,String(y.moves.top))}const ye=[document.activeElement,document.activeElement];setInterval((()=>{ye.shift();ye.push(document.activeElement)}),250);function be(){if(ye.some((e=>{if(e?.id==="main-editor")return true}))){$("#main-editor").trigger("focus")}ve()}document.getElementById("pvzoom_in")?.addEventListener("click",(function(){fe("in");be()}));document.getElementById("pvzoom_out")?.addEventListener("click",(function(){fe("out");be()}));document.getElementById("pvarrow_upward")?.addEventListener("click",(function(){ge("down");be()}));document.getElementById("pvarrow_downward")?.addEventListener("click",(function(){ge("up");be()}));document.getElementById("pvarrow_power_settings_new")?.addEventListener("click",(function(){y.zooms.ratio=1;y.moves.top=0;me(false);he(false);ve();if(Notifier.current==="pvtransition"){Notifier.closeNotifier()}}));const Ee={up:{active:false,func:function(){ge("up");be()}},down:{active:false,func:function(){ge("down");be()}},ctrl:false};window.addEventListener("keydown",(function(e){const t=e.key.toUpperCase();const n=e.ctrlKey||e.metaKey;function o(){e.preventDefault()}if(t=="ARROWUP"){if(n)o();Ee.up.active=true}else if(t=="ARROWDOWN"){if(n)o();Ee.down.active=true}else if(t=="CONTROL"){Ee.ctrl=true}}),{passive:false});window.addEventListener("keyup",(function(e){const t=e.key.toUpperCase();if(t=="ARROWUP"){Ee.up.active=false}else if(t=="ARROWDOWN"){Ee.down.active=false}else if(t=="CONTROL"){Ee.ctrl=false}}),{passive:false});setInterval((()=>{if(Ee.ctrl){if(Ee.up.active)Ee.up.func();if(Ee.down.active)Ee.down.func()}}),100);me(false);he(false);T++;P(T*100/N);endLoad(void 0,1500);setTimeout((()=>PictoNotifier.notifyInfo(`詳細に新しいテーブルを追加したい場合は<span style="color:#D32F2F">5年E組伊藤舜</span>にお願いしてくださ～い！`,{duration:1e4})),2e3);window.addEventListener("load",(function(e){}));return 0})();