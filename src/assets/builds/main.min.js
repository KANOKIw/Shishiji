(()=>{var t="JA";var e=[null,null];var n=[null,null];const i=document.getElementById("shishiji-canvas");const o=i?.getContext("2d");var s=false;var a=1;const c=.65;const r={login:false,load:false};const d=400;const l={logined:false,sid:null,discriminator:null,data:{completed_orgs:[],profile:{}},pending_collects:[]};const u=[];const h=window.devicePixelRatio;const f=$.post(ajaxpath.eventd);const m=$.post(ajaxpath.alldel);const p=$.post(ajaxpath.progpt);const v=$.post(ajaxpath.specmsi);const g=new Promise((t=>t([1,2,3,4,5,6])))??$.post(ajaxpath.adv);var _=true;"touchstart mousedown".split(" ").forEach((t=>window.addEventListener(t,(()=>_=true),{passive:true})));const w={share:(...t)=>{},close:(...t)=>{},favorite:(...t)=>{},vote:(...t)=>{},evote:(...t)=>{},jetupdater:(...t)=>{}};const y={pkgo:false,article:false,main_screen:false};const E=[];const x=t=>E.push(t);const b={BAND_SCHEDULE_DELAY:NaN,DANCE_SCHEDULE_DELAY:NaN};const C=document.createElement("canvas");const T=C.getContext("2d");var k=26;var L=false;const I=[];const A=function(t,e){if(typeof t!=="number"||typeof e!=="number")return I;else return I[t]?I[t][e]:null};C.canvas={coords:{x:0,y:0},rotation:0};const O={deny:false,scroll:1.05,object:{dynamic_to_static:{over:1.5,under:.3}},caps:{ratio:{max:6.5,min:.15}},touch:{downCD:1,zoomCD:-1,rotate:{min:5}},arrowkeys:{interval:5,move:3,ratio:1.005,nosprint:1.5,nosprintratio:1.0025}};const S=5;var N=0;var R={x:0,y:0,v:0,a:-75,method:null};var j={0:{x:0,y:0},1:{x:0,y:0},a:-150};var M=null;var D=null;var B={x:-1,y:-1,distance:-1};var H={};var X=0;var P=0;var U=false;var W=0;var G=0;var F=0;var Y=0;const q=["不明","すいている","やや混雑","混雑"];var J={};var z={deled:null,feels:[]};var V={};var K={};var Z=()=>{};var Q=1;var tt={middle:[],top:[]};var et=0;var nt=false;var it;var ot={};var st="";const at={fselector:{opened:false,colors:{current:"",else:""}}};const ct='<span class="gglmats">X</span>';const rt={loadging:`<span class="gglmats loading-symbol">progress_activity</span>`,refresh:ct.replace("X","refresh"),height:ct.replace("X","height"),zoom_in:ct.replace("X","zoom_in"),zoom_out:ct.replace("X","zoom_out"),search:ct.replace("X","search"),arrow_upward:ct.replace("X","arrow_upward"),arrow_downward:ct.replace("X","arrow_downward")};const dt={DO_NOTHING:0,CLOSE_ARTICLE:1,INIT_ZOOMRADIO:2,INIT_COORDS:3,INIT_FLOOR:4,DO_EVERYTHING:5};const lt=dt.DO_NOTHING;var ut="";var ht=[];const ft=4;const mt={ZOOM_RATIO:"x",COORDS:"@",ARTICLE_ID:"art",FLOOR:"fr",URL_FROM:"storm",LANGUAGE:"lang",SCROLL_POS:"scrp",ART_TARGET:"atg",LOGIN_DISCRIMINATOR:"glog",LOGIN_CONFIDENCE:"kry",JUMPTO:"jumpto"};const pt={FROM_ARTICLE_SHARE:"attsrh",FROM_NAVIGATE:"navigate"};const vt="disc-{0}";const gt=1.5;const _t=5;const wt={description:()=>{},details:()=>{},commands:()=>{}};const yt={situation:{nickname:false,icon_path:false},saving:false};window.addEventListener("load",(()=>E.forEach((t=>t()))));function Et(t,...e){for(const[n,i]of e.entries()){const e=new RegExp(`\\{${n}\\}`,"g");t=t.replace(e,i)}return t}function $t(t){return t*(Math.PI/180)}function xt(t){return t*(180/Math.PI)}function bt(...t){var e=0;t.forEach((t=>{e+=t}));return e/t.length}function Ct(t,e){return e(t)}function Tt(t){const e=t.getAttribute("coords")?.split(" ").map((t=>Number(t)));return{x:e[0],y:e[1]}}const kt={nextInt:function(t,e){if(t===undefined||e===undefined){if(t!=undefined){e=t;t=0}else{const t=Math.random();return t>.5?1:0}}return Math.floor(Math.random()*(e-t+1))+t},string:function(t){var e="";const n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";const i=n.length;for(let o=0;o<t;o++){e+=n.charAt(Math.floor(Math.random()*i))}return e},randomChoice:function(t){return t[this.nextInt(0,t.length-1)]},shuffleArray(t){for(let e=t.length-1;e>0;e--){const n=Math.floor(Math.random()*(e+1));[t[e],t[n]]=[t[n],t[e]]}return t}};function Lt(t){return t.getAttribute("behavior")}function It(t){const e=t.getAttribute("dfsize")?.split(" ").map((t=>Number(t)));return{width:e[0],height:e[1]}}const At={advs:kt.shuffleArray([1,2,3,4,5,6]),current:1};async function Ot(t,e,n){const i=()=>{if(n){const t=At.current++;$e("map-top",t.toString());Ue.apply(self,[`/resources/img/advertisement/tfn-${At.advs[t]}.png`]);At.current>=At.advs.length?At.current=1:void 0}};if($("#load_spare").css("background-color")=="transparent")$("#load_spare").css("background-color","#15202b");clearTimeout(J.endloadtimeoutswhen);$("#theme-meta").attr("content","#15202b");$("#app-mount").show();$("#user-profile-opner").css("display","flex");$("#loaders").removeClass("bye");$("#load_spare").removeClass("loaddoneman").css("pointer-events","all").show();$("#greatblink").hide();if(e=="first"){$("#greatfrishmountain").addClass("Fdash");$("#greatblink").show().addClass("Ndash");$("#app-version").show();return new Promise(((t,e)=>{setTimeout((()=>{i();t()}),2090)}))}else{$("#map__opnner").show().removeClass("Ldash").addClass("Hdash");$("#greatfrishmountain").removeClass("Gdash Fdash").addClass("Jdash");$("#app-version").hide();return new Promise(((t,e)=>{setTimeout((()=>{i();t()}),250)}))}}function St(t){const e=t.length;const n=Math.floor(Math.random()*e);return t[n]}function Nt(t){}async function Rt(t,e){if(typeof Vn!=="undefined"&&await Vn())_e("1");return new Promise(((t,n)=>{function i(){$("#map__opnner").removeClass("Hdash").addClass("Ldash").show();$("#load_spare").css("background-color","transparent");setTimeout((()=>{$("#greatfrishmountain").addClass("Gdash");$("#greatblink").addClass("Bdash")}),100);setTimeout((()=>$("#loaders").addClass("bye")),500);setTimeout((()=>$("#load_spare").css("pointer-events","none")),750);J.endloadtimeoutswhen=setTimeout((()=>{clearInterval(J.load);$("#load_spare").hide();$("#theme-meta").attr("content","#15202b");$("#greatfrishmountain").removeClass("Gdash");t(void 0)}),1500)}setTimeout.call(window,i,e)}))}function jt(t){var e=0;var n=0;if(t.length<1)return"";t="<mcft-cl>§p"+t;for(var i in MCColorList){var o=t.split("§".concat(i));e+=o.length-1;t=o.join('<mcft-cl style="color: '.concat(MCColorList[i],'">'))}for(var s in MCDec){var a="§".concat(s);while(t.includes(a)){var a="§".concat(s);n++;t=t.replace(a,"<mcft-dec ".concat(MCDec[s],">"));if(t.indexOf("§r")<t.indexOf(a)||t.indexOf(a)==-1){var c="";for(var r=0;r<=e;r++){c+="</mcft-cl>"}for(var r=-2;r<n;r++){c+="</mcft-dec>"}t=t.replace("§r",c);e=0;n=0}}}for(var r=0;r<=e;r++){t+="</mcft-cl>"}for(var r=0;r<n;r++){t+="</mcft-dec>"}return t}function Mt(t,e,n){n??={};const i=n.arg1?n.arg1():void 0;const o=n.arg2?n.arg2():void 0;+function(){var s=0;var a=false;var c=false;function r(e,n){e.split(" ").forEach((e=>{t.addEventListener(e,n)}))}function d(t){s=0;a=true;t.preventDefault();if(n){if(n.forceLeft&&t.button&&t.button!=0)return}}function l(t){t.preventDefault();if(t instanceof TouchEvent&&t.touches.length>=2)c=true;s++}function u(t){t.preventDefault();if(s<=10&&a&&R.v<=1500&&!c)e.call(this,t,i,o);s=0;a=false;c=false}r("touchstart mousedown",d);r("touchmove mousemove wheel mousewheel",l);r("touchend mouseup mouseleave touchleave",u)}()}function Dt(t){t=t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/ /g,"&nbsp;");return t}function Bt(t,e){const n=window.location.href;const i=new URLSearchParams(window.location.search);var o="";if(t==mt.COORDS){if(i.toString()!=""){const t=Xt(mt.ZOOM_RATIO);o=n.includes("@")?n.replace(/@.*/,"")+"@"+e+"x"+(t===null?1:t)+"?"+i.toString():n.replace(/\?.*/,"")+"@"+e+"?"+i.toString()}else{o=n+"@"+e}}else if(t==mt.ZOOM_RATIO){if(i.toString()!=""){const t=Xt(mt.COORDS);o=n.includes("@")?n.replace(/@.*/,"")+"@"+(t===null?"0,0":t)+"x"+e+"?"+i.toString():n.replace(/\?.*/,"")+"@"+e+"?"+i.toString()}else{o=n+"@"+Xt(mt.COORDS)+e}}else{i.set(t,encodeURIComponent(String(e)));o=n.split("?")[0]+"?"+i.toString()}window.history.replaceState("","",o)}function Ht(t,e){const n=window.location.href;const i=new URLSearchParams(window.location.search);if(e)e=encodeURIComponent(e);i.delete(t,e);const o=n.split("?")[0]+"?"+i.toString();window.history.replaceState("","",o)}function Xt(t,e){if(e===void 0)e=window.location.href;if(t==mt.COORDS){const t=/@([^?&]+)x([^?&]+)/;const i=/@([^?&]+)/;var n=e.match(t);if(!n)n=e.match(i);return n?n[1].replace(/x/g,""):null}else if(t==mt.ZOOM_RATIO){const t=/@([^?&]+)x([^?&]+)/;const n=e.match(t);return n?n[2]:null}const i=new URLSearchParams(window.location.search);const o=i.get(t);return o?decodeURIComponent(o):null}function Pt(t){return V[t||""]}function Ut(t,e){const n=a*t;if(O.caps.ratio.max<n&&t>1){if(e)a=O.caps.ratio.max;return true}if(O.caps.ratio.min>n&&t<1){if(e)a=O.caps.ratio.min;return true}return false}function Wt(t){const e=document.cookie.split("; ");for(const n of e){const[e,i]=n.split("=");if(e===t){return decodeURIComponent(i)}}return null}function Gt(t){document.cookie=`${t}=; max-age=0;`}function Ft(t,e){window.localStorage.setItem(t,e)}function Yt(t){return window.localStorage.getItem(t)}function qt(t){window.localStorage.removeItem(t)}function Jt(t,e){return"/resources/cloud/org/"+t+"/"+e}function zt(t,e){return"/resources/cloud/static/"+t+"/"+e}function Vt(t){return t.object.type.event==="org"?Jt:zt}function Kt(){const t=navigator.language;return Zt(t)}function Zt(t){if(t)switch(t.toUpperCase()){case"JA":return"JA";default:return"EN"}else return null}function Qt(t){var e=t.split(".").slice(-1)[0].toLowerCase();if(["jpg","jpeg","png","gif","webp"].indexOf(e)!==-1){return"image"}if(["mp4","webm","avi","mov","flv"].indexOf(e)!==-1){return"video"}return"unknown"}class te{constructor(t,e){this.real=t;this.imag=e}add(t){return new te(this.real+t.real,this.imag+t.imag)}subtract(t){return new te(this.real-t.real,this.imag-t.imag)}multiply(t){return new te(this.real*t.real-this.imag*t.imag,this.real*t.imag+this.imag*t.real)}divide(t){const e=t.real*t.real+t.imag*t.imag;if(e===0){throw new Error("Division by zero")}return new te((this.real*t.real+this.imag*t.imag)/e,(this.imag*t.real-this.real*t.imag)/e)}rotate(t,e){e??=new te(0,0);const n=this.subtract(e);const i=Math.cos(t);const o=Math.sin(t);const s=new te(n.real*i-n.imag*o,n.real*o+n.imag*i);return s.add(e)}magnitude(){return Math.sqrt(this.real*this.real+this.imag*this.imag)}toString(){return`${this.real} + ${this.imag}i`}}function ee(t){const e=document.createElement("span");e.innerHTML=t;return e.textContent}function ne(t){$("#"+t).show().removeClass("calming recalming").addClass("activated").css("z-index",(++Q).toString());be(t)}function ie(t){$("#"+t).removeClass("activated").addClass("recalming");setTimeout((()=>$("#"+t).hide()),100);Q--}function oe(){$("shishiji-pks").removeClass("activated").addClass("recalming");Q=1}function se(t,e){["touchstart","mousedown"].forEach((n=>t.addEventListener(n,(function(n){var i=n instanceof TouchEvent?n.touches[0].clientY:n.clientY;var o=0;var s=false;function a(n){o=i-(n instanceof TouchEvent?n.touches[0].clientY:n.clientY);if(o>35&&!s){s=true;e(n);["touchmove","mousemove"].forEach((e=>t.removeEventListener(e,a,{passive:true})),{passive:true})}}["touchmove","mousemove"].forEach((e=>t.addEventListener(e,a,{passive:true})));["touchend","mouseup"].forEach((e=>t.addEventListener(e,(e=>{if(s){}["touchmove","mousemove"].forEach((e=>t.removeEventListener(e,a,{passive:true})),{passive:true});["touchmove","mousemove"].forEach((e=>t.removeEventListener(e,a)),{passive:true})}))))}),{passive:true})))}function ae(t,e){switch(e){case"top":tt.top.length==0?$("#topestLoadMan").removeClass("aOKSGD"):void 0;tt.top.push(t);break;case"middle":tt.top.length==0?$("#midestLoadMan").removeClass("aOKSGD"):void 0;tt.middle.push(t);break}}function ce(t,e){switch(e){case"top":tt.top=tt.top.filter((e=>e!==t));tt.top.length==0?$("#topestLoadMan").addClass("aOKSGD"):void 0;break;case"middle":tt.middle=tt.middle.filter((e=>e!==t));tt.middle.length==0?$("#midestLoadMan").addClass("aOKSGD"):void 0;break}}function re(t){if(!t.startsWith("data:")){throw new Error("Invalid Data URL")}const[e,n]=t.split(",");const i=e.match(/:(.*?);/)?.[1];const o=atob(n);const s=o.length;const a=new Uint8Array(s);for(let t=0;t<s;t++){a[t]=o.charCodeAt(t)}return new Blob([a],{type:i})}function de(t,e){var n="url("+t;n+=e?"?"+kt.string(8):"";n+=")";return n}function le(t,e){if(t.length!==e.length)return false;var n=t.slice().sort();var i=e.slice().sort();for(let t=0;t<n.length;t++){if(n[t]!==i[t]){return false}}return true}function ue(t,e){const n=[];for(const[i,o]of Object.entries(V)){if(o.object.floor==t&&o.article){if(e){if(o.object.no_admission)continue}n.push(i)}}return n}function he(t){return l.data.completed_orgs.includes(t)}function fe(t,e){const n=document.createElement("tr");n.classList.add("ev_property");const i=document.createElement("th");i.textContent=t;i.classList.add("ev_property_cell");const o=document.createElement("th");o.textContent=e;o.classList.add("ev_property_cell");n.appendChild(i);n.appendChild(o);return n}function me(){$("#mission_progress_bar").css("width",(l.data.pt/5e4*100).toString()+"%");$("#user-total-points").text(l.data.pt+"pt");$("#smartestppl").text(l.data.pt+"pt");$("#profile-totalscore").text(l.data.pt+"pt");const t=[...ptmedal];for(const e of t.reverse()){if(l.data.pt>=e.pt){$("#dashub, #user-rank").css("background-image",`url(${pe(l.data.pt)})`);break}}const e=ve(l.data.pt);if(!e){const t=ptmedal[0].pt;$("#rank-progress").css("width",`${l.data.pt/t*100}%`)}else if(!e[1]){$("#rank-progress").css("width",`100%`)}else{const t=Math.abs(e[1].pt-e[0].pt);const n=l.data.pt-e[0].pt;const i=n/t*100;$("#rank-progress").css("width",`${i}%`)}}function pe(t){const e=[...ptmedal];for(const n of e.reverse()){if(t>=n.pt){return n.src}}}function ve(t){const e=[...ptmedal];for(var n=e.length-1;n>=0;n--){const i=e[n];if(t>=i.pt){return[i,e[n+1]]}}}function ge(t){const e=document.createElement("div");const n=document.createElement("div");const i=document.createElement("p");i.textContent=`+${t}`;n.classList.add("aOBvjw");e.classList.add("uihagod");n.appendChild(i);e.appendChild(n);$("shishiji-pt-claimer").append(e);setTimeout((()=>{e.classList.add("haveaniceday");setTimeout((()=>e.remove()),500)}),5*1e3+500)}function _e(t){const e=document.getElementById("pkgo_menu"+t)?.children[0];e?.querySelectorAll("menu-notifier").forEach((t=>t.remove()));e?.appendChild(document.createElement("menu-notifier"))}function we(t){const e=document.getElementById("pkgo_menu"+t)?.children[0];e?.querySelectorAll("menu-notifier").forEach((t=>t.remove()))}function ye(t){const e=Yt("__tour-"+t);return!Boolean(e)}function Ee(t){const e=Be[t];if(e){e.start();Ft("__tour-"+t,"done-"+(new Date).toString())}}function $e(t,e){$.post(ajaxpath.collectad,{f:"adv",b:t,d:e})}function xe(t,e){$.post(ajaxpath.collectad,{f:t,v:e})}function be(t){for(const e of l.pending_collects){if(e.name==t)e.count++;return}l.pending_collects.push({name:t,count:1})}function Ce(t,e){const n=document.createElement("span");t.appendChild(n);n.innerHTML=e;n.classList.add("MCOBF","crucial")}function Te(t,e){const n=e.length;const i=document.createElement("span");var o=false;for(var s=0;s<n;s++){const n=MCSTYLES[e[s]];if(typeof n!=="string")continue;i.style.cssText+=n+";";if(e[s]==="§k"){Ce(i,t);o=true}}if(!o)i.innerHTML=t;return i}function ke(t){t=t.replace(/§h/g,'<hr class="article-dv">');var e=t.match(/§.{1}/g)||[],n=[],i=[],o,s,a=document.createDocumentFragment(),c=e.length,t=t.replace(/\n|\\n/g,"<br>");for(var r=0;r<c;r++){n.push(t.indexOf(e[r]));t=t.replace(e[r],"\0\0")}if(n[0]!==0){a.appendChild(Te(t.substring(0,n[0]),[]))}for(var r=0;r<c;r++){s=n[r+1]-n[r];if(s===2){while(s===2){i.push(e[r]);r++;s=n[r+1]-n[r]}i.push(e[r])}else{i.push(e[r])}if(i.lastIndexOf("§r")>-1){i=i.slice(i.lastIndexOf("§r")+1)}o=t.substring(n[r],n[r+1]);a.appendChild(Te(o,i))}return a}async function Le(t){try{const e=await fetch(t);return await e.blob()}catch(t){return null}}function Ie(t,e){t=Dt(t);t=t.replace(/\n/g,"").replace(/§v/g,"\n");var n="";const i=ke(t);for(var o of Array.from(i.children)){n+=o.outerHTML}const s=/∫\:IMG-S=([^-]+)-W=(\d+);∫/g;const a=/∫\:VIDEO-S=([^-]+)-W=(\d+);∫/g;const c=/#\:LINK-H=(https?:\/\/(?:(?!-T=).)+)-T=((?:(?!;#).)*);#/g;const r=n.matchAll(s)||[];const d=n.matchAll(a)||[];const l=n.matchAll(c)||[];const u=/@REVEAL-f=([^-]+)-x=(\d+)-y=(\d+);/g;const h=n.matchAll(u)||[];for(const t of r){const i=Number(t[2]);n=n.replace(t[0],`<img class="article-image doaJSD protected" loading="lazy" draggable="false" src="${e(t[1])}" style="width: ${i>100||i<0?100:i}%;">`)}for(const t of d){const i=Number(t[2]);n=n.replace(t[0],`<video class="article-video protected" loading="lazy" draggable="false" src="${e(t[1])}" controls preload="metadata" playsinline style="width: ${i>100||i<0?100:i}%;"></video>`)}for(const t of l){const e=t[1];n=n.replace(t[0],`<a class="article-outsidelink notprotected" draggable="true" href="${new URL(e)}" target="_blank">${t[2].length>0?t[2]:t[1]}</a>`)}for(const t of h){const e=t[1];const i=Number(t[2]);const o=Number(t[3]);n=n.replace(t[0],`<div class="shishijibtn KAuf" f="${e}" x="${i}" y="${o}"><span style="width:120px">マップで表示</span></div>`)}return n}!function(){const t="123456789abcdefghijklmnopqrstuvwxyz";const e=t.split("").concat(t.slice(9).toUpperCase().split(""));setInterval((function(){const t=document.getElementsByClassName("MCOBF");for(const i of t){for(const t of i.childNodes){var n="";if(t.textContent==null)continue;for(const i of t.textContent.split("")){const t=Math.round(Math.random()*(e.length-1));n+=e[t]}t.textContent=n}}}),10);return 0}();!function(){window.addEventListener("click",(function(t){const e=t.target;const n=e.parentNode;if(e.classList.contains("KAuf")||n?.classList.contains("KAuf")){const t=e.getAttribute("f")||n?.getAttribute("f")||"";const i=e.getAttribute("x")||n?.getAttribute("x");const o=e.getAttribute("y")||n?.getAttribute("y");if(![t,i,o].every((t=>t)))return;ro();no({floor:t,x:Number(i),y:Number(o)})}}));return 0}();var Ae=[];!function(){var t,e;document.documentElement.addEventListener("mousemove",(function(t){R.method="MOUSE";e=t}));Ae.push((function(){var n=0;var i=0;var o=0;if(t&&e){var n=e.screenX-t.screenX;var i=e.screenY-t.screenY;var o=Math.sqrt(n*n+i*i)}t=e;if(R.method=="MOUSE"){R.x=100*n;R.y=100*i;R.v=100*o}}));return 0}();!function(){var t=0;var e;function n(t){var e=0;var n=0;for(var i of t){e+=i.clientX;n+=i.clientY}e/=t.length;n/=t.length;return{x:e,y:n}}var i,o;document.documentElement.addEventListener("touchmove",(function(t){R.method="TOUCH";o=t}));Ae.push((function(){var s=0;var a=0;var c=0;if(o&&o.touches.length>=2){t=1;if(e)clearTimeout(e);e=setTimeout((()=>{t=0}),250)}if(i&&o&&o.touches.length==1&&t===0){var r=n(o.touches),d=n(i.touches);s=r.x-d.x;a=r.y-d.y;c=Math.sqrt(s*s+a*a)}i=o;if(R.method=="TOUCH"){R.x=100*s;R.y=100*a;R.v=100*c}}));return 0}();!function(){var t;function e(t){var e=0;var n=0;for(var i of t){e+=i.clientX;n+=i.clientY}e/=t.length;n/=t.length;return{x:e,y:n}}var n,i;document.documentElement.addEventListener("touchmove",(function(t){R.method="TOUCH";i=t}));Ae.push((function(){var t={0:{x:0,y:0},1:{x:0,y:0}};if(!i&&!n||i.touches.length==1)return;if(n&&i&&i.touches.length==1){for(var e=0;e<2;e++){var o=i.touches[e];var s=n.touches[e];t[e].x=o.clientX-s.clientX;t[e].y=o.clientY-s.clientY}}n=i;if(R.method=="TOUCH"){for(var e=0;e<2;e++){j[e].x=100*t[e].x;j[e].y=100*t[e].y}}}));return 0}();setInterval((()=>Ae.forEach((t=>t()))),20);function Oe(t){t.preventDefault()}window.addEventListener("gesturestart",Oe,{passive:false});window.addEventListener("dblclick",Oe,{passive:false});window.addEventListener("wheel",(function(t){if(t.ctrlKey||t.metaKey)t.preventDefault()}),{passive:false});const Se=io.connect(void 0,{withCredentials:true});Se.on("user.admission.pending",(t=>{ae(t.s+"-admission-pending","middle")}));Se.on("user.admission.register",(async e=>{const n=Pt(e._new);const i=n?e.processType:"unknown";switch(i){case"duplicated":_o.notifyWarn(TEXTS[t].ALREADY_VISITED,{duration:1e4});break;case"included":const i=e._pt;l.data.completed_orgs=e._update;l.data.pt=e._apt;Gi();_o.notifySuccess(Et(TEXTS[t].ADMISSION_RECORDED,n?.article.title),{duration:1e4});ge(`${i}pt`);if(await Vn()){_e("1")}break;default:_o.notifyError(TEXTS[t].UNKNOWN_ERROR,{duration:1e4})}me();setTimeout((()=>ce(e._new+"-admission-pending","middle")),500)}));Se.on("user.ticket.consumption",(async e=>{const n=e._newtickets;const i=e.used;_o.notifySuccess(Et(TEXTS[t].TICKET_USED,i.visual.description),{duration:10*1e3,deny_userclose:true,do_not_keep_previous:true});ie("ticket_use_screen");l.data.tickets=n;Mn()}));Se.on("data.delay",(async t=>{b.BAND_SCHEDULE_DELAY=Number(t.b);b.DANCE_SCHEDULE_DELAY=Number(t.d)}));const Ne=[];var Re=false;function je(t){if(Re)t();else Ne.push(t)}const Me=new Promise((async function(e){$.ajax({url:ajaxpath.integrity,type:"POST",success:function(e){Re=true;l.logined=true;l.discriminator=e.discriminator;const n=JSON.parse(e.completed_orgs);const i=JSON.parse(e.profile);const o=JSON.parse(e.fame_votes);const s=JSON.parse(e.band_votes);const a=JSON.parse(e.dance_votes);const c=JSON.parse(e.misc_votes);const r=JSON.parse(e.favorited_orgs);const d=JSON.parse(e.claimed_rpt);const u=JSON.parse(e.custom_data);const h=JSON.parse(e.tickets);l.data.completed_orgs=n;l.data.profile=i;l.data.fame_votes=o;l.data.band_votes=s;l.data.dance_votes=a;l.data.misc_votes=c;l.data.favorited_orgs=r;l.data.pt=Number(e.pt);l.data.claimed_rpt=d;l.data.tickets=h;l.data.custom_data=u;l.data.isstudent=e.isstudent;$("#user-name-input").val(l.data.profile.nickname);$("#user-name").text(l.data.profile.nickname);me();l.data.profile.icon_path?$("#user-icon, #user-icon-change").css("background-image",de(l.data.profile.icon_path,true)):void 0;if(l.data.isstudent)$("#pkgo_menu2、#pkgo_menu1").remove();_o.notify("success",Et(TEXTS[t].LOGINED,e.discriminator),{addToPending:true});Ne.forEach((t=>t()))},error:function(t){x((()=>_o.notify("warn","Login Failed")));ae("integrity","top")},complete:function(){ce("integrity","top");r.login=true;e(void 0)}});setTimeout((()=>{if(!Re)ae("integrity","top")}),2500)}));setInterval((async function(){Se.emit("org.data.crowdstatus",(function(t){for(const n in t){if(!V[n])continue;var e=t[n];V[n].article.crowd_status=e;Ki(n,e);if(e==0)e=1;$("#sstatus-disc-"+n).removeClass("n1 n2 n3 n0").addClass("n"+e.toString())}}))}),15*1e3);function De(){var e=false;return new Promise((n=>{ne("headcount_screen");function i(){const o=Number($("#headcount_select").val());const s=Number($("#generation_select").val())||null;const a=Number($("#gender_select").val())||null;const c=structuredClone(l.data.custom_data);c["headcount"]=o;s?c["generation"]=s:0;a?c["gender"]=a:0;if(e)return;e=true;ae("ehadcount","middle");$.post(ajaxpath.setcustom,{customs:JSON.stringify(c)}).then((function(){l.data.custom_data=structuredClone(c);_o.notifySuccess(TEXTS[t].THANKS_FOR_COOPERATING);document.getElementById("setupheadcount")?.removeEventListener("click",i);ie("headcount_screen");n(void 0)})).catch((()=>{_o.notifyError(TEXTS[t].ERROR_ANY);e=false})).always((()=>ce("ehadcount","middle")))}document.getElementById("setupheadcount")?.addEventListener("click",i)}))}const Be={main_screen:new Shepherd.Tour({defaultStepOptions:{classes:"shepherd-theme-arrows",scrollTo:false}}),menu:new Shepherd.Tour({defaultStepOptions:{classes:"shepherd-theme-arrows",scrollTo:false}}),ranking:new Shepherd.Tour({defaultStepOptions:{classes:"shepherd-theme-arrows",scrollTo:false}}),article:new Shepherd.Tour({defaultStepOptions:{classes:"shepherd-theme-arrows",scrollTo:false}})};const He={main_screen:[{title:"階切り替え",text:"閲覧する階を変更できます",attachTo:{element:"#fsel-xxl",on:"left"},buttons:[{text:"次へ",action:Be.main_screen.next}]},{title:"団体",text:"タップするとこの場所にある団体の情報を確認できます",attachTo:{element:"#disc-swimming",on:"right"},buttons:[{text:"戻る",action:Be.main_screen.back},{text:"次へ",action:Be.main_screen.next}]},{title:"プロフィール",text:"ランキングに載るプロフィールを変更できます(アイコン, ニックネーム)",attachTo:{element:"#user-profile-opner",on:"top-end"},buttons:[{text:"戻る",action:Be.main_screen.back},{text:"次へ",action:Be.main_screen.next}]},{title:"メニュー",text:"タップするとほかのさまざまな機能をご利用いただけます",attachTo:{element:"#pkgo_mainb",on:"top"},buttons:[{text:"戻る",action:Be.main_screen.back},{text:"了解",action:()=>{y.main_screen=O.deny=false;Be.main_screen.next()}}]}],menu:[{title:"QRコード",text:"入場記録, スタンプラリーに使用し、ポイントを獲得できます",attachTo:{element:"#qrcodebuttonman",on:"top"},buttons:[{text:"次へ",action:Be.menu.next}]},{title:"ミッション",text:"ミッションを達成するとポイントをもらえます(団体に入室された時にもらえるポイントと同じです)。\nポイントが貯まるトランクが上がって、チケットを獲得できます",attachTo:{element:"#pkgo_menu1 > div",on:"top"},buttons:[{text:"戻る",action:Be.menu.back},{text:"次へ",action:Be.menu.next}]},{title:"チケット",text:"ミッションで獲得したチケットで景品交換ができます",attachTo:{element:"#ticketsbuttonman",on:"top"},buttons:[{text:"戻る",action:Be.menu.back},{text:"次へ",action:Be.menu.next}]},{title:"イベント",text:"バンドやダンスなどのイベントスケジュールをご確認いただけます",attachTo:{element:"#pkgo_menu3 > div",on:"top"},buttons:[{text:"戻る",action:Be.menu.back},{text:"次へ",action:Be.menu.next}]},{title:"展示団体",text:"マップに表示されているアイコンの一覧や検索ができます",attachTo:{element:"#pkgo_menu5 > div",on:"top"},buttons:[{text:"戻る",action:Be.menu.back},{text:"次へ",action:Be.menu.next}]},{title:"人気投票",text:"イベントや、訪れた団体に人気投票することができます",attachTo:{element:"#pkgo_menu2 > div",on:"top"},buttons:[{text:"戻る",action:Be.menu.back},{text:"次へ",action:Be.menu.next}]},{title:"グッズ紹介",text:"獅子児祭グッズを紹介します",attachTo:{element:"#pkgo_menu4 > div",on:"top"},buttons:[{text:"戻る",action:Be.menu.back},{text:"次へ",action:Be.menu.next}]},{title:"飲食",text:"獅子児祭での飲食店の一覧をご覧いただけます",attachTo:{element:"#pkgo_menu7 > div",on:"bottom"},buttons:[{text:"戻る",action:Be.menu.back},{text:"終わる",action:()=>{Be.menu.next();y.pkgo=false}}]}],ranking:[{title:"ランキング",text:"ミッションptの上位100人が表示されます（それだけです）",attachTo:{element:"#go_to_ranking",on:"left-start"},buttons:[{text:"終わる",action:()=>{Be.ranking.next();y.pkgo=false}}]}],article:[{title:"お気に入り",text:"登録されるとそのアイコンの左下に印が付きます。投票などでの絞り込みにもご活用いただけます",attachTo:{element:"#dvd2",on:"bottom"},buttons:[{text:"次へ",action:Be.article.next}]},{title:"投票",text:"訪れた（入場記録をとった）団体には人気投票ができます",attachTo:{element:"#dvd3",on:"bottom"},buttons:[{text:"戻る",action:Be.article.back},{text:"次へ",action:Be.article.next}]},{title:"詳細",text:"団体の詳細情報",attachTo:{element:"#ovv-t-details-sd",on:"bottom"},buttons:[{text:"戻る",action:Be.article.back},{text:"次へ",action:()=>{$("#ovv-t-details-sd").trigger("click");setTimeout(Be.article.next,50)}}]},{title:"訪問pt",text:"入場記録をとった際に<br>獲得できるミッションptです<br>混雑状況によって変化します",attachTo:{element:".ev_property",on:"bottom"},buttons:[{text:"戻る",action:()=>{$("#ovv-t-description-sd").trigger("click");setTimeout(Be.article.back,50)}},{text:"終わる",action:()=>{Be.article.next();y.article=false}}]}]};+function(){for(const[t,e]of Object.entries(He)){const n=Be[t];e.forEach((t=>n.addStep(t)))}}();function Xe(t){const e=document.createElement("div");e.classList.add("LXId");e.innerHTML=`\n            <div class="uhbAJw" style="background-image:url(/resources/img/advertisement/tfn-${t}.png)">\n    \n            </div>\n        `;return e}function Pe(t){if(t.target?.id=="top-advertisement-img")return;$("shishiji-fking-advertisement").addClass("hidden-adv")}function Ue(t){$("#top-advertisement-img").attr("src",t);$("shishiji-fking-advertisement").removeClass("hidden-adv")}function We(){ne("search_screen");$("#ovie_search_boxw").removeClass("closeL").addClass("openH");if(!$("#search_result").hasClass("searchen")){$("#search_result").empty().off("scroll",Fe).addClass("searchen");Ve(true)}else{qe()}}function Ge(){$("#ovie_search_boxw").removeClass("openH").addClass("closeL");$("#oive_a").removeClass("hello").addClass("bye_cry").show()}async function Fe(){return;$(".ABId.wwwnotwith").each((function(){var t=this.offsetTop;var e=$("#search_result").scrollTop()||0;var n=window.innerHeight;if(t-e<n){const t=$(this).find(".notwithdetails");const e=t.attr("disc")||"";this.classList.remove("wwwnotwith");t.removeClass("notwithdetails");(function n(){function i(){$.post(ajaxpath.getart+"?discriminator="+e,{}).then((e=>{t.html(ee(ee(Ie(e.article,(()=>""))))||"詳細を確認できませんでした。")})).fail(i)}i()})()}}))}var Ye=new Promise((t=>t(null)));async function qe(){var t=await Ye;if(t==null){t=Ye=$.post(ajaxpath.getallart);t=await t;setTimeout((()=>Ye=new Promise((t=>t(null)))),5e3)}function e(){var e={};for(const n in t.article){e[n]=ee(Ie(t.article[n]||"",(()=>"")))}window.navigator.clipboard.writeText(JSON.stringify(e,null,4))}$(".ABId.wwwnotwith").each((function(){const e=$(this).find(".notwithdetails");const n=e.attr("disc")||"";e.html(ee(ee(Ie(t.article[n]||"",(()=>""))))||"詳細を確認できませんでした。");var i=Number(t.crowd[n]);i=i==0?1:i;$("#sstatus-disc-"+n).removeClass("n1 n2 n3 n0").addClass(`n${i}`)}))}function Je(){const t=$("#fav_search").attr("fav_search");if(t){$(".holdmeLikeThat").each((function(t){if(!l.data.favorited_orgs.includes(this.getAttribute("disc")||""))this.style.display="none"}))}else{$(".holdmeLikeThat").show()}$(".LXId").remove();Ke()}function ze(t){const e={};Ve(false);$("#search_result").children().each((function(){const t=this.getAttribute("disc");if(!t)return;e[t]=this}));$("#search_result").empty();for(const n of t){$("#search_result").append(e[n])}$("#search_result").trigger("scroll");Je()}function Ve(e){const n=document.getElementById("search_result");const i=$("#fav_search").attr("fav_search");var o=true;$("#search_result").empty().scrollTop(0);for(const[t,e]of Object.entries(V)){if(i&&!l.data.favorited_orgs.includes(t))continue;if(e.article){const t=document.createElement("div");t.appendChild(Ze(e));const i=t.children[0];i.addEventListener("click",(function(){Bt(mt.ARTICLE_ID,e.discriminator);so();lo(e,true,void 0,void 0,void 0,true)}));n.appendChild(i);o=false}}Ke();$("#search_result").trigger("scroll");qe();if(i&&o){const e=document.createElement("span");e.classList.add("iuhagW","UghaWW");e.textContent=TEXTS[t].HOW_TO_FAV;$("#search_result").append(e);return}}function Ke(){const t=$('.holdmeLikeThat:not([style*="display: none"])').length;const e=[];g.then((n=>{n=kt.shuffleArray(n);const i=n.length;const o=Math.floor(t/n.length);if(o<4){n=n.slice(0,Math.floor(t/4))}if(o==0)return;for(var s=o;s<t;s=s+o){const t=Math.floor(s/o)-1;$(".holdmeLikeThat").eq(s).after(Xe(n[t]));e.push(t)}$e("search-screen",e.join(" "))}))}function Ze(t){const e=Vt(t);const n={"1F":"1階","2F":"2階","3F":"3階","4F":"4階"};const i=document.createElement("div");i.classList.add("ABId","wwwnotwith","holdmeLikeThat");i.setAttribute("disc",t.discriminator);const o=document.createElement("div");o.classList.add("BIfff");const s=document.createElement("div");s.classList.add("IcoNium");const a=document.createElement("div");a.classList.add("haVUn");a.id="sstatus-disc-"+t.discriminator;const c=document.createElement("img");c.src=e(t.discriminator,t.object.images.icon);s.appendChild(c);s.appendChild(a);const r=document.createElement("h2");r.textContent=t.article.title;o.appendChild(s);o.appendChild(r);const d=document.createElement("h4");d.classList.add("auygsWU");d.textContent=`${n[t.object.floor]}${t.article.venue?", "+t.article.venue:""}`;const l=document.createElement("div");l.classList.add("AINBU");const u=document.createElement("h3");u.classList.add("smlTtl");u.textContent=t.article.subtitle||"";const h=document.createElement("div");h.classList.add("EZdes");const f=document.createElement("span");f.classList.add("janS","notwithdetails");f.setAttribute("disc",t.discriminator);h.appendChild(f);l.appendChild(u);l.appendChild(h);i.appendChild(o);i.appendChild(d);i.appendChild(l);return i}function Qe(){const e=$("#org_search_input").val();if(tt.middle.includes("search mapobject")||!e)return;ae("search mapobject","middle");$.ajax({url:ajaxpath.search+`?q=${$("#org_search_input").val()}`,type:"post",contentType:"application/json",data:JSON.stringify({query:e}),crossDomain:true}).then((t=>{ze(t);ce("search mapobject","middle")})).catch((()=>_o.notifyError(TEXTS[t].ERROR_ANY))).always((()=>ce("search mapobject","middle")))}function tn(){ne("faq_screen")}const en=[];function nn(){ne("stamp_rally_scan_screen");ae("opening camera","middle");if(!("mediaDevices"in navigator&&"getUserMedia"in navigator.mediaDevices))_o.notifyError(TEXTS[t].BROWSER_DOESNT_HAVE_CAMERA_FUNC);else setTimeout((async()=>{const e=document.getElementById("qrcode-video");const n=document.getElementById("camera-canvas");const i=n.getContext("2d");const o=document.getElementById("rect-canvas");const s=o.getContext("2d");const a=t=>{on(t);$("#close_button_of_stamp_rally_scan_screen").trigger("click")};const c=t=>{o.width=u;o.height=h;r(t.topLeftCorner,t.topRightCorner);r(t.topRightCorner,t.bottomRightCorner);r(t.bottomRightCorner,t.bottomLeftCorner);r(t.bottomLeftCorner,t.topLeftCorner)};const r=(t,e)=>{s.lineWidth=4;s.strokeStyle="#50C878";s.beginPath();s.moveTo(t.x,t.y);s.lineTo(e.x,e.y);s.stroke()};const d=()=>{n.width=u;n.height=h;i.drawImage(e,0,0,u,h);requestAnimationFrame(d)};const l=async()=>{const t=i.getImageData(0,0,u,h);const e=jsQR(t.data,u,h);if(e&&e.data){c(e.location);ae("stamp code read","middle");setTimeout((()=>{a(e.data);ce("stamp code read","middle");i.clearRect(0,0,n.width,n.height);s.clearRect(0,0,o.width,o.height)}),490);return}else{s.clearRect(0,0,u,h)}setTimeout((()=>{l()}),500)};var u;var h;const f=navigator.mediaDevices.getUserMedia({audio:false,video:{width:screen.height,height:screen.width,facingMode:{exact:"environment"}}}).then((t=>{en.push(t);e.srcObject=t;e.onloadeddata=()=>{e.play();u=e.clientWidth;h=e.clientHeight;d();l();if(!tt.middle.includes("opening camera")){t.getTracks().forEach((t=>t.stop()))}else{ce("opening camera","middle")}}})).catch((e=>{var n="";switch(e.toString()){case"OverconstrainedError":case"NotFoundError":n="CAMERA_NOT_FOUND";break;case"NotReadableError":n="SYSTEM_ERROR";break;case"TypeError":n="UNKNOWN_ERROR";break;case"SecurityError":default:n="PLEASE_ALLOW_CAMERA";break}_o.notifyError(TEXTS[t][n],{discriminator:"camera error",do_not_keep_previous:true});ie("stamp_rally_scan_screen");ce("opening camera","middle")}))}),250)}function on(t){ne("stamp_rally_scanned_screen");$("#uhgaiaSafs").text(t)}function sn(){ne("myqrcode_screen");$("#myqrcode").attr("src","");$.post(ajaxpath.mqr).then((t=>{const e=re(t);$("#myqrcode").attr("src",URL.createObjectURL(e))})).catch((e=>{_o.notifyError(TEXTS[t].ERROR_LOADING_QRCODE)}))}class an{static oepn(t){$("#pkgo_menu_closeAWW").removeClass("oAIKSD");$("#pkgo_mainb").css({"pointer-events":"none",visibility:"hidden"});$("#pkgo_menu_close").removeClass("imdisplaynone iiasdIOJAGDjafjiofjoijaoijs").addClass("iiasdIOJ");$(".pkgo_menu_insidew").removeClass("oafs");$(".pok_anom").removeClass("imdisplaynone aUDGJHJSduijujaijuigsdjuio").addClass("opening_yey");$("pokemon-gradient").removeClass("aggjg").addClass("uiagg");$("#pkgo_menu_OPEN_RETAINER").removeClass("gauhi8yS");$("spreads").removeClass("AUHISGFjjj");$(".pkm__h").addClass("AIOSJ");$("#theme-meta").attr("content","#4b4f52")}static close(t){$("#pkgo_menu_closeAWW").addClass("oAIKSD");$("#pkgo_mainb").css({"pointer-events":"all",visibility:"visible"});$("#pkgo_menu_close").removeClass("iiasdIOJ").addClass("iiasdIOJAGDjafjiofjoijaoijs");$(".pkgo_menu_insidew").addClass("oafs");$(".pok_anom").removeClass("opening_yey").addClass("aUDGJHJSduijujaijuigsdjuio");$("pokemon-gradient").removeClass("uiagg").addClass("aggjg");$("#pkgo_menu_OPEN_RETAINER").addClass("gauhi8yS");$("#theme-meta").attr("content","#15202b")}static get opened(){return!$("#pkgo_menu_closeAWW").hasClass("oAIKSD")}}function cn(t){t.preventDefault();an.close()}function rn(){const t=$(this).find("spreads");setTimeout((()=>t.addClass("AUHISGFjjj")),1);t.removeClass("AUHISGFjjj")}function dn(){if(y.main_screen)return;ne("profile_screen")}function ln(){if(!this.files){_o.notifyError(TEXTS[t].ERROR_ANY);return}const e=this.files[0];const n=URL.createObjectURL(e);$("#user-icon-change").css("background-image","url("+n+")");yt.situation.icon_path=true}async function un(){const e=document.getElementById("chiconinputimgae")?.files;const n=document.getElementById("user-name-input")?.value.replace(/^\s+/,"")||"";var i=null;const o=function(){yt.saving=false;_o.notifyError(TEXTS[t].ERROR_ANY)};if(Object.values(yt.situation).every((t=>!t))||yt.saving)return;if(!n){_o.notifyError(TEXTS[t].NICKNAME_CANT_BE_EMPTY);return}else if(n.length>12){_o.notifyError(TEXTS[t].NICKNAME_TOO_LONG);return}const s=t=>new Promise(((e,n)=>{const i=new FileReader;i.onload=function(i){const o=new Image;o.src=i.target.result;o.onload=function(){const i=document.createElement("canvas");const s=i.getContext("2d");let a=o.width;let c=o.height;if(a>c){if(a>256){c=c*(256/a);a=256}}else{if(c>256){a=a*(256/c);c=256}}i.width=a;i.height=c;s?.drawImage(o,0,0,a,c);i.toBlob((function(i){if(i){const n=new File([i],t.name,{type:t.type});e(n)}else{n(new Error)}}),t.type||"image/png")};o.onerror=function(){n(new Error)}};i.readAsDataURL(t)}));if(e&&e[0]){i=e[0];try{i=await s(i)}catch(t){o();return}}const a=new FormData;a.append("file",i);a.append("nickname",n);yt.saving=true;ae("profile-saver","top");$.ajax({url:ajaxpath.profileupd,type:"POST",data:a,processData:false,contentType:false}).done((e=>{yt.saving=yt.situation.icon_path=yt.situation.nickname=false;l.data.profile.nickname=e.nickname;l.data.profile.icon_path=e.icon_path;$("#user-name-input").val(l.data.profile.nickname);$("#user-name").text(l.data.profile.nickname);l.data.profile.icon_path?$("#user-icon, #user-icon-change").css("background-image",de(l.data.profile.icon_path,true)):void 0;_o.notifySave(TEXTS[t].PROFILE_SAVED,{do_not_keep_previous:true})})).fail(o).always((()=>ce("profile-saver","top")))}var hn=[];function fn(){ne("vote_screen")}function mn(t){const e=document.getElementById("aiUHGG");ne("fame_vote_screen");e?.classList.remove("faui");$(e?.children[0]?.children[0]).show();$(e?.children[0].children[1]).hide();e?.removeAttribute("stricted");pn(t)}function pn(e){const n=l.data.completed_orgs;const i=[...l.data.fame_votes];var o=null;hn=[...l.data.fame_votes];hn=e?e:hn;const s=e?.[0]||hn[0]||"";$("#dumn_heres_new_way > .CDId, .iuhagW").remove();$("#dumn_heres_new_way").scrollTop(0);for(const t of n){const e=Pt(t);if(e&&e.article){const n=vn(e,hn.includes(t),i.includes(t));if(e.discriminator==s)o=n;$("#dumn_heres_new_way").append(n)}}$("#vote_right_now").hide();gn(true);const a=(o?.offsetTop||0)-window.innerHeight/2+100+40.5;$("#dumn_heres_new_way").scrollTop(a);if(n.length==0){const e=document.createElement("span");e.classList.add("iuhagW");e.textContent=TEXTS[t].HOW_TO_FAME_VOTE;$("#dumn_heres_new_way").append(e)}}function vn(t,e,n){const i=document.createElement("div");const o=document.createElement("div");o.classList.add("CDId");const s=document.createElement("div");s.classList.add("GGId");s.setAttribute("duty",t.discriminator);const a=document.createElement("div");a.classList.add("BIfff");const c=document.createElement("div");c.classList.add("AUYHs");const r=document.createElement("div");r.classList.add("IcoNium");const d=document.createElement("img");d.src=Jt(t.discriminator,t.object.images.icon);const l=document.createElement("h2");l.textContent=t.article.title;r.appendChild(d);a.appendChild(r);a.appendChild(l);s.appendChild(a);s.appendChild(c);o.appendChild(s);i.classList.add("asujwaGTGg","manyyearshaspassed");o.appendChild(i);i.addEventListener("click",(function(){Bt(mt.ARTICLE_ID,t.discriminator);so();lo(t,true,void 0,void 0,void 0,true)}));s.addEventListener("click",(function(){const t=this.getAttribute("duty")||"";const e=this;hn.includes(t)?+function(){hn=hn.filter((e=>e!==t));hn=[];$(".GGId").removeClass("imselected");e.classList.remove("imselected")}():+function(){hn.push(t);hn=[t];$(".GGId").removeClass("imselected");e.classList.add("imselected")}();gn()}));if(e)s.classList.add("imselected");if(n)s.classList.add("imcurrentleader");return o}function gn(t){t?void 0:$("#vote_right_now").show();le(hn,l.data.fame_votes)?$("#vote_right_now").removeClass("imhere").addClass("imbye"):+function(){$("#vote_right_now").removeClass("imbye").addClass("imhere");$("#vote_right_now").show()}()}function _n(){const t=this.getAttribute("stricted");if(t){this.classList.remove("faui");$(this.children[0].children[0]).show();$(this.children[0].children[1]).hide();this.removeAttribute("stricted")}else{this.classList.add("faui");$(this.children[0].children[0]).hide();$(this.children[0].children[1]).show();this.setAttribute("stricted","true")}const e=!t;if(e)$(".CDId").each((function(){if(!l.data.favorited_orgs.includes(this.children[0].getAttribute("duty")||"")){this.style.display="none"}}));else $(".CDId").show()}var wn=[];var yn=[];var En=[];function $n(){ne("event_vote_selector_screen")}function xn(){ne("event_screen")}function bn(t){return async function(){var e=[];ne("event_vote_screen");wn=[...l.data.band_votes];yn=[...l.data.dance_votes];En=[...l.data.misc_votes];$("#evote_right_now").hide();$("#godric_manager > .godric-father").remove();$("#godric_manager").scrollTop(0);switch(t){case"band":$("#evote_type").text("バンド人気投票");e=[...wn];break;case"dance":$("#evote_type").text("ダンス人気投票");e=[...yn];break;case"misc":$("#evote_type").text("その他人気投票");e=[...En];break}var n=null;async function i(e){const n=(await f)[t];if(t=="misc"){for(const t of Object.values(n)){if(Array.isArray(t))continue;for(const n of[...t.day1,...t.day2]){if(n.name==e)return n}}}else{for(const t of[...n.day1,...n.day2]){if(t.name==e)return t}}return null}for(const o of(await f)[t].vote){const s=await i(o);if(s==null){console.log(o);continue}const a=Tn(s,t);$("#godric_manager").append(a);if(e[0]==o)n=a}Cn(t);const o=(n?.offsetTop||0)-window.innerHeight/2+100+50;$("#godric_manager").scrollTop(o)}}function Cn(e){w.evote=function(){if($("#evote_right_now").attr("wait"))return;var n=[];var i=[];switch(e){case"band":n=[...wn];i=[...l.data.band_votes];break;case"dance":n=[...yn];i=[...l.data.dance_votes];break;case"misc":n=[...En];i=[...l.data.misc_votes];break}ae("evote","middle");$("#evote_right_now").attr("wait","true");$.post(ajaxpath.updevote,{evotes:JSON.stringify(n),et:e}).then((()=>{if(i.length>0&&n.length>0)_o.notifySuccess(TEXTS[t].VOTE_CHANGED);else if(n.length>0)_o.notifySuccess(TEXTS[t].VOTED);else _o.notifySuccess(TEXTS[t].CANCELED_VOTING);$(".imcurrentvold").removeClass("imcurrentvold");switch(e){case"band":l.data.band_votes=[...wn];$(".godric-father").each((function(){if(l.data.band_votes.includes(this.children[0].getAttribute("duty")||""))this.classList.add("imcurrentvold")}));break;case"dance":l.data.dance_votes=[...yn];$(".godric-father").each((function(){if(l.data.dance_votes.includes(this.children[0].getAttribute("duty")||""))this.classList.add("imcurrentvold")}));break;case"misc":l.data.misc_votes=[...En];$(".godric-father").each((function(){if(l.data.misc_votes.includes(this.children[0].getAttribute("duty")||""))this.classList.add("imcurrentvold")}));break}kn(e)})).catch((()=>{_o.notifyError(TEXTS[t].ERROR_ANY)})).always((()=>{ce("evote","middle");$("#evote_right_now").attr("wait",null)}))}}function Tn(t,e){const n=document.createElement("div");const i=document.createElement("div");i.classList.add("XYId");i.setAttribute("duty",t.name);const o=document.createElement("h2");o.textContent=t.name;const s=document.createElement("p");const a=document.createElement("div");const c=document.createElement("img");if(t.musics)s.textContent="楽曲: "+t.musics;c.onerror=()=>c.remove();c.src=`/resources/cloud/event/${e}/${t.name.replace(/ /g,"_")}/icon.png`;c.classList.add("Oiniums");a.classList.add("fuaAW");a.appendChild(c);a.appendChild(o);i.appendChild(a);i.appendChild(s);n.appendChild(i);n.classList.add("godric-father");i.addEventListener("click",(function(){const t=this.getAttribute("duty")||"";const n=this;$(".godric-father").removeClass("imnihher");switch(e){case"band":wn.includes(t)?+function(){wn=wn.filter((e=>e!==t));wn=[];n.parentElement?.classList.remove("imnihher")}():+function(){wn.push(t);wn=[t];n.parentElement?.classList.add("imnihher")}();break;case"dance":yn.includes(t)?+function(){yn=yn.filter((e=>e!==t));yn=[];n.parentElement?.classList.remove("imnihher")}():+function(){yn.push(t);yn=[t];n.parentElement?.classList.add("imnihher")}();break;case"misc":En.includes(t)?+function(){En=En.filter((e=>e!==t));En=[];n.parentElement?.classList.remove("imnihher")}():+function(){En.push(t);En=[t];n.parentElement?.classList.add("imnihher")}();break}kn(e)}));switch(e){case"band":wn.includes(t.name)?n.classList.add("imnihher","imcurrentvold"):void 0;break;case"dance":yn.includes(t.name)?n.classList.add("imnihher","imcurrentvold"):void 0;break;case"misc":En.includes(t.name)?n.classList.add("imnihher","imcurrentvold"):void 0;break}return n}function kn(t){$("#evote_right_now").show();switch(t){case"band":le(wn,l.data.band_votes)?$("#evote_right_now").removeClass("imhere").addClass("imbye"):$("#evote_right_now").removeClass("imbye").addClass("imhere");break;case"dance":le(yn,l.data.dance_votes)?$("#evote_right_now").removeClass("imhere").addClass("imbye"):$("#evote_right_now").removeClass("imbye").addClass("imhere");break;case"misc":le(En,l.data.misc_votes)?$("#evote_right_now").removeClass("imhere").addClass("imbye"):$("#evote_right_now").removeClass("imbye").addClass("imhere");break}}function Ln(){ne("misc_event_venue_screen")}function In(t,e){return async function(){ne("event_scheduler_screen");An(t,e)}}async function An(t,e){const n=await m;$("#godric_manager_pre").empty().scrollTop(0);switch(t){case"band":$("#event_type").text("バンドスケジュール");break;case"dance":$("#event_type").text("ダンススケジュール");break;case"misc":$("#event_type").text(`${e} - スケジュール`);break}b.BAND_SCHEDULE_DELAY=Number.isNaN(b.BAND_SCHEDULE_DELAY)?n["b"]:b.BAND_SCHEDULE_DELAY;b.DANCE_SCHEDULE_DELAY=Number.isNaN(b.DANCE_SCHEDULE_DELAY)?n["d"]:b.DANCE_SCHEDULE_DELAY;const i=await f;var o=i[t];const[s,a]=[[],[]];const c=new Date;const r=t=="misc"?0:b[`${t.toUpperCase()}_SCHEDULE_DELAY`];var d=null;var l=c.getDate()<=15?1:2;if(t=="misc"){o=o[e||""]}for(const e of o.day1){const n=l==1?r:0;s.push(On(e,t,n))}for(const e of o.day2){const n=l==2?r:0;a.push(On(e,t,n))}var u=[];if(l==1){u=s}else if(l==2){s.forEach((t=>t.elm.classList.add("past_event")));u=a}const h=Sn(`${c.getHours()}:${c.getMinutes()}`);for(var p=0;p<u.length;p++){const t=u[p];const e=u[p+1];if(p==0&&h<t.ends){t.elm.classList.add("now_playing_event","metoscrkl");d=t.elm;break}t.elm.classList.add("past_event");if(e&&t.ends<h&&e.ends>=h){e.elm.classList.add("now_playing_event","metoscrkl");d=t.elm;break}if(!e){if(l==1){a[0].elm.classList.add("metoscrkl");d=a[0].elm}else if(l==2){t.elm.classList.add("metoscrkl");d=t.elm}}}const v=document.createElement("h2");const g=document.createElement("span");const _=[v.cloneNode(),v.cloneNode()];const w=document.getElementById("godric_manager_pre");g.classList.add("delayspan_");g.innerHTML=`${r}分遅延`;_[0].textContent="一日目";_[1].textContent="二日目";r!=0?_[l-1].appendChild(g):void 0;w?.appendChild(_[0]);s.forEach((t=>w?.appendChild(t.elm)));w?.appendChild(_[1]);a.forEach((t=>w?.appendChild(t.elm)));const y=(d?.offsetTop||0)-window.innerHeight/2+100+(d?.clientHeight||0)/2;$("#godric_manager_pre").scrollTop(y)}function On(t,e,n){const i=document.createElement("div");const o=Nn(t.starts,t.takes);i.innerHTML=`\n            <div class="event_scheduler_element">\n                <div class="scheduler_time_details">\n                    ${n==0?`\n                        ${t.starts} ~ ${o}\n                    `:`\n                        <span class="aviaTa">${t.starts} ~ ${o}</span>\n                        <span>${Nn(t.starts,n)} ~ ${Nn(o,n)}</span>\n                    `}\n                </div>\n                <div class="schedular_main_details">\n                    <div class="taC">\n                        <img class="Oiniums" src="/resources/cloud/event/${e}/${t.name.replace(/ |:|\?/g,"_")}/small_icon.png"\n                            onerror="this.remove()">\n                        <span class="iuahT">${t.name}</span>\n                    </div>\n                    <span class="AVKT">${t.description}</span>\n                    ${typeof t.musics=="undefined"?"":`\n                        <hr class="mucdivl">\n                        <span class="evmusics">楽曲: ${t.musics.join(", ")}</span>\n                    `}\n                </div>\n            </div>`;return{ends:Sn(Nn(o,n)),elm:i}}function Sn(t){const[e,n]=t.split(":").map((t=>Number(t)));return e*60+n}function Nn(t,e){var[n,i]=t.split(":").map((t=>Number(t)));i+=e;if(i>=60){const t=Math.floor(i/60);n+=t;i=i%60}return`${n}:${i.toString().padStart(2,"0")}`}function Rn(t){ne("drink_screen");$(".drinking").removeClass("uihsadW");$(".drinkings").scrollTop(0);if(t){const e=document.getElementById(`drank-${t}`);const n=(e?.offsetTop||0)-window.innerHeight/2+100+(e?.clientHeight||0)/2;$(".drinkings").scrollTop(n);e?.classList.add("uihsadW")}}+function(){Array.from(document.querySelectorAll(".drink-real > img")).forEach((function(t){t.addEventListener("click",(function(){yo.popupMedia(t.getAttribute("src")||"","img",t.cloneNode())}))}))}();"use strict";function jn(){ne("tickets_screen");Mn()}function Mn(){const e=[...l.data.tickets];$("#ticket_component > .afIOUW, .iuhagW").remove();if(e.length==0){const e=document.createElement("span");e.classList.add("iuhagW");e.textContent=TEXTS[t].HOW_TO_TICKET;$("#ticket_component").append(e);return}for(const t of e){const e=document.createElement("span");e.classList.add("afIOUW");const n=document.createElement("h4");n.classList.add("awWg");n.textContent=t.visual.description;e.appendChild(n);const i=document.createElement("section");i.classList.add("ticketman");e.appendChild(i);const o=document.createElement("div");o.classList.add("sauaA","protected");i.appendChild(o);const s=document.createElement("img");s.classList.add("agiuW");s.src=t.visual.image;o.appendChild(s);const a=document.createElement("div");a.classList.add("asIgW");i.appendChild(a);const c=document.createElement("p");c.textContent=t.visual.moredetails;a.appendChild(c);const r=document.createElement("div");r.classList.add("diusahG");a.appendChild(r);const d=document.createElement("div");d.classList.add("shishijibtn","AWtv");d.style.width="130px";r.appendChild(d);const l=document.createElement("span");l.textContent="使用する";d.appendChild(l);const u=document.createElement("div");u.classList.add("shishijibtn","AWtv");u.style.width="130px";r.appendChild(u);const h=document.createElement("span");h.textContent="場所を確認";u.appendChild(h);d.addEventListener("click",Dn(t));u.addEventListener("click",(()=>{ie("tickets_screen");no(t.visual.use_coords)}));$("#ticket_component").prepend(e)}}function Dn(t){return async function(){ne("ticket_use_screen");$("#_what_ticket").text(t.visual.description);$("#ticket_qrcode").attr("src",t.qrcode)}}function Bn(){ne("tea_screen");const t=l.data.completed_orgs;$("#ASUgAJs > div").remove();for(const e of Object.values(V)){$("#ASUgAJs").append(`\n                <div>\n                    <input id="__W${e.discriminator}" type="checkbox" class="setartw" who="${e.discriminator}" ${t.includes(e.discriminator)?"checked":""}>\n                    <lable for="__W${e.discriminator}">${e.discriminator}</lable>\n                </div>\n            `);$(`#__W${e.discriminator}`).on("input",(function(){$.post("/.dev/faith",{_where:this.getAttribute("who"),_process:this.checked?"add":"remove"}).then((async t=>{l.data.completed_orgs=t;Gi();if(await Vn()){_e("1")}}))}))}}function Hn(){ne("showcase_screen")}async function Xn(){ne("stamp_rally_screen");await Pn();if(ye("ranking")){y.pkgo=true;setTimeout((()=>Ee("ranking")),300)}}async function Pn(){const e=[1/5,3/5,5/5];const n=await p;const i=await v;const o=structuredClone(l.data.claimed_rpt);const s=[];const a={};$("#intermain, #aka-keeen").empty();function c(){Object.values(a).some((t=>t==true))?we("1"):_e("1")}function r(){const t=s.map((t=>`<div class="comaos"><p>${t}</p></div>`)).join("");if(!document.getElementById("asW"))$("#aka-keeen").append(`\n                    <div class="aaiV" id="asW">\n                        <span class="sagAW">完了済み</span>\n                        ${t}\n                    </div>`);else $("#asW").append(t);s.length=0}for(const i of["1F","2F","3F","4F"]){+function(i){const d=ue(i,true);const u=d.length;const h=o[i];const f=[];const m=document.createElement("span");var p=0;var v=u*e[0];var g=0;document.getElementById("intermain")?.appendChild(m);for(const t of d){he(t)?p++:void 0}for(var _=0;_<e.length;_++){const t=e[_];const n=Math.floor(u*t);if(n==0)break;if(n>p){v=n;break}else{if(h<_){f.push(_);a[i]=true}}g++}const w=n[i][g]||0;function y(t,e){e?c():void 0;if(p==u){s.push(`${i}の団体を全て訪れる`);if(e){m.classList.add("asbHW");setTimeout((()=>m.remove()),100)}else{m.remove()}r();return}const n=Gn({title:`${i} の団体を${v}コ訪れる`,progress:p/v*100,compPT:w,reelcount:p},t);m.appendChild(n)}if(f.length>0){const o=[];for(const t of f){const s=Fn({title:`${i} の団体を${Math.floor(u*e[t])}コ訪れる`,progress:100,compPT:n[i][t],reelcount:Math.floor(u*e[t])});o.push({rwidx:t,elm:s})}var E=0;for(const e of o){+function(e){e.elm.addEventListener("click",(async function(){this.classList.add("plopper");ae(`getrpt-${i}-${e.rwidx}`,"top");$.post(ajaxpath.uactrpt,{floor:i,idx:e.rwidx}).then((t=>{const e=t.neu;const n=t.ucl;const i=t._gets;l.data.pt=Number(e);l.data.claimed_rpt=n;Wn();ge(`${i}pt`);me();if(!Vn())we("1")})).catch((()=>{_o.notifyError(TEXTS[t].SRY_OPEN_AGAIN)})).always((()=>ce(`getrpt-${i}-${e.rwidx}`,"top")));setTimeout((()=>{const t=o[++E];if(t){t.elm.classList.add("awlvig");m.appendChild(t.elm)}else{a[i]=false;delete a[i];y(true,true)}this.remove()}),550)}))}(e)}m.appendChild(o[0].elm)}else{y(false,false)}}(i)}function d(e,n){return async function(){this.classList.add("plopper");s.push(e.title);r();setTimeout((()=>{n.classList.add("asbHW");setTimeout((()=>n.remove()),100)}),550);$.post(ajaxpath.uactrsppt,{mission_id:e.mission_id}).then((t=>{ge("チケット");a[e.mission_id]=false;delete a[e.mission_id];l.data.tickets=t._new;l.data.claimed_rpt=t._dnew;c()})).catch((e=>{_o.notifyError(TEXTS[t].SRY_OPEN_AGAIN)}))}}for(const t of i){if(o.specials.includes(t.mission_id)){s.push(t.title);r();continue}+function(t){const e=document.createElement("span");const n=l.data.pt/t.required_pt*100;document.getElementById("intermain")?.appendChild(e);const i=d(t,e);if(n>=100){const n=Fn({title:t.title,reward:t.reward});n.addEventListener("click",i);e.appendChild(n);a[t.mission_id]=true}else{const n=Un(t,false);e.appendChild(n);n.addEventListener("become-claimable",(function(){const n=Fn({title:t.title,reward:t.reward});this.remove();n.addEventListener("click",i);e.appendChild(n);a[t.mission_id]=true}))}}(t)}}function Un(t,e){const n=l.data.pt/t.required_pt*100;const i=document.createElement("section");i.classList.add("diauHOkjkjsa",e?"awlvig":"_","av8YWTg");i.innerHTML=`\n            <div class="execil">\n                <div class="cureft"><p>${t.title}</p></div>\n                <div class="stampprogress specialprogress" requires="${t.required_pt}">\n                    <span style="width:${n}%"></span>\n                    <div style="left:calc(${n}% - 4.5px)">${l.data.pt}</div>\n                </div>\n            </div>\n            <div class="execij flxxt agawt">\n                <img src="${t.reward.image}" class="auiwB">\n                <p>${t.reward.description}</p>\n            </div>\n        `;return i}function Wn(){$(".specialprogress").each((function(){const t=this.children[0];const e=this.children[1];const n=Number(this.getAttribute("requires"));const i=l.data.pt/n*100;if(i>=100){this.parentElement?.parentElement?.dispatchEvent(new Event("become-claimable"))}else{$(t).css("width",`${i}%`);$(e).css("left",`calc(${i}% - 4.5px)`).text(l.data.pt.toString())}}))}function Gn(t,e){const n=document.createElement("section");n.classList.add("diauHOkjkjsa",e?"awlvig":"_");n.innerHTML=`\n            <div class="execil">\n                <div class="cureft"><p>${t.title}</p></div>\n                <div class="stampprogress">\n                    <span style="width:${t.progress}%"></span>\n                    <div style="left:calc(${t.progress}% - 4.5px)">${t.reelcount}</div>\n                </div>\n            </div>\n            <div class="execij flxxt">\n                <span>\n                    <h4>${t.compPT}pt</h4>\n                </span>\n            </div>\n        `;return n}function Fn(t){const e=document.createElement("section");const n=t.reelcount?`\n            <span>\n                <h4>${t.compPT}pt</h4>\n            </span>`:`<img src="${t.reward.image}" class="auiwB"><p>${t.reward.description}</p>`;e.classList.add("uoihgfaSJD");e.innerHTML=`\n            <div class="execil flxxt">\n                <div class="gjaiuags">\n                    <p>リワードを受け取る</p>\n                    <p class="smallerp">${t.title}</p>\n                </div>\n            </div>\n            <div class="execij flxxt AMVat agawt">\n                ${n}\n            </div>\n        `;return e}function Yn(t,e){const n=document.createElement("section");n.classList.add("iuhgihuASG",e?"awlvig":"_");n.innerHTML=`\n            <div class="euahcn flxxt">\n                <div class="gjaiuags">\n                    <h4>${t.title} (${t.reelcount}コ)</h4>\n                </div>\n            </div>\n        `;return n}function qn(){ne("ranking_screen");Jn()}function Jn(){ae("getting-mission-ranking","top");$(".ahugihdb").hide();$(".hbSDBs").addClass("gaius");$("#aboigHSDV").empty();$.post(ajaxpath.ranking).then((t=>{var e=false;var n={pt:Infinity,place:0,dps:1,pre:0};for(var i=1;i<=t.length;i++){const r=t[i-1];const d=pe(r.pt);var o=r.pt<n.pt?n.pre+n.dps:n.pre;var s=`<b-i>${o}</b-i>`;var a="";if(r.pt<n.pt){n.dps=1}else{n.dps++}n.pre=o;if(o<=3){var c="";if(o==1){c="giuja";a+="oaguhsT"}else if(o==2){c="giujaR";a+="h4eADFS"}else if(o==3){c="giujfR";a+="gAJISW3"}s=`<h2 class="${c}">${o}</h2>`}$("#aboigHSDV").append(`\n                    <div class="ranking_person ${a} ${r.disc==l.discriminator?"hugaop":""}" id="printouts-${r.disc}">\n                        <div class="reavhs">\n                            ${s}\n                            <div style="${r.icp?`background-image:url(${r.icp})`:""}">\n                                <div class="usahbas" style="${d?`background-image:url(${d})`:""}"></div>\n                            </div>\n                            <h4>${r.nick}</h4>\n                        </div>\n                        <p>${r.pt}pt</p>\n                    </div>`);n.pt=r.pt;n.place=o;!e?r.disc==l.discriminator?e=!e:void 0:void 0}if(e){$(".hbSDBs").removeClass("gaius");$(".ahugihdb").show()}else{$(".gaius").append(document.createElement("h-j"))}})).catch((()=>_o.notifyError(TEXTS[t].FAILED_TO_LOAD_RANKING))).always((()=>ce("getting-mission-ranking","top")))}function zn(){const t=`printouts-${l.discriminator}`;document.getElementById(t)?.scrollIntoView({behavior:"smooth",block:"center"})}async function Vn(){const t=[1/5,3/5,5/5];const e=l.data.claimed_rpt;var n=false;for(const i of["1F","2F","3F","4F"]){if(n)break;+function(i){const o=ue(i,true);const s=o.length;const a=e[i];var c=0;var r=s*t[0];var d=0;for(const t of o){he(t)?c++:void 0}for(var l=0;l<t.length;l++){const e=t[l];const i=Math.floor(s*e);if(i==0)break;if(i>c){r=i;break}else{if(a<l){n=true;break}}d++}}(i)}const i=await v;for(const t of i){if(n)break;+function(t){const e=l.data.pt/t.required_pt;if(e>=1&&!l.data.claimed_rpt.specials.includes(t.mission_id)){n=true}}(t)}return n}const Kn=[[[2100,384],[1170,435]]];function Zn(t,e){Kn}function Qn(t,e){const n=ri(t),i=ri(e);o.beginPath();o.lineWidth=20*a;o.strokeStyle="#009dff";o.moveTo(n[0],n[1]);o.lineTo(i[0],i[1]);o.stroke();o.closePath()}function ti(t,e){const n=ri(t);const i=o.measureText(e).width;n[0]-=i/2;n[1]+=8;o.textBaseline="alphabetic";o.font="16px Calligraphed";o.fillStyle="#ffffff";o.fillText(e,n[0],n[1])}function ei(t){if(t.length==1)return 0;var e=0;var n=0;var i=0;for(var o of Array.from(t)){e+=o.clientX;n+=o.clientY}const s={x:e/t.length,y:n/t.length};for(var o of Array.from(t)){const t=Math.abs(Math.sqrt((o.clientX-s.x)**2+(o.clientY-s.y)**2));i+=t}return 2*i/t.length}function ni(t){var e=0;var n=0;const i=t.length;for(const i of t){e+=i.clientX;n+=i.clientY}e/=i;n/=i;return[e,n]}function ii(t){const e=Math.abs,n=Math.sqrt,i=Math.pow;const o=[t[0].clientX,window.innerHeight-t[0].clientY],s=[t[1].clientX,window.innerHeight-t[1].clientY];const a=[o,s];const c=e(n(i(a[0][0]-a[1][0],2)+i(a[0][1]-a[1][1],2)));const r=1/c*(a[1][1]-a[0][1]);const d=1/c*(a[1][0]-a[0][0]);var l=Math.acos(d);if(r<0){l=2*Math.PI-l}if(Math.abs(l-W)>Math.PI/2){}return l}function oi(t){H.touches=[];for(var e of t){H.touches.push({x:e.clientX,y:e.clientY});H.real=Array.from(t)}}function si(t){var e=new te(t[0],t[1]);for(const t of u){e=e.rotate(-t.arg,t.canvasOrigin)}return di([e.real,e.imag])}function ai(t){const e=[[t[0].clientX,t[0].clientY],[t[1].clientX,t[1].clientY]];const n=[e[0][0]+e[1][0]/2,e[1][1]+e[0][1]/2];return n}function ci(t,e){return Math.abs(Math.sqrt((t.clientX-e.clientX)**2+(t.clientY-e.clientY)**2))}function ri(t){return[(t.x-C.canvas.coords.x)*a,(t.y-C.canvas.coords.y)*a]}function di(t){return{x:t[0]/a+C.canvas.coords.x,y:t[1]/a+C.canvas.coords.y}}function li(t){return{x:t[0]/a+C.canvas.coords.x,y:t[1]/a+C.canvas.coords.y}}async function ui(e,n,s){const a=e.xrange;const c=e.yrange;const r=e.tile_width;const d=e.tile_height;const l=e.format;var u=[];var h=0;var f=0;var m=[];const p=(a+1)*(c+1);const v={width:(a+1)*r,height:(c+1)*d};const g=2**12;o.clearRect(0,0,i.width,i.height);I.forEach((t=>t.forEach((t=>t.remove()))));I.splice(0);function _(t,e){const n=document.createElement("canvas");n.width=t;n.height=e;return n}if(v.width*v.height>2**24){for(var w=0;w<Math.ceil(v.width/g);w++){for(var y=0;y<Math.ceil(v.height/g);y++){const t=_(g,g);y>0?I[w].push(t):I[w]=[t]}}}else{const t=_(v.width,v.height);I[0]=[t]}const E={all:(a+1)*(c+1),loaded:0};function x(t,e,n,i,o){const s=Math.floor;const a=[e,n];const c=[e+i,n+o];const r=[s(a[0]/g),s(a[1]/g)];const d=[s(c[0]/g),s(c[1]/g)];const l=[...a];const u=[...r];var h=i;var f=o;var m=e%g;var p=n%g;const v=[0,0];for(var _=r[1];_<=d[1];_++){var w=f;if(s((p+f)/g)/s(p/g)>1){w=g-p%g}h=i;m=e%g;v[0]=0;u[0]=r[0];for(var y=r[0];y<=d[0];y++){while(h>0){var E=h;if(s((m+h)/g)/s(m/g)>1){E=g-m%g}if(m==g)m=0;if(p==g)p=0;const e=A(u[0],u[1]);e?.getContext("2d")?.drawImage(t,v[0],v[1],E,w,m,p,E,w);u[0]++;m+=E;v[0]+=E;h-=E}}p+=w;f-=w;v[1]+=w;u[1]++}}return new Promise((e=>{for(var n=0;n<=c;n++){for(var i=0;i<=a;i++){var o=r,v=d,g=v*i,_=o*n;!function(n,i,o,a,c,r){const d=new Image;const v=Et(l,i,n);d.onload=function(){x(d,o,a,c,r);f++;E.loaded++;u.push(d);if(s)s(E.loaded,E.all);if(u.length>=p)e("map loaded")};function g(){var e=S;const n=setInterval((()=>{Nt(Et(TEXTS[t].MAP_LOAD_RETRYING,e));$(".loader__icon").removeClass("_gloads").addClass("_bgoods");_o.notify("no-wifi",TEXTS[t].NOTIFICATION_CHECK_YOUR_CONNECTION,{duration:5e3,discriminator:"check ur WiFi",deny_userclose:true});e--;if(e<=-1){$(".loader__icon").removeClass("_bgoods").addClass("_gloads");w();clearInterval(n)}}),1e3)}function _(){var t=S;f++;if(f>=p)g()}function w(){for(const n of m){const i=new Image;const o=n.src;if(s)s(E.loaded,E.all);else Nt(TEXTS[t].LOADING_MAP);f--;i.onload=function(){x(i,n.dx,n.dy,n.dw,n.dh);m=m.filter((t=>{if(t.src!=o)return true}));f++;E.loaded++;u.push(i);if(s)s(E.loaded,E.all);if(u.length>=p)e("map loaded");else if(f>=p)g()};i.onerror=_;i.src=o}}d.onerror=()=>{m.push({x:n,y:i,dx:o,dy:a,dw:c,dh:r,src:v});_()};setTimeout((()=>{d.src=v}),h);h+=_t;return 0}(i,n,g,_,v,o)}}})).then((()=>{window.scroll({top:0,behavior:"instant"});function t(t){const e=document.createElement("canvas");const n=A()||[[]];var i=0;var o=0;t=t===void 0?1:t;o=n.length*2**12;i=n[0].length*2**12;e.width=i;e.height=o;var s=0;for(const t of n){var a=0;for(const n of t){e.getContext("2d")?.drawImage(n,0,0,n.width,n.height,s*2**12,a,n.width,n.height);a+=n.height}s++}const c=document.createElement("canvas");var r=1,d=[1];c.width=window.innerWidth*t;c.height=window.innerHeight*t;d=[c.width/e.width,c.height/e.height];r=Math.max(...d);c.getContext("2d")?.drawImage(e,0,0,e.width,e.height,0,0,e.width*r,e.height*r);c.style.top="0";c.style.left="0";c.style.zIndex="9999999";c.style.position="fixed";c.style.pointerEvents="none";c.id="canvas_children_debugger";document.body.prepend(c)}if(typeof n==="function")n(u)}))}function hi(t){const e=10**ft;const n=[C.canvas.coords.x,C.canvas.coords.y];const i=t?a:Math.round(a*e)/e;const o=t?n[0]+","+n[1]:Math.round(n[0]*e)/e+","+Math.round(n[1]*e)/e;Bt(mt.ZOOM_RATIO,i);Bt(mt.COORDS,o)}function fi(t,e,n){if(e===void 0){e=a}const i=document.getElementById("shishiji-canvas");const o=i.getContext("2d");const s={top:window.innerHeight/2,left:window.innerWidth/2};const c={x:(e*t.x-s.left)/e,y:(e*t.y-s.top)/e};a=e;C.canvas.coords=c;_i({left:0,top:0});n?hi():void 0}function mi(t,e,n){const i=`<h4>${e?.over||""}</h4><div id="map_load_progress"><div id="ml_progress"></div></div><h4>${e?.under||""}</h4>`;ui(t,n,(function(t,e){var n=t/e;const o=document.getElementById("ml_progress");if(!o){Nt(i)}}));return function(t){document.getElementById("ml_progress").style.width=t*100+"%"}}function pi(t){const e=new Image;e.src=t.spare;t.spareImage=e;return t}function vi(t){if(t instanceof MouseEvent)e=[t.clientX,t.clientY];else e=ni(t)}function gi(t){W=ii(t)}function _i(t,e){const[n,o]=[Math.sin(-G),Math.cos(-G)];const s={...t};t={top:s.top*o-s.left*n,left:s.top*n+s.left*o};var c=C.canvas.coords.x-t.left/a,r=C.canvas.coords.y-t.top/a;C.canvas.width=i.width/a;C.canvas.height=i.height/a;C.canvas.coords={x:c,y:r};const d=5e3;const l=5e3;if(C.canvas.coords.x+C.canvas.width>d){C.canvas.coords.x=d-C.canvas.width}if(C.canvas.coords.y+C.canvas.height>l){C.canvas.coords.y=l-C.canvas.height}if(C.canvas.coords.x<2500-d){C.canvas.coords.x=2500-d}if(C.canvas.coords.y<2500-l){C.canvas.coords.y=2500-l}xi(C,...[C.canvas.coords.x,C.canvas.coords.y],C.canvas.width,C.canvas.height,0,0,i.width,i.height,e)}function wi(t,e,n){const i=C.canvas.coords.y-n.left/a;const o=C.canvas.coords.x-n.top/a;C.canvas.coords={x:i,y:o};C.canvas.width=t.width/a;C.canvas.height=t.height/a;e.clearRect(0,0,t.width,t.height);e.drawImage(C,Math.floor(C.canvas.coords.x),Math.floor(C.canvas.coords.y),Math.floor(C.canvas.width),Math.floor(C.canvas.height),0,0,t.width,t.height)}function yi(t,e,n,o,s){if(Ut(t,false))return;n??=[C.canvas.coords.x,C.canvas.coords.y];a=o?t:a*t;if(e.length==2&&t!=1){var c=[];for(var r=0;r<2;r++){c.push(e[r]*(t-1)/a+n[r])}C.canvas.coords={x:c[0],y:c[1]}}C.canvas.width=i.width/a;C.canvas.height=i.height/a;if(!s)xi(C,Math.floor(C.canvas.coords.x),Math.floor(C.canvas.coords.y),Math.floor(C.canvas.width),Math.floor(C.canvas.height),0,0,i.width,i.height)}function Ei(t,e,n,i,o){if(O.caps.ratio.max<a&&n>1||O.caps.ratio.min>a&&n<1)return;o??=[C.canvas.coords.x,C.canvas.coords.y];a*=n;if(i.length==2&&n!=1){var s=[];for(var c=0;c<2;c++){s.push(i[c]*(n-1)/a+o[c])}C.canvas.coords={x:s[0],y:s[1]}}C.canvas.width=t.width/a;C.canvas.height=t.height/a;e.clearRect(0,0,t.width,t.height);e.drawImage(C,Math.floor(C.canvas.coords.x),Math.floor(C.canvas.coords.y),Math.floor(C.canvas.width),Math.floor(C.canvas.height),0,0,t.width,t.height)}function $i(t,e){const n=[0,0];const i=t.getContext("2d");function o(e){return Math.max(t.width/e.width,t.height/e.height)}if(typeof e=="string"){i?.beginPath();i.fillStyle=e;i?.fillRect(0,0,t.width,t.height);i?.stroke();i?.closePath()}else{const c=o();if(c<1){i?.drawImage(e,...n,e.width*c,e.height*c)}else if(e.width!=0&&e.height!=0){for(var s=0;s<Math.ceil(t.height/e.height);s++){for(var a=0;a<Math.ceil(t.width/e.width);a++){i?.drawImage(e,...n,e.width,e.height);n[0]+=e.width}n[0]=0;n[1]+=e.height}}}}function xi(t,e,n,s,c,r,d,l,h,f){const m=[e,n];var p;var v=[e,n,s,c,r,d,l,h];f??={rotated:0,origin:[i.width/2,i.height/2]};const g=Math.floor;const _=A();const w=l/s;const y=C.getContext("2d");const E=ot[st].spare;y?.clearRect(0,0,C.width,C.height);o.clearRect(0,0,i.width,i.height);if(e<0||n<0){p=m.map((t=>-t));v=[0,0,s-p[0],c-p[1],p[0]*a,p[1]*a,l-p[0]*a,h-p[1]*a]}if(_&&_.length==1&&_[0].length==1){function $(t){const e=t.origin;const n=li(e);G+=t.rotated;u.push({canvasOrigin:new te(e[0],e[1]),BackOrigin:new te(n.x,n.y),arg:t.rotated});function s(t){return Math.pow((t[0]-e[0])**2+(t[1]-e[1])**2,.5)}const a=document.createElement("canvas");const c=Math.max(s([0,0]),s([0,i.height]),s([i.width,0]),s([i.width,i.height]));const r=c*2;const d=a.getContext("2d");const l=li([e[0]-c,e[1]-c]);const h=li([e[0]+c,e[1]+c]);const f={width:h.x-l.x,height:h.y-l.y};a.width=a.height=r;d?.translate(c,c);d?.rotate(-G);d?.translate(-c,-c);$i(a,E);const m={sx:l.x,sy:l.y,sw:f.width,sh:f.height,dx:0,dy:0,dw:r,dh:r};if(m.sx<0||m.sy<0){const t=r/f.width;m.sw=m.sw+m.sx;m.sh=m.sh+m.sy;m.sx=m.sy=0;m.dx=m.dw-m.sw*t;m.dy=m.dh-m.sh*t;m.dw=m.sw*t;m.dh=m.sh*t}d?.drawImage(_[0][0],...Object.values(m));o.drawImage(a,c-e[0],c-e[1],c-e[0]+i.width-(c-e[0]),c-e[1]+i.height-(c-e[1]),0,0,i.width,i.height);Yi();qi();a.remove()}function x(t){C.width=i.width;C.height=i.height;$i(C,E);y?.drawImage(_[0][0],...v);o.drawImage(C,Math.floor(r),Math.floor(d),Math.floor(l),Math.floor(h));Yi();qi()}x(f)}else{C.width=l-2;C.height=h-2;$i(C,E);if(e<0){v[2]=s;v[4]=g(-e*w)}if(n<0){v[3]=c;v[5]=g(-n*w)}const j=v[0],M=v[1],D=v[2],B=v[3],H=v[4],X=v[5],P=v[6],U=v[7];const W=2**12;const F=[j,M];const Y=[j+D,M+B];const q=[g(F[0]/W),g(F[1]/W)];const J=[g(Y[0]/W),g(Y[1]/W)];const z=[...q];var b=D;var T=B;var k=j%W;var L=M%W;const V=[g(H),g(X)];const K=[b,T];const Z=[...V];for(var I=q[1];I<=J[1];I++){var O=T;L=L%W;if(g((L+T)/W)/g(L/W)>1){O=W-L%W}b=K[0];k=j%W;V[0]=Z[0];z[0]=q[0];for(var S=q[0];S<=J[0];S++){while(b>0){var N=b;if(g((k+b)/W)/g(k/W)>1){N=W-k%W}if(k==W)k=0;if(L==W)L=0;const Q=A(z[0],z[1]);const tt=g(N*w),et=g(O*w);if(Q!=null)y?.drawImage(Q,Math.floor(k),Math.floor(L),Math.floor(N),Math.floor(O),Math.floor(V[0]),Math.floor(V[1]),Math.floor(tt),Math.floor(et));z[0]++;k+=N;b-=N;V[0]+=tt}}L+=O;T-=O;V[1]+=g(O*w);z[1]++}ctx.drawImage(C,r,d,l,h);function*R(){for(var t=q[1];t<=J[1];t++){for(var e=q[0];e<=J[0];e++){const n=A(e,t);const i=F[0]-W*e,o=q[1]-W*t,s=J[0]*W>Y[0]?W:Y[0]-W*e,a=J[1]*W>Y[1]?W:Y[1]-W*t;if(n!=null)C.getContext("2d")?.drawImage(n,Math.floor(i),Math.floor(o),Math.floor(s),Math.floor(a),0,0,C.width,C.height)}}xi(C,C.canvas.coords.x,C.canvas.coords.y,C.canvas.width,C.canvas.height,0,0,i.width,i.height)}Yi();qi()}}function bi(t,e){if(e===void 0){e=C.canvas.rotation}function n(e){return Math.pow((e[0]-t[0])**2+(e[1]-t[1])**2,.5)}const s=C.getContext("2d");const a=document.createElement("canvas");const c=Math.max(n([0,0]),n([0,i.height]),n([i.width,0]),n([i.width,i.height]));const r=c*2;const d=li([t[0]-c,t[1]-c]);const l=li([t[0]+c,t[1]+c]);const u=a.getContext("2d");const h=ot[st].spareImage||new Image;a.width=a.height=r;s?.clearRect(0,0,C.width,C.height);o.clearRect(0,0,i.width,i.height);C.width=i.width;C.height=i.height;$i(C,h);s?.drawImage(A()[0][0],C.canvas.coords.x,C.canvas.coords.y,C.canvas.width,C.canvas.height,0,0,i.width,i.height);u?.translate(c,c);u?.rotate(-e);u?.drawImage(C,-c,-c,r,r,d.x,d.y,l.x-d.x,l.y-d.y);o.drawImage(a,0,0,i.width,i.height,c-t[0],c-t[1],c-t[0]+i.width-(c-t[0]),c-t[1]+i.height-(c-t[1]))}function Ci(t){var e=[-1,-1];const n=Math.abs;const i=t.touches;var o=false;Y++;const s={previous:{slope:(H.real[0].clientY-H.real[1].clientY)/(H.real[0].clientX-H.real[1].clientX)},this:{slope:(i[0].clientY-i[1].clientY)/(i[0].clientX-i[1].clientX)}};const a=ei(i);var c=a/B.distance;if(B.x==-1&&B.y==-1&&B.distance==-1){c=1}B.distance=a;if(s.previous.slope==s.this.slope){var r=i[0].clientX-H.touches[0].x;var d=i[1].clientX-H.touches[1].x;r===0&&d===0||r+d==0?r=d=1:void 0;const t=r/(n(r)+n(d));const e=n(i[0].clientX-i[1].clientX)*t;const o=n(i[0].clientY-i[1].clientY)*t;const s=[i[0].clientX+e,i[0].clientY+o];H.middle=s}else{const t=(H.real[0].clientX*s.previous.slope-i[0].clientX*s.this.slope-H.real[0].clientY+i[0].clientY)/(s.previous.slope-s.this.slope);const n=s.this.slope*(t-i[0].clientX)+i[0].clientY;e=[t,n];if(!e.some((t=>isNaN(t))))0}if(Ut(c,false))c=1;const l=ni(H.real);const u=ni(i);const h=l[0]*c;const f=l[1]*c;const m=u[0]-h;const p=u[1]-f;var v=0;+function(){const t=Math.PI;const e=ii(i);if(W===-1)v=0;else if(0<=W&&W<=t&&t*(3/2)<=e&&e<=2*t)v=-(2*t-e+W);else if(0<=e&&e<=t&&t*(3/2)<=W&&W<=2*t)v=2*t-W+e;else v=e-W;W=e;P+=Math.abs(v);X+=v;if(Math.abs(X)>$t(O.touch.rotate.min)||U){if(!U){X-=$t(O.touch.rotate.min)}U=o=true}}();if(Y>O.touch.zoomCD){yi(c,[0,0],void 0,void 0,true);_i({top:p,left:m},o?{rotated:v,origin:e}:void 0)}return{diffRatio:c,crossPos:e,rotation:v,allowRotation:o}}function Ti(t){const n=t.touches;const i=ni(n);const o=e;var s={diffRatio:1,crossPos:[-1,-1],rotation:0,allowRotation:false};e=i;if(F<O.touch.downCD){F++;return}if(n.length>=2&&H.real!==void 0&&H.real.length>=2){s=Ci(t);H.zoom=true}else{U=false;X=0;P=0;W=-1;Y=0;H.cross=[-1,-1];function a(){var t={clientX:H.real[0].clientX,clientY:H.real[0].clientY,velocity:j[0]};var e={clientX:H.real[1].clientX,clientY:H.real[1].clientY,velocity:j[1]};+function(t,e){const n=[t,e];const i=j.a;function o(t){return t<0?-1:1}if(D!==null)clearInterval(D);if(isNaN(t.velocity.x)||isNaN(t.velocity.y)||isNaN(e.velocity.x)||isNaN(e.velocity.y))return}(t,e)}if(false)a();H.zoom=false}if(!o.some((t=>t===null))&&n.length==1){const c={left:i[0]-o[0],top:i[1]-o[1]};_i(c)}H.cross=s.crossPos;oi(n)}function ki(t){var e=O.scroll*1;t.deltaY>0?e=1/e:void 0;yi(e,n)}function Li(t){const e=$t(2);const i=t.deltaY<0?1:-1;_i({top:0,left:0},{rotated:e*i,origin:n})}function Ii(t){const n=[t.clientX,t.clientY];const i={left:n[0]-e[0],top:n[1]-e[1]};_i(i);e=n}function Ai(...t){}const Oi={arrowup:{pressing:false,_do:function(t){if(!Si.ctr)t.top+=Si.shift?O.arrowkeys.nosprint:O.arrowkeys.move;else yi(Si.shift?O.arrowkeys.nosprintratio:O.arrowkeys.ratio,[i.width/2,i.height/2]);return t},_leave:function(){Ai(0,O.arrowkeys.move*1e3/O.arrowkeys.interval)}},arrowdown:{pressing:false,_do:function(t){if(!Si.ctr)t.top+=Si.shift?-O.arrowkeys.nosprint:-O.arrowkeys.move;else yi(Si.shift?1/O.arrowkeys.nosprintratio:1/O.arrowkeys.ratio,[i.width/2,i.height/2]);return t},_leave:function(){Ai(0,-O.arrowkeys.move*1e3/O.arrowkeys.interval)}},arrowleft:{pressing:false,_do:function(t){t.left+=Si.shift?O.arrowkeys.nosprint:O.arrowkeys.move;return t},_leave:function(){Ai(O.arrowkeys.move*1e3/O.arrowkeys.interval,0)}},arrowright:{pressing:false,_do:function(t){t.left+=Si.shift?-O.arrowkeys.nosprint:-O.arrowkeys.move;return t},_leave:function(){Ai(-O.arrowkeys.move*1e3/O.arrowkeys.interval,0)}}};const Si={ctr:false,shift:false};var Ni=0;function Ri(){clearInterval(Ni);clearTimeout(N);Ni=setInterval((()=>{var t={top:0,left:0};for(const e in Oi){if(Oi[e].pressing)t=Oi[e]._do.call(0,t)}_i(t)}),O.arrowkeys.interval)}function ji(){clearInterval(Ni)}window.addEventListener("keydown",(function(t){const e=t.key.toLowerCase();Si.ctr=t.ctrlKey;Si.shift=t.shiftKey;if(e in Oi){var n=0;Object.keys(Oi).forEach((t=>{if(Oi[t].pressing)n++}));if(n==0){Ri()}Oi[e].pressing=true}}));window.addEventListener("keyup",(function(t){const e=t.key.toLowerCase();Si.ctr=t.ctrlKey;Si.shift=t.shiftKey;if(e in Oi){Oi[e].pressing=false;var n=0;Object.keys(Oi).forEach((t=>{if(Oi[t].pressing)n++}));if(n==0){ji();N=setTimeout((()=>{hi()}),d)}}}));async function Mi(t){const e=document.getElementById("shishiji-view");const n=document.getElementById("shishiji-overview");const i=t.object.type.behavior;const o=t.discriminator;var s=1001;const c={x:(t.object.coordinate.x-C.canvas.coords.x)*a,y:(t.object.coordinate.y-C.canvas.coords.y)*a};var r="";var d="";var l="pointer";const u=Et(vt,o);const h=Vt(t);const f=h(o,t.object.images.icon);const m=new Date;const p=m.getDay();const v=p<=15?1:2;switch(i){case"dynamic":d+="popups realshadow ";break;default:case"static":s=999;d+="mapObj_static";if(!t.object.type.border)r+="border: none; border-radius: 0; background-color: transparent;";if(!t.article&&!t.object.open_screen){r+="cursor: default; pointer-events: none;";l="default"}break}if(t.object.open_screen){d+="aiughW "}const g={df:"",st:""};g.df=`dfsize="${t.object.size.width} ${t.object.size.height}"`;g.st=`min-width:${t.object.size.width}px;min-height:${t.object.size.height}px;max-width:${t.object.size.width}px;max-height:${t.object.size.height}px;`;const _=`\n            <div id="${u}" class="mpob centeral" style="transform: translate(${c.x}px, ${c.y}px); z-index: ${s};${t.object.day&&t.object.day!=v?"display:none":""}"\n                coords="${t.object.coordinate.x} ${t.object.coordinate.y}"\n                behavior="${t.object.type.behavior}"\n                ${g.df}>\n                <div class="flxxt ${i=="dynamic"?"interrealface":""} canvas_interactive mpobmctx ${d}" style="${g.st}${r}" dfcs="${l}">\n                    <div class="ashuW" style="background-image:url('${f}')"></div>\n                </div>\n            </div>`;$(e).append(_);t.article?Ki(t.discriminator,t.article.crowd_status):void 0;const w=$(e).children()[$(e).children().length-1];if(t.article){Mt(w,(function(e,n){const i=t;this.children[0].classList.add("ADSHIiuhbgnajsyu");oo.reduceCoro.push((()=>this.children[0].classList.remove("ADSHIiuhbgnajsyu")));so();lo(i,true);Bt(mt.ARTICLE_ID,t.discriminator);hi();R.v=R.x=R.y=0}),{forceLeft:true,arg1:function(){return void 0}})}else if(t.object.open_screen){Mt(w,(function(){if(t.object.open_screen=="drink_screen"){Rn(t.discriminator)}else{ne(t.object.open_screen||"")}}))}}function Di(){$(".mpob").remove()}function Bi(t){var e=t.getContext("2d");var n=t.width;var i=t.height;var o=e.getImageData(0,0,n,i);var s=o.data;for(var a=0;a<s.length;a+=4){s[a]*=.75;s[a+1]*=.75;s[a+2]*=.75}e.putImageData(o,0,0)}function Hi(t){var e=t.getContext("2d");var n=t.width;var i=t.height;var o=e.getImageData(0,0,n,i);var s=o.data;for(var a=0;a<s.length;a+=4){s[a]/=.75;s[a+1]/=.75;s[a+2]/=.75}e.putImageData(o,0,0)}function Xi(t,e){for(const n in e){if(e[n].object.floor==t){Mi(e[n])}}Yi();qi()}function Pi(){Object.keys(V).forEach((t=>to(t)))}function Ui(){Pi();for(const t of l.data.completed_orgs){Vi(t)}}function Wi(){Pi();for(const t of l.data.favorited_orgs){Qi(t)}}function Gi(){Pi();for(const t of l.data.completed_orgs){Vi(t)}for(const t of l.data.favorited_orgs){Qi(t)}}function Fi(t){const e=$($(t).children()[0]);const n=window.getComputedStyle(t).transform;const i=n.match(/matrix\((.+)\)/)?.[1]?.split(", ");const o={x:parseFloat(i?.[4]||"0"),y:parseFloat(i?.[5]||"0")};const s={width:parseFloat(e.css("min-width")?.replace("px","")),height:parseFloat(e.css("min-height")?.replace("px",""))};if(o.x+s.width/2<0||o.x-s.width/2>window.innerWidth||o.y+s.height/2<0||o.y-s.height/2>window.innerHeight)return true}function Yi(){for(const i of document.getElementsByClassName("mpob")){const o=i;const s={prev:o.getAttribute("prout"),now:false};const c=Tt(o);var t="";const r={x:(c.x-C.canvas.coords.x)*a,y:(c.y-C.canvas.coords.y)*a};var e=Lt(o);const d=It(o);var n=Object.create(d);if(e=="dynamic"){if(a>O.object.dynamic_to_static.over)e="dynatic";if(a<O.object.dynamic_to_static.under)e="_dynatic"}switch(e){case"static":n.width=d.width*a;n.height=d.height*a;break;case"dynatic":n.width=d.width*(a/O.object.dynamic_to_static.over);n.height=d.height*(a/O.object.dynamic_to_static.over);break;case"_dynatic":break;n.width=d.width*(a/O.object.dynamic_to_static.under);n.height=d.height*(a/O.object.dynamic_to_static.under);break;case"dynamic":n.width=d.width;n.height=d.height;break}t+=`translate(${r.x}px, ${r.y}px)`;if(r.x+n.width<0||r.x-n.width>window.innerWidth||r.y+n.height<0||r.y-n.height>window.innerHeight){if(s.prev)continue;else o.setAttribute("prout","true")}else if(s.prev){o.removeAttribute("prout")}o.style.transform=t;$($(o).children()[0]).css("min-width",n.width+"px").css("min-height",n.height+"px")}}function qi(){const t=K[st]||[];for(const e of t){ti(e.coords,e.name)}}function Ji(t){const e=document.getElementById(Et(vt,t));return e?e:null}function zi(t,e){const n=Ji(t)}function Vi(t){const e=Ji(t);if(e){const t=e.children[0];t.classList.add("mpob-clerdd");t.classList.remove("_","favoritE");t.classList.add("cleareD")}}function Ki(t,e){const n=Ji(t);if(e==0)e=1;if(n){const t=n.children[0];if(t.querySelectorAll(`.crowds-${e}`).length>0)return;t.querySelectorAll(".AUIHVP").forEach((t=>t.remove()));$(t).prepend(`<div class="AUIHVP kpls"><span class="crowds-${e}"></span></div>`)}}function Zi(t,e){const n=Ji(t);if(n){const t=n.children[0];if(t.querySelectorAll(".NJIvua").length>0)return;$(t).prepend(`<div class="NJIvua kpls"><span>${e}</span></div>`)}}function Qi(t){const e=Ji(t);if(e){const t=e.children[0];if(t.querySelectorAll(".AIGbbvwG").length>0)return;$(t).prepend(`<div class="AIGbbvwG kpls"><span></span></div>`)}}function to(t){const e=Ji(t);if(e){const t=e.children[0];t.classList.remove("favoritE","cleareD");t.classList.add("_")}}function eo(){const t=Math.ceil(l.data.completed_orgs.length/k*100);var e="";var n=false;if(t==100){e="#4CAF50"}else if(t>=75){e="#C0CA33"}else if(t>=50){e="#FDD835"}else if(t>=25){e="#F4511E"}else if(t>=0){e="#E53935"}if(l.data.completed_orgs.length>=13){n=true;e="#4CAF50";$("#oive_r").css("width","340px").css("height","60px").css("top","calc(100dvh - 70px)");$("#oive_h").css("padding","0 10px");$("#auyGAWW").text(`2階職員室前の面談室5 へおこしください！ペンを贈呈致します ${t}% (${l.data.completed_orgs.length}/${k})`)}else{$("#auyGAWW").css("color",e).text(`${t}% (${l.data.completed_orgs.length}/${k})`)}}function no(t){console.log(t);const e=kt.string(8);const n=t["object"]?.["floor"]??t["floor"];ht.length=0;ht.push(e);O.deny=true;function i(){const n=.25;const i=gt;const o=3e3/5;const s=li([window.innerWidth/2,window.innerHeight/2]);const c={zoom1:n<a?(n-a)/(o/3):0,zoom2:(i-n)/(o/3),pos:{x:((t["object"]?.["coordinate"]?.["x"]??t["x"])-s.x)/(o*(2/3)),y:((t["object"]?.["coordinate"]?.["y"]??t["y"])-s.y)/(o*(2/3))}};var r=0;function d(){r++;if(r>o){hi();O.deny=false;return}if(r<o/3)a+=c.zoom1;if(r>o*(3-1)/3)a+=c.zoom2;if(r<o*(2/3)){s.x+=c.pos.x;s.y+=c.pos.y}fi(s,a);ht.includes(e)?setTimeout(d,5):void 0}d()}if(st==(t["object"]?.["floor"]??t["floor"])){i()}else{const t=ot[n];po(n,n,t).then(i)}}class oo{static fullyopened=false;static status="closed";static reduceCoro=[];static get isfullyopened(){return this.fullyopened}static get currentstatus(){return this.status}}function so(){const e=document.getElementById("shishiji-overview");const n=$(e);ao();oo.status="opening";e.style.top="0vh";n.show().removeClass("reducedown").addClass("raiseup").scrollTop(0);$("#overview-close-w").show();setTimeout((()=>{oo.fullyopened=true;oo.status="opened";n.removeClass("raiseup")}),500);w.favorite=w.vote=()=>void 0;w.close=ro;w.share=function e(){const n=Xt(mt.ARTICLE_ID);const i=Pt(n||"");const o=new URL(window.location.href);var s=`${o.origin}${o.pathname.replace(/@.*/,"")}?${mt.FLOOR}=${st}&${mt.ARTICLE_ID}=${n}`;if(i==null||n==null){console.log(i,n);vo({title:""},"",{},"","",{labelkey:"",url:""},true);return}const a=`${TEXTS[t].SHARE_EVENT_MESSAGE} ${i.article.title}`;vo({title:TEXTS[t].SHARE_EVENT_POPUP_TITLE,subtitle:TEXTS[t].SHARE_EVENT_POPUP_SUBTITLE},s,{title:TEXTS[t].SHARE_EVENT_DATA_TITLE,text:`${a}\n{__SHARE_URL__}`},pt.FROM_ARTICLE_SHARE,a,{labelkey:"SHARE_EVENT_INCLUDE_EVTH",url:`${s}&${mt.SCROLL_POS}=${$("#shishiji-overview").scrollTop()}&${mt.ART_TARGET}=${$(".tg-active")[0].id.match(/ovv-t-(.*?)-sd/)?.[1]}`})}}function ao(){clearInterval(J.reduceOverview);$("#user-stricter").removeClass("deactive").addClass("active")}function co(){clearTimeout(J.restrict);$("#user-stricter").removeClass("active").addClass("deactive")}function ro(){const t=document.getElementById("shishiji-overview");const e=$(t);if(y.article)return;co();oo.fullyopened=false;oo.status="closing";t.style.top="100vh";e.removeClass("raiseup").addClass("reducedown");$("#overview-close-c").off("click",ro);$("#overview-context").removeClass("fadein");$(".tg-active").removeClass("tg-active");$("#dvd2").removeClass("ihateky");$("#theme-meta").attr("content","#15202b");oo.reduceCoro.forEach((t=>t()));oo.reduceCoro.length=0;J.reduceOverview=setTimeout((()=>{oo.status="closed";$("#ev_property").empty();$("#--art-header").attr("src","");e.css("border-top","20px solid white").removeClass("reducedown").scrollTop(0).hide()}),150);Ht(mt.ARTICLE_ID);if($("#shishiji-overview").attr("disc")=="jetcoaster"){Se.emit("update.jetcoaster.leave")}}function lo(e,n,i,o,s,a){const c=document.getElementById("shishiji-overview");const r=e.article.theme_color?e.article.theme_color:"black";const d=e.article.font_family?e.article.font_family:"";const u=e.discriminator;const h=Vt(e);const f=[];const m=$.post(ajaxpath.getart+"?discriminator="+e.discriminator,{discriminator:e.discriminator});const p=setTimeout((()=>ae("loading-article-"+e.discriminator,"middle")),500);var v="";var g="";var _=0;m.then((n=>{const i=n.article;const o=n.crowd;const s=n.pt;const a=e.object.no_admission?document.createElement("span"):fe("訪問pt",s.toString()+"pt");const c=fe("混雑状況",q[o]);$(".ev_property").prepend(a,c);g+=a.outerHTML+c.outerHTML;v=Ie(i,(t=>h(u,t)));if(v==="<span></span>"){v=`<h4 style="width:100%;margin-top:50px;margin-bottom:50px;text-align:center;">${TEXTS[t].ARTICLE_NO_ARTICLE}</h4>`}$("#ARTICLE_UNKO").html(v)})).catch((()=>_o.notifyError(TEXTS[t].FAILED_TO_LOAD_ARTICLE_CONTENT))).always((()=>{ce("loading-article-"+e.discriminator,"middle");clearTimeout(p)}));if(e.discriminator=="jetcoaster"){Se.emit("update.jetcoaster.join");Se.off("data.article",w.jetupdater);w.jetupdater=async function(e){const n=e.article;v=Ie(n,(t=>h(u,t)));if(v==="<span></span>"){v=`<h4 style="width:100%;margin-top:50px;margin-bottom:50px;text-align:center;">${TEXTS[t].ARTICLE_NO_ARTICLE}</h4>`}$("#ARTICLE_UNKO").html(v)};Se.on("data.article",w.jetupdater)}if(ye("article")){y.article=true;setTimeout((()=>Ee("article")),500)}for(const S of e.article.custom_tr){if(S.title&&S.content)g+=fe(S.title,S.content).outerHTML}g+=fe("開催場所",e.article.venue).outerHTML;if(n)$("#ctx-article").addClass("fadein");c.style.borderTop="solid var(--shishiji-ovv-theme-height) "+r;$(c).css("font-family",d);$("#dvd4 > span").text(TEXTS[t].SHARE);$("#dvd1 > span").text(TEXTS[t].REVEAL_ON_MAP);$("#dvd2 > span").text(TEXTS[t].FAVORITE);$("#dvd3 > span").text(TEXTS[t].VOTE);$("#ovv-ctx-loading-w").remove();$("#ctx-title").text(e.article.title);$("#shishiji-overview").attr("disc",e.discriminator);setTimeout((()=>$("#theme-meta").attr("content",r)),500);l.data.favorited_orgs.includes(u)?$("#dvd2").addClass("ihateky"):$("#dvd2").removeClass("ihateky");l.data.completed_orgs.includes(u)?(()=>{$("#dvd3").show().removeClass("uihGAV")})():(()=>{$("#dvd3").show().addClass("uihGAV");w.vote=()=>{_o.notifyInfo(TEXTS[t].VOTE_AVAILABLE_AFTER_VISITING)}})();z={deled:null,feels:[...l.data.favorited_orgs]};function E(){const t=e.discriminator;const n=[...l.data.favorited_orgs];var i=false;ae("favud","top");if(l.data.favorited_orgs.includes(t)){$("#dvd2").removeClass("ihateky");l.data.favorited_orgs=l.data.favorited_orgs.filter((e=>e!==t));i=true}else{$("#dvd2").addClass("ihateky");l.data.favorited_orgs.push(t)}Gi();clearTimeout(J.ogfav);J.ogfav=setTimeout((()=>x(i,n)),500)}function x(e,n){$.post(ajaxpath.updfav,{favorites:JSON.stringify(l.data.favorited_orgs)}).then((()=>{Gi();z={deled:e,feels:[...l.data.favorited_orgs]}})).catch((()=>{_o.notifyError(TEXTS[t].ERROR_ANY,{do_not_keep_previous:true});l.data.favorited_orgs=[...z.feels];z!==null?z.deled?$("#dvd2").addClass("ihateky"):$("#dvd2").removeClass("ihateky"):void 0;Gi()})).always((()=>ce("favud","top")))}function b(){ro();mn([u])}function C(){setTimeout((()=>{$("#ctx-article").addClass("_fadein");if(i!==void 0)$("#shishiji-overview").scrollTop(i);i=0}),25)}function T(){$(this).attr("draggable","false")}class k{static get exists(){return true}static async write(t,e,n){const i=document.getElementById("ctx-article");const o=document.createElement("span");o.innerHTML=t;if(n){const t={};for(const e of n){const n=e.src||"";if(t[n])t[n].push(e);else t[n]=[e]}for(const e of[...o.querySelectorAll("img"),...o.querySelectorAll("video")]){const n=e.src||"";const i=t[n];const o=i?.length>0?i[0]:e.cloneNode(true);e.parentNode?.replaceChild(o,e);o.style.width=e.style.width;t[n]=t[n]?.filter((t=>t!==o))}}if(i){i.innerHTML="";i.appendChild(o)}if(e)e()}}function L(){$(".tg-active").removeClass("tg-active");$(this).addClass("tg-active");$(".article-image").addClass("doaJSD");$("#--art-header").attr("src",h(u,e.article.images.header));$("#--art-icon").attr("src",h(u,e.object.images.icon));T.call($("#--art-header"));T.call($("#--art-icon"))}function I(){if($(this).hasClass("tg-active")&&!s)return;$("#ctx-article").addClass("_wait_f");function t(){if(f.length==0){document.getElementById("ctx-article")?.querySelectorAll("img").forEach((t=>f.push(t)));document.getElementById("ctx-article")?.querySelectorAll("video").forEach((t=>f.push(t)))}setTimeout((()=>$("#shishiji-overview").scrollTop(_)),25)}const i=e.object.no_admission?`<span class="saioguW">※この団体には入場記録がなく、訪問ptももらえません</span>`:"";k.write(`${i}<div id="ARTICLE_UNKO">${v}</div>`,C,f).then(t);if(n)$("#ctx-article").removeClass("fadein").removeClass("_fadein");L.call(this)}function A(){if($(this).hasClass("tg-active")&&!s)return;_=$("#shishiji-overview").scrollTop()||0;$("#ctx-article").addClass("_wait_f");const t=`\n            <hr style="margin: 40px 20px 20px 20px;">\n            <div class="ev_property">\n                <table style="width: 100%;">\n                    <tbody>\n                        ${g}\n                    </tbody>\n                </table>\n            </div>\n            <hr style="margin: 20px;">\n            `;k.write(t,C);$("#ctx-article").removeClass("fadein").removeClass("_fadein");L.call(this)}$("#ovv-t-description-sd").off("click",wt.description).on("click",I);$("#ovv-t-details-sd").off("click",wt.details).on("click",A);wt.description=I;wt.details=A;w.favorite=E;l.data.completed_orgs.includes(u)?w.vote=b:void 0;if(!o||!["description","details","else"].includes(o))o="description";document.getElementById(`ovv-t-${o}-sd`)?.dispatchEvent(new Event("click"));if(a){$("#dvd1").show();function O(){if(an.opened)an.close();oe();w.close(new Event("Avada Kedavra"));$("#overview-gogow-w").off("click",O);setTimeout((()=>{no(e)}),250)}Z=O}else{$("#dvd1").hide()}}async function uo(t,e){new Promise(((e,n)=>{$("#overview-context").html(t);e("")})).then((()=>{if(e!==void 0)e()}))}function ho(t,e){if(!t){this.removeClass("toSel undoSel").addClass("toSel popped");$("#place-options-w").show().removeClass("toSel undoSel").addClass("toSel");$("#where_am_i").hide();$("#psdummy").addClass("greatfulmanbruh")}else{this.removeClass("popped").addClass("undoSel");if(e)$("#place-options-w").hide();else $("#place-options-w").show();$("#place-options-w").removeClass("toSel").addClass("undoSel");$("#where_am_i").show();$("#psdummy").removeClass("greatfulmanbruh")}}function fo(t){if(t===void 0)t=st;$(".fselc-cell").removeClass("currentflr");$("#floor-"+t).addClass("currentflr")}function mo(){if(st=="B1")O.caps.ratio.min=.4;else O.caps.ratio.min=.15}async function po(e,n,i,o){const s=document.getElementById("#place-selector".slice(1));const c=await Ot(TEXTS[t].LOADING_MAP,void 0,o);at.fselector.opened=false;st=e;mo();const r={width:i.tile_width*(i.xrange+1),height:i.tile_height*(i.yrange+1)};ot[st]=pi(i);Bt(mt.FLOOR,st);fo();return new Promise((async(o,s)=>{mi(i,{over:"",under:n},(function(){const n={width:(i.xrange+1)*i.tile_width,height:(i.yrange+1)*i.tile_height};const s=[document.body.clientWidth/n.width,document.body.clientHeight/n.height];C.canvas.coords={x:0,y:0};a=Math.min(...s);_i({left:0,top:0});Di();Xi(e,V);Gi();hi();fi({x:(i.xrange+1)*i.tile_width/2,y:(i.yrange+1)*i.tile_height/2},void 0,true);Rt(TEXTS[t].MAP_LOADED,0).then(o)}))}))}function vo(e,n,i,o,s,a,c){yo.startLoad();n=decodeURIComponent(n);function r(e){if(e===void 0)e=TEXTS[t].ERROR_ANY;_o.notify("error",TEXTS[t].NOTIFICATION_ERROR_ANY,{do_not_keep_previous:true,duration:2500,discriminator:"sharePopup connection error"});if(yo.isPoppingup)yo.showasError(e)}function d(t,e,n){return t.includes("?")?`${t}&${e}=${n}`:`${t}?${e}=${n}`}$.ajax({url:"/share_panel",method:"GET",timeout:3e4,dataType:"html"}).done((l=>{if(yo.isPoppingup){yo.popupContent(l,(function(){const l=d(n,mt.URL_FROM,o);var u=[];var h={share:()=>{},copy:()=>{}};if(c){r();return}$("#ppc-title").text(e.title);if(e.subtitle)$("#ppc-subtitle").text(e.subtitle);function f(t){if(window.navigator.share){i.text=i.text?.replace("{__SHARE_URL__}",t||l);!function(t){async function e(){await window.navigator.share(t)}$("#share-nav").off("click",h.share).on("click",e);h.share=e;return 0}(i)}else{$("#nav-share").remove()}}f();function m(e){function n(){window.navigator.clipboard.writeText(e||l);_o.notify("link",TEXTS[t].NOTIFICATION_COPIED_LINK,{duration:2500,discriminator:"copy artshare"})}$("#share-copy").off("click",h.copy).on("click",n);h.copy=n}m();if(a){$("#includeScr").text(TEXTS[t][a.labelkey]);$("#includeScrCh").on("change",(function(t){if(this.checked){for(var e=0;e<document.getElementsByClassName("share_ebtn").length;e++){$(document.getElementsByClassName("share_ebtn")[e]).off("click",u[e])}const t=d(a.url,mt.URL_FROM,o);p(t);f(t);m(t)}else{p();f();m()}}))}else{$("#includeScrCh").remove()}s=encodeURIComponent(s);function p(e){const n=encodeURIComponent(e||l);const i=`${s}%0A${n}`;u=[];for(const t of document.getElementsByClassName("share_ebtn")){const e=t.id.replace("share-","");const a=$(t);var o="";switch(e){case"line":o=`http://line.me/R/msg/text/?${i}`;break;case"twitter":o=`https://x.com/intent/tweet?url=${n}&text=%0A%0A${s}%0A${encodeURIComponent("#獅子児祭 @shishijifes")}%0A&related=shishiji`;break;case"facebook":o=`http://www.facebook.com/share.php?u=${n}`;break;case"gmail":$("#share-gmail").parent().parent().remove();o=`https://mail.google.com/mail/?view=cm&body=%0A%0A${i}`;break;case"mail":o=`mailto:?body=%0A%0A${i}`;break;case"sms":o=`sms:?body=%0A%0A${i}`;break;case"whatsapp":o=`https://api.whatsapp.com/send?text=${i}`;break;default:continue}!function(t){function e(){window.open(t,"_blank")}a.on("click",e);u.push(e);return 0}(o)}function a(){$("#--share-bru").text("Share");$("#--trans-MAIL").text("Email");$("#--trans-MESSAGE").text("Messages");$("#--trans-COPYLINK").text("Copy Link");$("#--trans-OTHERS").text("Others")}if(t!="JA")a()}p()}),{height:360})}})).catch((()=>r()))}const go=class t{static _pending_notices=[];static _prop={Timeout:0,_Timeout:0,__Timeout:0,current:"",notifying:false};static notifyHTML(e,n){this._invoke.call(t,[e,n],false)}static get current(){return this._prop.current}static get isNotifying(){return document.getElementById("--yd-notifier")?.classList.contains("vpopen")}static _invoke(...t){const e=t[0];var n=e[0],i=e[1],o=i?.duration,s=i?.discriminator,a=t[1];const c=$("#--yd-notifier");const r=document.createTextNode(n).textContent;o??=3e3;s??=n;if(this._prop.notifying&&this._prop.current==s&&!i?.do_not_keep_previous)return;if(r?.endsWith(".")||r?.endsWith("!")||r?.endsWith("?"))n+="&nbsp;";if(!a)this.clearPengings();this._prop.current=s;clearTimeout(this._prop.Timeout);clearTimeout(this._prop._Timeout);clearTimeout(this._prop.__Timeout);if(this._prop.notifying){this.closeNotifier(true);this._prop._Timeout=setTimeout((()=>{d.apply(this,[i?.deny_userclose])}),75);return}function d(t){$("#--ott-us").html(n);c.show().removeClass("hpipe").addClass("vpopen");if(!t){this._add_closeOnInter()}else{c.addClass("--path-through")}this._prop.notifying=true;if(o!==Infinity)this._prop.Timeout=setTimeout((()=>{this.closeNotifier(true)}),o)}d.apply(this,[i?.deny_userclose])}static closeNotifier(e){clearTimeout(this._prop.__Timeout);$("#--yd-notifier").removeClass("--path-through").removeClass("vpopen").addClass("hpipe");this._removeCloseonInter();this._prop.notifying=false;this._prop.__Timeout=setTimeout((()=>{$("#--ott-us").empty();$("#--yd-notifier").hide();if(!e)this._prop.current="";if(t._pending_notices.length>0)this._invoke_pending()}),70)}static appendPending(e){t._pending_notices.push(e);if(!this.isNotifying)this._invoke_pending()}static clearPengings(){t._pending_notices=[]}static _invoke_pending(){const e=t._pending_notices[0];this._invoke.call(t,[e.html,e.options],true);t._pending_notices.shift()}static _add_closeOnInter(){const t=$("#--yd-notifier");t.removeClass("--path-through").on("touchstart mousedown",this._interClose)}static _removeCloseonInter(){const t=$("#--yd-notifier");t.off("touchstart mousedown",this._interClose)}static _interClose(e){e.preventDefault();t.closeNotifier()}};const _o=class t extends go{static tagName="shishiji-yd-notifier-cd";static baseComponent=`<${this.tagName} id="{id}" class="protected flxxt" style="font-size:12px;">{svg}<span>{message}</span></${this.tagName}>`;static _tagName="picton-icon-svg";static _images=["info","link","no-wifi","success","warn","error","save","input","school","zoom","smile","new","calculating","copy","thanks"];static _imagepath="/resources/svg/{name}.svg";static notify(t,e,n){var i="";var o=(t,e)=>"";switch(t){default:break;case"no-wifi":!i?i=GPATH.NO_WiFi:void 0;case"info":case"link":o=this._cpylinnot;break;case"success":case"warn":o=this._shrf;break;case"error":!i?i=GPATH.ERROR:void 0;o=this._shrnf;break;case"save":case"input":case"smile":case"thanks":o=this._shrf;break;case"zoom":case"new":case"calculating":o=this._shref;break;case"copy":o=this._shreRf}if(i)e=o.call(this,i,e);else e=this._useImg(t,e,o);if(n?.addToPending)this.appendPending.call(go,{html:e,options:n});else this.notifyHTML(e,n)}static notifyInfo(...t){t[0]=this._useImg("info",t[0],this._cpylinnot);this.notifyHTML(...t)}static notifySuccess(...t){t[0]=this._useImg("success",t[0],this._shrf);this.notifyHTML(...t)}static notifyError(...t){t[0]=this._shrnf(GPATH.ERROR,t[0]);this.notifyHTML(...t)}static notifyLink(...t){t[0]=this._useImg("link",t[0],this._cpylinnot);this.notifyHTML(...t)}static notifyNoWiFi(...t){t[0]=this._cpylinnot(GPATH.NO_WiFi,t[0]);this.notifyHTML(...t)}static notifyWarn(...t){t[0]=this._useImg("warn",t[0],this._shrf);this.notifyHTML(...t)}static notifySave(...t){t[0]=this._useImg("save",t[0],this._shrf);this.notifyHTML(...t)}static notifyInput(...t){t[0]=this._useImg("input",t[0],this._shrf);this.notifyHTML(...t)}static notifyZoom(...t){t[0]=this._useImg("zoom",t[0],this._shref);this.notifyHTML(...t)}static _getImg(e){const n=document.createElement("img");n.src=t._imagepath.replace("{name}",e);return n}static _appendPisElement(e,n){const i=document.createElement(t._tagName);const o=document.createElement("img");o.src=n;o.loading="lazy";i.appendChild(o);i.classList.add("shy");i.setAttribute("name",e);document.body.appendChild(i);return i}static _getComponent(t,e,n){return this.baseComponent.replace("{id}",t).replace("{svg}",e).replace("{message}",n)}static _cpylinnot(t,e){return this._getComponent("cpy-lin-not",t,e)}static _shrf(t,e){return this._getComponent("shr-f",t,e)}static _shrnf(t,e){return this._getComponent("shr-notf",t,e)}static _shref(t,e){return this._getComponent("shr-exf",t,e)}static _shreRf(t,e){return this._getComponent("shr-eRxf",t,e)}static _useImg(t,e,n){const i=this._getImg(t);const o=document.createElement("div");o.innerHTML=n.call(this,"",e);o.children[0].prepend(i);return o.innerHTML}};const wo=class t{static _pending_notices=[];static _prop={Timeout:0,_Timeout:0,__Timeout:0,current:"",notifying:false};static _pray=false;static currentClickListener=()=>{};static notifyHTML(e,n){this._invoke.call(t,[e,n],false)}static get current(){return this._prop.current}static get isNotifying(){return document.getElementById("raid--yd-notifier")?.classList.contains("vpopen")}static _invoke(...t){const e=t[0];var n=e[0].event_details,i=e[1],o=i?.duration,s=i?.discriminator,a=t[1];const c=$("#raid--yd-notifier");var r=Pt(e[0].discriminator);o??=3e3;s??=kt.string(10);this._prop.current=s;clearTimeout(this._prop.Timeout);clearTimeout(this._prop._Timeout);clearTimeout(this._prop.__Timeout);if(this._prop.notifying){this.closeNotifier(true);this._prop._Timeout=setTimeout((()=>{d.apply(this,[i?.deny_userclose])}),105);return}function d(t){if(r==null||e[0].no_relation){$("#aaGWUIJO").text(e[0].discriminator);$("#AuSAJIg").attr("src",e[0].image_src||"")}else{const i=r;function s(){Bt(mt.ARTICLE_ID,i.discriminator);so();lo(i,true,void 0,void 0,void 0,true)}$("#aaGWUIJO").text(r?.article?.title||"");$("#AuSAJIg").attr("src",Jt(r.discriminator,r.object.images.icon));$("#raid--yd-notifier").off("click",this.currentClickListener);$("#raid--yd-notifier").on("click",s);this.currentClickListener=s}$("#auijsmjmg").text(e[0].time);$("#asGUOt").html(n);c.show().removeClass("hpipe").addClass("vpopen");if(!t){this._add_closeOnInter()}else{c.addClass("--path-through")}this._prop.notifying=true;if(o!==Infinity)this._prop.Timeout=setTimeout((()=>{this.closeNotifier(true)}),o)}d.apply(this,[i?.deny_userclose])}static closeNotifier(e){clearTimeout(this._prop.__Timeout);$("#raid--yd-notifier").removeClass("--path-through").removeClass("vpopen").addClass("hpipe");this._removeCloseonInter();this._prop.notifying=false;this._prop.__Timeout=setTimeout((()=>{$("#raid--yd-notifier").hide();if(!e)this._prop.current="";if(t._pending_notices.length>0)this._invoke_pending()}),101)}static appendPending(e){t._pending_notices.push(e);if(!this.isNotifying)this._invoke_pending()}static clearPengings(){t._pending_notices=[]}static _invoke_pending(){const e=t._pending_notices[0];this._invoke.call(t,[e.html,e.options],true);t._pending_notices.shift()}static _add_closeOnInter(){const t=$("#raid--yd-notifier");t.removeClass("--path-through");if(!this._pray){se(document.getElementById("raid--yd-notifier")||HTMLElement.prototype,this._interClose);this._pray=true}}static _removeCloseonInter(){const t=$("#raid--yd-notifier")}static _interClose(e){t.closeNotifier()}};window.RaidNotifier=wo;const yo=class t{static closeKeys=["ESCAPE"];static closeListeners=[];static async popupContent(t,e,n){const i=GPATH.X;if(n===void 0){n={width:500,height:450}}else{if(!n.width)n.width=500;if(!n.height)n.height=450}if(n.hideclosebutton&&n.forceclosebutton)console.warn("hideclosebutton and forceclosebutton shouldn't be true at same time!!");if(!n.hideclosebutton)t=i+t;window.removeEventListener("keydown",this._keydisposal);$("shishiji-mx-overlay").off("click",this._dispose);return new Promise(((e,i)=>{if(!n?.forceclosebutton){window.addEventListener("keydown",this._keydisposal);$("shishiji-mx-overlay").on("click",this._dispose)}$("shishiji-mx-overlay").removeClass("pipe").addClass("popen");$("#shishiji-popup-container-c").removeClass("flxxt").css({overflow:"",height:"",width:"","max-width":n.width+"px","max-height":n.height+"px",left:`calc((var(--window-width) - 48px - min(${n.width}px, var(--window-width) - 48px))/2)`}).html(t).show();e("")})).then((()=>{$("#ppcls").on("click",this._disposition);if(e!==void 0)e()}))}static async popupMedia(t,e,n,i){const o=GPATH.X;const s=n?n.cloneNode(true):document.createElement("span");var a=o;if(s){$(s).attr("id","").attr("class","").attr("style","").attr("draggable","true");switch(e){case"video":$(s).attr("controls","").attr("preload","metadata").attr("playsinline","").attr("autoplay","").removeAttr("muted");default:s.classList.add("suhDWAgd")}}else{switch(e){case"img":a+=`<img class="suhDWAgd" src="${t}" draggable="true">`;break;case"video":a+=`<video class="suhDWAgd" src="${t}" controls preload="metadata" playsinline="" draggable="true"></video>`;break}}return new Promise(((t,e)=>{window.addEventListener("keydown",this._keydisposal);$("shishiji-mx-overlay").removeClass("pipe").addClass("popen").on("click",this._dispose);$("#shishiji-popup-container-c").addClass("flxxt").css({"max-height":"fit-content",height:"fit-content",overflow:"visible"}).html(a).append(s).show();t("")})).then((()=>{$("#ppcls").css({top:"-40px",right:"0"}).on("click",this._disposition);$($($("#ppcls").children()[0]).children()[0]).attr("fill","blue");if(i!==void 0)i()}))}static startLoad(t){this.popupContent(`<div class="protected" id="ppupds"><div class="mx-text-center flxxt">${rt.loadging}</div></div>`,(()=>{}),t)}static showasError(t){this.popupContent(`<div class="protected" id="ppupds"><div class="mx-text-center flxxt" style="flex-direction:column;"><div style="width:125px;margin-bottom:4px;">${GPATH.ERROR_ZAHUMARU}</div><h4>${t}</h4></div></div>`)}static disPop(e){if(typeof e!=="string")e="JAVASCRIPT";window.removeEventListener("keydown",t._keydisposal);$("#ppcls").off("click",t._disposition);$("shishiji-mx-overlay").removeClass("popen").addClass("pipe").off("click",t._dispose);$("#shishiji-popup-container-c").hide().empty();t._callCloseListeners(e)}static get isPoppingup(){const t=document.getElementById("shishiji-popup-container-c");return t?.clientHeight!=0?true:false}static setsize(){const t=$("#shishiji-popup-container-c");function e(t){return Number(t.replace("px",""))}const n={width:e(t.css("width")),height:e(t.css("height")),margin:e(t.css("margin"))};var i=e(t.css("width"));var o=e(t.css("height"));var s=e(t.css("margin"));if(window.innerWidth<=i+s*2){t.css("width",window.innerWidth-s*2+"px");i=window.innerWidth-s*2}else{t.css("width",n.width+"px")}t.css("top",(window.innerHeight-(s*2+o))/2+"px").css("left",(window.innerWidth-(s*2+i))/2+"px")}static addCloseListener(t){this.closeListeners.push(t)}static removeCloseListener(t){const e=this.closeListeners.length;this.closeListeners=this.closeListeners.filter((e=>e!==t));if(this.closeListeners.length<e)return true;else return false}static _difficult(e){if(t.isPoppingup)t.disPop(e)}static _dispose(){t._difficult("OVERLAY")}static _disposition(){t.disPop("X BUTTON")}static _keydisposal(e){const n=e.key.toUpperCase();if(t.closeKeys.includes(n)){t._difficult("KEYBOARD")}}static _callCloseListeners(t){this.closeListeners.forEach((e=>{e(t)}))}};window.Popup=yo;function Eo(t){if(y.pkgo)return;setTimeout((()=>an.close.call(window,true)),100);t()}function $o(t){return()=>Eo(t)}document.getElementById("pkgo_menu5")?.children[0].addEventListener("click",$o(We));document.getElementById("pkgo_menu3")?.children[0].addEventListener("click",$o(xn));document.getElementById("pkgo_menu1")?.children[0].addEventListener("click",$o(Xn));document.getElementById("pkgo_menu2")?.children[0].addEventListener("click",$o(fn));document.getElementById("pkgo_menu6")?.children[0].addEventListener("click",$o(Bn));document.getElementById("pkgo_menu7")?.children[0].addEventListener("click",$o(Rn));document.getElementById("pkgo_menu4")?.children[0].addEventListener("click",$o(Hn));document.getElementById("pkgo_menuXXL")?.children[0].addEventListener("click",$o(sn));document.getElementById("pkgo_menuXXS")?.children[0].addEventListener("click",$o(jn));document.getElementById("user-profile-opner")?.addEventListener("click",$o(dn));document.getElementById("bandeventopen")?.addEventListener("click",$o(bn("band")));document.getElementById("danceeventopen")?.addEventListener("click",$o(bn("dance")));document.getElementById("misceventopen")?.addEventListener("click",$o(bn("misc")));document.getElementById("go_to_ranking")?.addEventListener("click",$o(qn));document.getElementById("gt_mps")?.addEventListener("click",Ge);document.getElementById("ag8FOKSpoa")?.addEventListener("click",zn);document.getElementById("famevotegogo")?.addEventListener("click",$o(mn));document.getElementById("eventvotegogo")?.addEventListener("click",$o($n));document.getElementById("bandeventopen_")?.addEventListener("click",$o(In("band")));document.getElementById("danceeventopen_")?.addEventListener("click",$o(In("dance")));document.getElementById("misceventopen_")?.addEventListener("click",$o(Ln));document.getElementById("gos_budozyo")?.addEventListener("click",$o(In("misc","武道場")));document.getElementById("gos_houkou")?.addEventListener("click",$o(In("misc","放光館")));document.getElementById("gos_syudou")?.addEventListener("click",$o(In("misc","修道館ホール")));document.getElementById("gos_kousyamae")?.addEventListener("click",$o(In("misc","校舎前")));["click"].forEach((t=>{document.getElementById("pkgo_mainb")?.addEventListener(t,(function(){if(y.main_screen)return;an.oepn();if(ye("menu")){y.pkgo=true;setTimeout((()=>Ee("menu")),500)}}));document.getElementsByTagName("pokemon-gradient")[0].addEventListener(t,(function(){!y.pkgo?an.close():void 0}));document.getElementById("pkgo_menu_closeAWW")?.addEventListener(t,(function(){!y.pkgo?an.close():void 0}))}));+function(){const t=document.createElement("shishiji-pkgo-close"),e=document.createElement("aoish-s");e.classList.add("flxxt");t.classList.add("flxxt","protected");t.appendChild(e);const n=document.createElement("div");n.classList.add("particular_closebwrap","manyyearshaspassed");const i=["vote_screen","fame_vote_screen","event_vote_screen","event_vote_selector_screen"];function o(){if(y.pkgo||y.article)return;const t=kt.string(6);const e=this.classList.contains("particular_closebwrap")?this.parentElement?.parentElement?.id:this.parentElement?.id;ie(e||"");if(this.classList.contains("particular_closebwrap"))return;$("#shpkgoanim").append(`<daoijh id="${t}"><close-outside></close-outside><close-inside class="shishijineon"></close-inside></daoijh>`);setTimeout((()=>$("#"+t).remove()),501)}for(const e of document.getElementsByTagName("shishiji-pks")){if(e.id=="headcount_screen")continue;if(i.includes(e.id)){const t=n.cloneNode(true);$(t).attr("id","close_button_of_"+e?.id);t.addEventListener("click",o);e.querySelector(".AGDaewP")?.appendChild(t)}else{const n=t.cloneNode(true);$(n).attr("id","close_button_of_"+e?.id);n.addEventListener("click",o);if(e.id=="stamp_rally_screen")n.addEventListener("click",(async function(){await Vn()?_e("1"):we("1")}));e?.appendChild(n)}}document.getElementById("overview-close-c")?.addEventListener("click",(function(){o.call(this);w.close()}))}();document.getElementById("close_button_of_stamp_rally_scan_screen")?.addEventListener("click",(function(){const t=document.getElementById("qrcode-video");t.srcObject=null;en.forEach((t=>{t.getTracks().forEach((t=>t.stop()))}));en.length=0;ce("opening camera","middle")}));document.getElementById("showshop")?.addEventListener("click",(function(){oe();setTimeout((()=>{no(V["shop"])}),500)}));document.getElementById("icon-chd")?.addEventListener("click",(()=>$("#chiconinputimgae").trigger("click")));document.getElementById("chiconinputimgae")?.addEventListener("change",ln);document.getElementById("iasyguf")?.addEventListener("click",un);+function(){function t(){if($(this).val()?.toString().length==0)Ve(false);else Qe()}document.getElementById("del_search")?.addEventListener("click",(function(){$("#org_search_input").val("");Ve(false)}));document.getElementById("fav_search")?.addEventListener("click",(function(){const t=this.getAttribute("fav_search");if(t){$(this.children[0]).show();$(this.children[1]).hide();this.removeAttribute("fav_search")}else{$(this.children[0]).hide();$(this.children[1]).show();this.setAttribute("fav_search","true")}Je()}));document.getElementById("do_search")?.addEventListener("click",(function(){t.call($("#org_search_input"))}));document.getElementById("org_search_input")?.addEventListener("keydown",(function(e){if(e.key.toUpperCase()=="ENTER"){e.preventDefault();t.call(this)}}))}();document.getElementById("aiUHGG")?.addEventListener("click",_n);async function xo(){const t={};for(const e of Object.keys(V)){await $.post(ajaxpath.getart+"?discriminator="+e).then((n=>{const i=n.article;const o=ee(Ie(i,(()=>"")));t[e]=o}))}console.log(t)}+function(){for(const t of document.getElementsByClassName("faq_sec")){t.addEventListener("click",(function(){const t=$(this).attr("about");$("#faq_question_title").text(this.textContent);$("#faq_answers").empty();ne("faq_answer_screen");ae("faq,"+t,"middle");const e=()=>$.post(ajaxpath.faq,{about:t}).then((e=>{ce("faq,"+t,"middle");$("#faq_answers").html(e)})).fail((e=>{ce("faq,"+t,"middle");$("#faq_answers").text(e.responseText)}));setTimeout(e,250)}))}}();function bo(t){t.key.toUpperCase()=="ENTER"?t.preventDefault():void 0}function Co(){const t=$(this).val();yt.situation.nickname=t==l.data.profile.nickname?false:true}function To(){if($("#vote_right_now").attr("wait"))return;const e=[...hn];ae("famevote","middle");$("#vote_right_now").attr("wait","true");$.post(ajaxpath.updfvote,{votes:JSON.stringify(e)}).then((()=>{const e=[...l.data.fame_votes];l.data.fame_votes=[...hn];if(e.length>0&&l.data.fame_votes.length>0)_o.notifySuccess(TEXTS[t].VOTE_CHANGED,{do_not_keep_previous:true});else if(l.data.fame_votes.length>0)_o.notifySuccess(TEXTS[t].VOTED,{do_not_keep_previous:true});else _o.notifySuccess(TEXTS[t].CANCELED_VOTING,{do_not_keep_previous:true});$(".imcurrentleader").removeClass("imcurrentleader");$(".GGId").each((function(){if(l.data.fame_votes.includes(this.getAttribute("duty")||"")){this.classList.add("imcurrentleader")}}));gn()})).catch((()=>{_o.notifyError(TEXTS[t].ERROR_ANY)})).always((()=>{ce("famevote","middle");$("#vote_right_now").attr("wait",null)}))}+function(){function t(t){return function(){ie("drink_screen");no(Pt(t))}}document.getElementById("takoyakimap")?.addEventListener("click",t("takoyaki"));document.getElementById("yscafemap")?.addEventListener("click",t("yscafe"));document.getElementById("syokudomap")?.addEventListener("click",t("syokudo"));document.getElementById("maidmap")?.addEventListener("click",t("maid"));document.getElementById("syasuderimap")?.addEventListener("click",t("syasuderi"))}();document.getElementById("user-name-input")?.addEventListener("keydown",bo);document.getElementById("user-name-input")?.addEventListener("input",Co);document.getElementById("scan_stamp_trans")?.addEventListener("click",nn);document.getElementById("scan_stamp_growth")?.addEventListener("click",nn);document.getElementById("vote_right_now")?.addEventListener("click",To);document.getElementById("evote_right_now")?.addEventListener("click",(()=>w.evote()));document.querySelectorAll("shishiji-fking-advertisement, #funny-closer").forEach((t=>t.addEventListener("click",Pe)));function Fi(t){const e=$($(t).children()[0]);const n=window.getComputedStyle(t).transform;const i=n.match(/matrix\((.+)\)/)?.[1]?.split(", ");const o={x:parseFloat(i?.[4]||"0"),y:parseFloat(i?.[5]||"0")};const s={width:parseFloat(e.css("min-width")?.replace("px","")),height:parseFloat(e.css("min-height")?.replace("px",""))};if(o.x+s.width/2<0||o.x-s.width/2>window.innerWidth||o.y+s.height/2<0||o.y-s.height/2>window.innerHeight)return true}function Yi(){for(const i of document.getElementsByClassName("mpob")){const o=i;const s={prev:o.getAttribute("prout"),now:false};const c=Tt(o);var t="";const r={x:(c.x-C.canvas.coords.x)*a,y:(c.y-C.canvas.coords.y)*a};var e=Lt(o);const d=It(o);var n=Object.create(d);if(e=="dynamic"){if(a>O.object.dynamic_to_static.over)e="dynatic";if(a<O.object.dynamic_to_static.under)e="_dynatic"}switch(e){case"static":n.width=d.width*a;n.height=d.height*a;break;case"dynatic":n.width=d.width*(a/O.object.dynamic_to_static.over);n.height=d.height*(a/O.object.dynamic_to_static.over);break;case"_dynatic":break;n.width=d.width*(a/O.object.dynamic_to_static.under);n.height=d.height*(a/O.object.dynamic_to_static.under);break;case"dynamic":n.width=d.width;n.height=d.height;break}t+=`translate(${r.x}px, ${r.y}px)`;if(r.x+n.width<0||r.x-n.width>window.innerWidth||r.y+n.height<0||r.y-n.height>window.innerHeight){if(s.prev)continue;else o.setAttribute("prout","true")}else if(s.prev){o.removeAttribute("prout")}o.style.transform=t;$($(o).children()[0]).css("min-width",n.width+"px").css("min-height",n.height+"px")}}function qi(){const t=K[st]||[];for(const e of t){ti(e.coords,e.name)}}function Ji(t){const e=document.getElementById(Et(vt,t));return e?e:null}function zi(t,e){const n=Ji(t)}function Vi(t){const e=Ji(t);if(e){const t=e.children[0];t.classList.add("mpob-clerdd");t.classList.remove("_","favoritE");t.classList.add("cleareD")}}function Ki(t,e){const n=Ji(t);if(e==0)e=1;if(n){const t=n.children[0];if(t.querySelectorAll(`.crowds-${e}`).length>0)return;t.querySelectorAll(".AUIHVP").forEach((t=>t.remove()));$(t).prepend(`<div class="AUIHVP kpls"><span class="crowds-${e}"></span></div>`)}}function Zi(t,e){const n=Ji(t);if(n){const t=n.children[0];if(t.querySelectorAll(".NJIvua").length>0)return;$(t).prepend(`<div class="NJIvua kpls"><span>${e}</span></div>`)}}function Qi(t){const e=Ji(t);if(e){const t=e.children[0];if(t.querySelectorAll(".AIGbbvwG").length>0)return;$(t).prepend(`<div class="AIGbbvwG kpls"><span></span></div>`)}}function to(t){const e=Ji(t);if(e){const t=e.children[0];t.classList.remove("favoritE","cleareD");t.classList.add("_")}}function eo(){const t=Math.ceil(l.data.completed_orgs.length/k*100);var e="";var n=false;if(t==100){e="#4CAF50"}else if(t>=75){e="#C0CA33"}else if(t>=50){e="#FDD835"}else if(t>=25){e="#F4511E"}else if(t>=0){e="#E53935"}if(l.data.completed_orgs.length>=13){n=true;e="#4CAF50";$("#oive_r").css("width","340px").css("height","60px").css("top","calc(100dvh - 70px)");$("#oive_h").css("padding","0 10px");$("#auyGAWW").text(`2階職員室前の面談室5 へおこしください！ペンを贈呈致します ${t}% (${l.data.completed_orgs.length}/${k})`)}else{$("#auyGAWW").css("color",e).text(`${t}% (${l.data.completed_orgs.length}/${k})`)}}function no(t){console.log(t);const e=kt.string(8);const n=t["object"]?.["floor"]??t["floor"];ht.length=0;ht.push(e);O.deny=true;function i(){const n=.25;const i=gt;const o=3e3/5;const s=li([window.innerWidth/2,window.innerHeight/2]);const c={zoom1:n<a?(n-a)/(o/3):0,zoom2:(i-n)/(o/3),pos:{x:((t["object"]?.["coordinate"]?.["x"]??t["x"])-s.x)/(o*(2/3)),y:((t["object"]?.["coordinate"]?.["y"]??t["y"])-s.y)/(o*(2/3))}};var r=0;function d(){r++;if(r>o){hi();O.deny=false;return}if(r<o/3)a+=c.zoom1;if(r>o*(3-1)/3)a+=c.zoom2;if(r<o*(2/3)){s.x+=c.pos.x;s.y+=c.pos.y}fi(s,a);ht.includes(e)?setTimeout(d,5):void 0}d()}if(st==(t["object"]?.["floor"]??t["floor"])){i()}else{const t=ot[n];po(n,n,t).then(i)}}!function(){const t=document.getElementById("#place-selector".slice(1));$("#place-options").children().each((function(t,e){if(!this.textContent)return;const n=this.getAttribute("floor")||"";const i=this.textContent.replace(/ /g,"");if(n.length<1)return;function o(t){this.addEventListener("click",(function(e){e.preventDefault();const n=ot[t];if(st===t||n===undefined)return;po(t,i,n)}));return 0}o.apply(this,[n])}));$(t).on("click",(function(e){e.preventDefault();if(e.target?.classList.contains("fselector-btn")||e.target?.id=="psdummy"){ho.apply($(t),[at.fselector.opened]);at.fselector.opened=!at.fselector.opened}}));return 0}();!function(){window.addEventListener("click",(function(t){const e=t.target;if($(e).hasClass("article-image")){const t=e.getAttribute("src");if(t)yo.popupMedia(t,"img",e)}}));"touchstart mousedown".split(" ").forEach((t=>{document.getElementById("user-stricter")?.addEventListener(t,(function(){if(oo.isfullyopened){ro()}}))}));document.getElementById("shishiji-overview")?.addEventListener("click",(function(t){if(t.pageY<20){document.getElementById("shishiji-overview")?.scrollTo({behavior:"smooth",top:0})}}));document.getElementById("dvd4")?.addEventListener("click",(function(t){t.preventDefault();w.share()}));document.getElementById("dvd1")?.addEventListener("click",(function(t){t.preventDefault();Z()}));document.getElementById("dvd2")?.addEventListener("click",(function(t){t.preventDefault();w.favorite()}));document.getElementById("dvd3")?.addEventListener("click",(function(t){t.preventDefault();w.vote()}));return 0}();!function(){const t=document.getElementById("shishiji-view");const i=document.getElementById("#place-selector".slice(1));function o(t){const e=t.target;if(O.deny)return true;if(e?.classList.contains("canvas_interactive")||e?.tagName.toLowerCase()==="canvas"){return false}return true}window.addEventListener("touchstart",(t=>{if(o(t))return;t.preventDefault();clearTimeout(N);if(at.fselector.opened){ho.apply($(i),[true]);at.fselector.opened=false}u();h(t);vi(t.touches);if(t.touches.length>=2)gi(t.touches)}),{passive:false});window.addEventListener("mousedown",(t=>{if(o(t))return;t.preventDefault();clearTimeout(N);if(at.fselector.opened){ho.apply($(i),[true]);at.fselector.opened=false}u();vi(t);window.addEventListener("mousemove",c,{passive:false})}),{passive:false});window.addEventListener("touchmove",(function(t){if(o(t))return;t.preventDefault();Ti(t)}),{passive:false});window.addEventListener("touchend",(t=>{if(o(t))return;t.preventDefault();h(t);s=false;e=[null,null];l(R.x,R.y)}),{passive:false});window.addEventListener("mouseup",r,{passive:false});window.addEventListener("wheel",a,{passive:true});window.addEventListener("mousewheel",a,{passive:true});function a(t){if(o(t))return;clearInterval(N);N=setTimeout((()=>{hi()}),d);if(Si.ctr)Li(t);else ki(t)}function c(e){if(O.deny)return;e.preventDefault();t.style.cursor="move";Array.from(document.getElementsByClassName("canvas_interactive")).forEach((t=>{t.style.cursor="move"}));s=true;Ii(e)}function r(n){n.preventDefault();e=[null,null];window.removeEventListener("mousemove",c);t.style.cursor="default";Array.from(document.getElementsByClassName("canvas_interactive")).forEach((t=>{t.style.cursor=t.getAttribute("dfcs")}));const i=R.x,o=R.y;if(s){s=false;return l(i,o)}}function l(t,e){function n(t){return t<0?-1:1}var i=t,o=e,s=R.a*n(t),a=R.a*n(e);if(isNaN(i)||isNaN(o))return 0;const c=setInterval((function(){var n={top:o/1e3,left:i/1e3};if(n.top*e<=0)n.top=0;if(n.left*t<=0)n.left=0;_i(n);i+=s;o+=a;if(i*t<=0&&o*e<=0){N=setTimeout((function(){hi()}),d);clearInterval(c);return}}),1);M=c;return 0}document.body.addEventListener("mousemove",(function(t){t.preventDefault();n=[t.clientX,t.clientY]}));function u(){s=false;clearInterval(M)}function h(t){F=0;Y=0;P=0;X=0;W=-1;B={x:-1,y:-1,distance:-1};H.real=[];if(t.touches.length<2)U=false}return 0}();!function(){!function(){return;const t=$("");function e(t){return Number(t.replace("px",""))}const n={width:e(t.css("width")),height:e(t.css("height")),margin:e(t.css("margin"))};$(window).on("resize",(function(i){var o=e(t.css("width"));var s=e(t.css("height"));var a=e(t.css("margin"));if(window.innerWidth<=o+a*2){t.css("width",window.innerWidth-a*2+"px");o=window.innerWidth-a*2}else{t.css("width",n.width+"px")}t.css("top",(window.innerHeight-(a*2+s))/2+"px").css("left",(window.innerWidth-(a*2+o))/2+"px")}));return 0}();return 0}();function ko(){i.width=window.innerWidth;i.height=window.innerHeight;i.style.width=i.width+"px";i.style.height=i.height+"px";C.canvas.width=i.width;C.canvas.height=i.height}!function(){const e=window.performance?.getEntriesByType("navigation")[0].type;const n={article:Xt(mt.ARTICLE_ID),zoomRatio:Number(Xt(mt.ZOOM_RATIO))||1,floor:Xt(mt.FLOOR),coords:Xt(mt.COORDS)?.split(",").map((t=>typeof t==="undefined"||isNaN(Number(t))?0:Number(t)))||[0,0],from:Xt(mt.URL_FROM),lang:Zt(Xt(mt.LANGUAGE)),jumpto:Xt(mt.JUMPTO),_poor_coords:Xt(mt.COORDS)?.split(",").map((t=>typeof t==="undefined"||isNaN(Number(t))?0:Number(t)))||[0,0]};if(n.coords.length!=2||n.coords.some((t=>{if(!t||isNaN(t))return true})))n.coords=[0,0];if(e=="reload"){switch(lt){case dt.DO_EVERYTHING:case dt.INIT_FLOOR:n.floor=null;Ht(mt.FLOOR);case dt.INIT_COORDS:n.coords=[0,0];Ht(mt.COORDS);case dt.INIT_ZOOMRADIO:n.zoomRatio=1;Ht(mt.ZOOM_RATIO);case dt.CLOSE_ARTICLE:n.article=null;Ht(mt.ARTICLE_ID);case dt.DO_NOTHING:default:}}const i=Ot(TEXTS[t].LOADING,"first",true);Ht(mt.URL_FROM);ko();fo();function o(t){const e=document.createElement("div");e.classList.add("fselc-cell","flxxt","realshadow");for(const[n,i]of Object.entries(t)){if(n=="initial_floor")continue;const t=e.cloneNode();t.textContent=i["so-called"]||n;t.setAttribute("floor",n);t.id="floor-"+n;t.addEventListener("click",(function(){if(st!=n&&!y.main_screen){ht.length=0;po(n,t.textContent||"",ot[n],true);O.deny=false;$(".fselc-cell").removeClass("currentflr");$(this).addClass("currentflr")}}));$("#fsel-xxl").append(t)}}const s=$.when($.post(ajaxpath.mapdata),$.post(ajaxpath.mapobjs),$.post(ajaxpath.mappoints),Me);function c(e,s,c){const r=e[0],d=s[0],u=c[0],h=[],f=[],m={"1F":"1階","2F":"2階","3F":"1階","4F":"4階",B1:"地下1階"};ot=r;V=d;K=u;o(e[0]);var p=r.initial_floor;var v=r[r.initial_floor];var g=Boolean(n.zoomRatio===1);if(n.floor&&Object.keys(r).includes(n.floor)){p=n.floor;v=r[n.floor]}if(n.from==pt.FROM_NAVIGATE){const t=Pt(n.article||"");p=t?.object.floor;v=r[p];h.push((()=>{fi(t?.object.coordinate||{x:(v.xrange+1)*v.tile_width/2,y:(v.yrange+1)*v.tile_height/2},a,true)}))}if(n.jumpto){var _=Pt(n.jumpto);p=_?.object.floor;v=r[p];n.article="";Ht(mt.JUMPTO);Ht(mt.ARTICLE_ID);h.push((()=>{fi(_?.object.coordinate||{x:(v.xrange+1)*v.tile_width/2,y:(v.yrange+1)*v.tile_height/2},gt,true);_o.notify("info",Et(TEXTS[t].JUMPED_TO_MAP,_?.article.title))}))}st=p;C.width=v.tile_width*(v.xrange+1);C.height=v.tile_height*(v.yrange+1);+function(){var e=0;i.then((async()=>{if(!Yt("__reception")){Ft("__reception","done-"+(new Date).toString())}if(l.data.custom_data.headcount==0){De().then((()=>{if(ye("main_screen"))y.main_screen=O.deny=true;setTimeout((()=>{Ee("main_screen")}),250)}))}await Rt(TEXTS[t].MAP_LOADED,e);ye("main_screen")&&l.data.custom_data.headcount!=0?f.push((()=>{y.main_screen=O.deny=true;Ee("main_screen")})):0;f.forEach((t=>t()))}));$("#app-mount").show();if(n.article){if(n.from==pt.FROM_NAVIGATE)return;const e=Pt(n.article);var o=0;var s="description";if(e==null){if(n.from==pt.FROM_ARTICLE_SHARE){setTimeout((()=>{_o.notify("error",TEXTS[t].NOTIFICATION_SHARED_EVENT_NOT_FOUND,{duration:7500,discriminator:"share not found"})}),500)}Ht(mt.ARTICLE_ID);return}if(n.from==pt.FROM_ARTICLE_SHARE){const n=e.object.coordinate;st=p=e.object.floor;v=ot[st];h.push((()=>fi(n,gt,true)));f.push((()=>{_o.notify("info",TEXTS[t].NOTIFICATION_SHARED_EVENT_FOUND,{duration:5e3,discriminator:"share found"})}));const i=Xt(mt.SCROLL_POS),a=Xt(mt.ART_TARGET);Ht(mt.SCROLL_POS);Ht(mt.ART_TARGET);if(i!=null||a){o=Number(i);if(a)s=a}}f.push((()=>{so();lo(e,true,o,s)}))}}();function w(){const t={width:(v.xrange+1)*v.tile_width,height:(v.yrange+1)*v.tile_height};const e=[document.body.clientWidth/t.width,document.body.clientHeight/t.height];C.canvas.coords={x:n.coords[0],y:n.coords[1]};if(n.zoomRatio>O.caps.ratio.max)n.zoomRatio=O.caps.ratio.max;if(n.zoomRatio<O.caps.ratio.min)n.zoomRatio=O.caps.ratio.min;a=n.zoomRatio||Math.min(...e);_i({left:0,top:0});Xi(p,V);Gi();hi();mo();if(g||n._poor_coords.some((t=>t===0))){a=Math.min(...e);fi({x:(v.xrange+1)*v.tile_width/2,y:(v.yrange+1)*v.tile_height/2},a,true)}h.forEach((t=>t()))}$("#floor-"+st).addClass("currentflr");mi(v,{over:"",under:m[st]},w);Bt(mt.FLOOR,st);fo()}s.done(n.floor?c:c);return 0}();window.addEventListener("resize",(function(t){t.preventDefault();ko();_i({top:0,left:0});window.scroll({top:0,behavior:"instant"})}),{passive:false});window.addEventListener("touchstart",(function(t){if(t.target.classList.contains("canvas_interactive")){t.target.classList.add("interactive_trans")}}),{passive:true});window.addEventListener("touchend",(function(t){Array.from(document.getElementsByClassName("interactive_trans")).forEach((t=>t.classList.remove("interactive_trans")))}),{passive:true});document.oncontextmenu=()=>false;if("serviceWorker"in navigator){navigator.serviceWorker.register("/src/assets/service-worker/poverty.js").then((function(t){})).catch((function(t){}))}setInterval((async function(){for(const t of l.pending_collects){xe(t.name,t.count)}l.pending_collects.length=0}),1e4);window.addEventListener("load",(function(t){}));return 0})();